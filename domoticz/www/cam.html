<div id="cameracontent">
</div>
<div id="cameramain" style="display:none;">
    <table class="display" id="cameratable" border="0" cellpadding="0" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th width="120" align="left">Name</th>
                <th width="60" align="left">Enabled</th>
                <th width="200" align="left">Address</th>
                <th width="80" align="center">Port</th>
            </tr>
        </thead>
    </table>
    <table id="updelclr" border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td>
					<a class="btnstyle3-dis" id="cameraupdate" >Update</a>&nbsp;&nbsp;&nbsp;
					<a class="btnstyle3-dis" id="cameradelete" >Delete</a>
				</td>
			</tr>
		</table>
		<br>
		<table class="display" id="cameraparamstable" border="0" cellpadding="0" cellspacing="20">
			<tr>
				<td align="right" style="width:80px"><label for="enabled">Enabled:</label></td>
				<td><input type="checkbox" id="enabled" checked></td>
			</tr>
			<tr>
				<td align="right" style="width:110px"><label for="cameraname">Name:</label></td>
				<td><input type="text" id="cameraname" style="width: 250px; padding: .4em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td align="right" style="width:110px"><label for="cameraaddress">Image grab address:</label></td>
				<td><input type="text" id="cameraaddress" style="width: 400px; padding: .4em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td align="right" style="width:110px"><label for="cameraport">Port:</label></td>
				<td><input type="text" id="cameraport" style="width: 60px; padding: .4em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr>
				<td align="right" style="width:110px"><label id="lblusername" for="username">Username:</label></td>
				<td><input type="text" id="username" style="width: 150px; padding: .4em;" class="text ui-widget-content ui-corner-all" />
			</tr>
			<tr>
				<td align="right" style="width:110px"><label id="lblpassword" for="password">Password:</label></td>
					<td><input type="password" id="password" style="width: 150px; padding: .4em;" class="text ui-widget-content ui-corner-all" />
				</tr>
			</table>
		</div>
		<br>
    <a class="btnstyle3" onclick="Addcamera();">Add</a>
</div>

<script type="text/javascript" charset="utf-8">

function Deletecamera(idx)
{
	var bValid = false;
	bValid=(confirm("Are you sure you want to delete this camera?")==true);
	if (bValid == false) {
		return;
	}
	$.ajax({
		 url: "json.htm?type=command&param=deletecamera&idx=" + idx,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			RefreshcameraTable();
		 },
		 error: function(){
				HideNotify();
				ShowNotify('Problem deleting camera!', 2500, true);
		 }     
	});
}


function Updatecamera(idx)
{
	var name=$("#cameracontent #cameraparamstable #cameraname").val();
	if (name=="")
	{
		ShowNotify('Please enter a Name!', 2500, true);
		return;
	}
	
	var bEnabled=$('#cameracontent #cameraparamstable #enabled').is(":checked");
	
	var text = $("#cameracontent #cameraparamstable #combotype option:selected").text();

	var address=$("#cameracontent #cameraparamstable #cameraaddress").val();
	if (address=="")
	{
		ShowNotify('Please enter an Address!', 2500, true);
		return;
	}
	var port=$("#cameracontent #cameraparamstable #cameraport").val();
	if (port=="")
	{
		ShowNotify('Please enter a port number!', 2500, true);
		return;
	}
	var intRegex = /^\d+$/;
	if(!intRegex.test(port)) {
		ShowNotify('Please enter a valid port number!', 2500, true);
		return;
	}
	var username=$('#cameracontent #cameraparamstable #username').val();
	var password=$('#cameracontent #cameraparamstable #password').val();
			
	$.ajax({
		 url: "json.htm?type=command&param=updatecamera&address=" + address + "&port=" + port + "&name=" + name + "&enabled=" + bEnabled + "&idx=" + idx + "&username=" + username + "&password=" + password ,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			RefreshcameraTable();
		 },
		 error: function(){
			ShowNotify('Problem adding camera!', 2500, true);
		 }     
	});

}

function Addcamera()
{
	var name=$("#cameracontent #cameraparamstable #cameraname").val();
	if (name=="")
	{
		ShowNotify('Please enter a Name!', 2500, true);
		return;
	}
	
	var bEnabled=$('#cameracontent #cameraparamstable #enabled').is(":checked");
	
	var text = $("#cameracontent #cameraparamstable #combotype option:selected").text();

	var address=$("#cameracontent #cameraparamstable #cameraaddress").val();
	if (address=="")
	{
		ShowNotify('Please enter an Address!', 2500, true);
		return;
	}
	var port=$("#cameracontent #cameraparamstable #cameraport").val();
	if (port=="")
	{
		ShowNotify('Please enter an Port!', 2500, true);
		return;
	}
	var intRegex = /^\d+$/;
	if(!intRegex.test(port)) {
		ShowNotify('Please enter an Valid Port!', 2500, true);
		return;
	}
	var username=$('#cameracontent #cameraparamstable #username').val();
	var password=$('#cameracontent #cameraparamstable #password').val();
			
	$.ajax({
		 url: "json.htm?type=command&param=addcamera&address=" + address + "&port=" + port + "&name=" + name + "&enabled=" + bEnabled +  "&username=" + username + "&password=" + password ,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			RefreshcameraTable();
		 },
		 error: function(){
			ShowNotify('Problem adding camera!', 2500, true);
		 }     
	});		
}

function RefreshcameraTable()
{
  $('#modal').show();

	$('#updelclr #cameraupdate').attr("class", "btnstyle3-dis");
	$('#updelclr #cameradelete').attr("class", "btnstyle3-dis");

  var oTable = $('#cameratable').dataTable();
  oTable.fnClearTable();
  $.ajax({
     url: "json.htm?type=cameras", 
     async: false, 
     dataType: 'json',
     success: function(data) {
        
      if (typeof data.result != 'undefined') {
        $.each(data.result, function(i,item){
       
					var enabledstr="No";
					if (item.Enabled=="true") {
						enabledstr="Yes";
					}
					
					
          var addId = oTable.fnAddData( {
								"DT_RowId": item.idx,
								"Username": item.Username,
								"Password": item.Password,
								"Enabled": item.Enabled,
								"IntPort": item.Port,
				                "0": item.Name,
				                "1": enabledstr,
				               	"2": item.Address,
				               	"3": item.Port
							} );
        });
				/* Add a click handler to the rows - this could be used as a callback */
				$("#cameratable tbody tr").click( function( e ) {
							if ( $(this).hasClass('row_selected') ) {
									$(this).removeClass('row_selected');
									$('#updelclr #cameraupdate').attr("class", "btnstyle3-dis");
									$('#updelclr #cameradelete').attr("class", "btnstyle3-dis");
							}
							else {
									oTable.$('tr.row_selected').removeClass('row_selected');
									$(this).addClass('row_selected');
									$('#updelclr #cameraupdate').attr("class", "btnstyle3");
									$('#updelclr #cameradelete').attr("class", "btnstyle3");
									var anSelected = fnGetSelected( oTable );
									if ( anSelected.length !== 0 ) {
										var data = oTable.fnGetData( anSelected[0] );
										var idx= data["DT_RowId"];
										$.myglobals.SelectedTimerIdx=idx;
										$("#updelclr #cameraupdate").attr("href", "javascript:Updatecamera(" + idx + ")");
										$("#updelclr #cameradelete").attr("href", "javascript:Deletecamera(" + idx + ")");
										$("#cameracontent #cameraparamstable #cameraname").val(data["0"]);
										$("#cameracontent #cameraparamstable #cameraaddress").val(data[2]);
										$("#cameracontent #cameraparamstable #cameraport").val(data["IntPort"]);
										$('#cameracontent #cameraparamstable #enabled').prop('checked',(data["Enabled"]=="true"));
										$("#cameracontent #cameraparamstable #username").val(data["Username"]);
										$("#cameracontent #cameraparamstable #password").val(data["Password"]);
									}
							}
				}); 
				
      }
     }
  });
  $('#modal').hide();
}


function Showcamera()
{
	var oTable;
	
	$('#modal').show();
  var htmlcontent = "";
  htmlcontent+=$('#cameramain').html();
  $('#cameracontent').html(htmlcontent);
  oTable = $('#cameratable').dataTable( {
                  "sDom": '<"H"lfrC>t<"F"ip>',
                  "oTableTools": {
                    "sRowSelect": "single",
                  },
                  "aaSorting": [[ 0, "desc" ]],
                  "bSortClasses": false,
                  "bProcessing": true,
                  "bStateSave": true,
                  "bJQueryUI": true,
                  "aLengthMenu": [[25, 50, 100, -1], [25, 50, 100, "All"]],
                  "iDisplayLength" : 25,
                  "sPaginationType": "full_numbers"
                } );

  $('#modal').hide();
  RefreshcameraTable();
 }


$(document).ready(function() {
	//global var
	$.devIdx=0;
	$.myglobals = {
		cameraTypesStr : [],
		SerialPortVal : [],
		SerialPortStr : [],
		SelectedcameraIdx: 0
	};
	$('#cameraparamstable #combotype > option').each(function() {
				 $.myglobals.cameraTypesStr.push($(this).text());
	});
	$('#cameraparamsserial #comboserialport > option').each(function() {
				 $.myglobals.SerialPortStr.push($(this).text());
				 $.myglobals.SerialPortVal.push(parseInt($(this).val()));
	});
  Showcamera();
} );  
</script>
