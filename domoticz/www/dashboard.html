<div id="dashcontent">
</div>

<script type="text/javascript" charset="utf-8">

function RefreshFavorites()
{
  clearInterval($.myglobals.refreshTimer);
  var id="";

  $.ajax({
     url: "json.htm?type=command&param=getSunRiseSet",
     async: false, 
     dataType: 'json',
     success: function(data) {
        if (typeof data.Sunrise != 'undefined') {
					var sunRise=data.Sunrise;
					var sunSet=data.Sunset;
					var ServerTime=data.ServerTime;
					var suntext=ServerTime + ', SunRise: ' + sunRise + ', SunSet: ' + sunSet;
					$("#timesun").html(suntext);
        }
     }
  });
  
  $.ajax({
     url: "json.htm?type=devices&filter=all&used=true&order=Name",
     async: false,
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {

        $.each(data.result, function(i,item){
						//Scenes
						if ((item.Type.indexOf('Scene') == 0)&&(item.Favorite!=0))
						{
							id="#dashcontent #scene_" + item.idx;
							var obj=$(id);
							if (typeof obj != 'undefined') {
								if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
									var status=item.Status;
									if (item.Status == 'On') {
											status+='<img src="images/lightbulb.png" title="Turn Off" onclick="SwitchScene(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
									else if (item.Status == 'Mixed') {
											status+='<img src="images/lightbulbunknown.png" title="Turn Off" onclick="SwitchScene(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
									else {
											status+='<img src="images/lightbulboff.png" title="Turn On" onclick="SwitchScene(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
									if ($(id + " #status").html()!=status) {
										$(id + " #status").html(status);
									}
								}
								else {
									var img="";
									if (item.Status == 'On') {
												img='<img src="images/light-on.png" title="Turn Off" onclick="SwitchScene(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
									else if (item.Status == 'Mixed') {
												img='<img src="images/light-unknown.png" title="Turn Off" onclick="SwitchScene(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
									else {
												img='<img src="images/light-off.png" title="Turn On" onclick="SwitchScene(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
									if ($(id + " #img").html()!=img) {
										$(id + " #img").html(img);
									}
									if ($(id + " #status").html()!=item.Status) {
										$(id + " #status").html(item.Status);
									}
									if ($(id + " #lastupdate").html()!=item.LastUpdate) {
										$(id + " #lastupdate").html(item.LastUpdate);
									}
								}
							}
						}
					}); //Scene devices

        $.each(data.result, function(i,item){
					//Lights
          if ((item.Type.indexOf('Light') == 0)&&(item.Favorite!=0))
          {
						id="#dashcontent #light_" + item.idx;
						var obj=$(id);
						if (typeof obj != 'undefined') {
							if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								var status=item.Status + " ";
								if (item.SwitchType == "Doorbell") {
									status+='<img src="images/door.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
								else if (item.SwitchType == "X10 Siren") {
									status+='<img src="images/siren.png" height="16">';
								}
								else if (item.SwitchType == "Contact") {
									if (item.Status == 'Closed') {
										status+='<img src="images/contact.png" height="16">';
									}
									else {
										status+='<img src="images/contact_open.png" height="16">';
									}
								}
								else if (item.SwitchType == "Blinds") {
									if (item.Status == 'Closed') {
											status+='<img src="images/blinds48.png" title="Open Blinds" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
									else {
											status+='<img src="images/blinds.png" title="Close Blinds" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
								}
								else if (item.SwitchType == "Blinds Inverted") {
									if (item.Status == 'Closed') {
											status+='<img src="images/blinds48.png" title="Open Blinds" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
									else {
											status+='<img src="images/blinds.png" title="Close Blinds" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
								}
								else if (item.SwitchType == "Dimmer") {
									var img="";
									if (
											(item.Status == 'On')||
											(item.Status == 'Chime')||
											(item.Status == 'Group On')||
											(item.Status.indexOf('Set ') == 0)
										 ) {
												img='<img src="images/dimmer.png" title="Turn Off" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
									else {
												img='<img src="images/dimmeroff.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
									status="<label id=\"statustext\">" + item.Status + "</label> <label id=\"dimimage\">" + img + "</label>";
								}
								else if (item.SwitchType == "Motion Sensor") {
									if (
											(item.Status == 'On')||
											(item.Status == 'Chime')||
											(item.Status == 'Group On')||
											(item.Status.indexOf('Set ') == 0)
										 ) {
												status+='<img src="images/motion.png" height="16">';
									}
									else {
												status+='<img src="images/motionoff.png" height="16">';
									}
								}
								else if (item.SwitchType == "Smoke Detector") {
										if (
												(item.Status == "Panic")||
												(item.Status == "On")
											 ) {
												status+='<img src="images/smoke.png" height="16">';
										}
										else {
												status+='<img src="images/smokeoff.png" height="16">';
										}
								}
								else {
									if (
											(item.Status == 'On')||
											(item.Status == 'Chime')||
											(item.Status == 'Group On')||
											(item.Status.indexOf('Set ') == 0)
										 ) {
												status+='<img src="images/lightbulb.png" title="Turn Off" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
									else {
												status+='<img src="images/lightbulboff.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
									}
								}
								if ($(id + " #status").html()!=status) {
									$(id + " #status").html(status);
								}
							}
							else {
								var img="";
								if (item.SwitchType == "Doorbell") {
									img='<img src="images/door48.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
								}
								else if (item.SwitchType == "X10 Siren") {
									if (
											(item.Status == 'On')||
											(item.Status == 'Chime')||
											(item.Status == 'Group On')||
											(item.Status == 'All On')
										 )
									{
													img='<img src="images/siren-on.png" height="40">';
									}
									else {
													img='<img src="images/siren-off.png" height="40">';
									}
								}
								else if (item.SwitchType == "Contact") {
									if (item.Status == 'Closed') {
										img='<img src="images/contact48.png" height="40">';
									}
									else {
										img='<img src="images/contact48_open.png" height="40">';
									}
								}
								else if (item.SwitchType == "Blinds") {
									if (item.Status == 'Closed') {
											img='<img src="images/blinds48.png" title="Open Blinds" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
									else {
											img='<img src="images/blindsopen48.png" title="Close Blinds" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
								}
								else if (item.SwitchType == "Blinds Inverted") {
									if (item.Status == 'Closed') {
											img='<img src="images/blinds48.png" title="Open Blinds" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
									else {
											img='<img src="images/blindsopen48.png" title="Close Blinds" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
								}
								else if (item.SwitchType == "Dimmer") {
									if (
											(item.Status == 'On')||
											(item.Status == 'Chime')||
											(item.Status == 'Group On')||
											(item.Status.indexOf('Set ') == 0)
										 ) {
												img='<img src="images/dimmer48-on.png" title="Turn Off" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
									else {
												img='<img src="images/dimmer48-off.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
								}
								else if (item.SwitchType == "Motion Sensor") {
									if (
											(item.Status == 'On')||
											(item.Status == 'Chime')||
											(item.Status == 'Group On')||
											(item.Status.indexOf('Set ') == 0)
										 ) {
												img='<img src="images/motion48-on.png" height="40">';
									}
									else {
												img='<img src="images/motion48-off.png" height="40">';
									}
								}
								else if (item.SwitchType == "Smoke Detector") {
										if (
												(item.Status == "Panic")||
												(item.Status == "On")
											 ) {
												img='<img src="images/smoke48on.png" height="40">';
										}
										else {
												img='<img src="images/smoke48off.png" height="40">';
										}
								}
								else {
									if (
											(item.Status == 'On')||
											(item.Status == 'Chime')||
											(item.Status == 'Group On')||
											(item.Status.indexOf('Set ') == 0)
										 ) {
												img='<img src="images/light-on.png" title="Turn Off" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
									else {
												img='<img src="images/light-off.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
									}
								}
								if ($(id + " #img").html()!=img) {
									$(id + " #img").html(img);
								}
								if ($(id + " #status").html()!=item.Status) {
									$(id + " #status").html(item.Status);
								}
								if ($(id + " #lastupdate").html()!=item.LastUpdate) {
									$(id + " #lastupdate").html(item.LastUpdate);
								}
							}
						}
					}
				}); //light devices

        //Temperature Sensors
        $.each(data.result, function(i,item){
          if (
                ((typeof item.Temp != 'undefined')||(typeof item.Humidity != 'undefined')||(typeof item.Chill != 'undefined')) &&
                (item.Favorite!=0)
              )
          {
						id="#dashcontent #temp_" + item.idx;
						var obj=$(id);
						if (typeof obj != 'undefined') {
							if ($(id + " #name").html()!=item.Name) {
								$(id + " #name").html(item.Name);
							}
							if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								var status="";
								var bHaveBefore=false;
								if (typeof item.Temp != 'undefined') {
										 status+=item.Temp + '° C';
										 bHaveBefore=true;
								}
								if (typeof item.Chill != 'undefined') {
									if (status!="") {
										status+=', ';
									}
									status+='Chill: ' + item.Chill + '° C';
									bHaveBefore=true;
								}
								if (typeof item.Humidity != 'undefined') {
									if (bHaveBefore==true) {
										status+=', ';
									}
									status+=item.Humidity + ' %';
								}
								if (typeof item.HumidityStatus != 'undefined') {
									status+=' (' + item.HumidityStatus + ')';
								}
								if (typeof item.Barometer != 'undefined') {
									status+='<br>' + item.Barometer + ' hPa';
								}
								if (typeof item.ForecastStr != 'undefined') {
									status+=', Prediction: ' + item.ForecastStr;
								}
								if ($(id + " #status").html()!=status) {
									$(id + " #status").html(status);
								}
							}
							else {
								var img='<img src="images/';
								if (typeof item.Temp != 'undefined') {
									img+=GetTemp48Item(item.Temp);
								}
								else {
									img+=GetTemp48Item(item.Chill);
								}
								img+='" height="40">';
								if ($(id + " #img").html()!=img) {
									$(id + " #img").html(img);
								}
								var status="";
								var bigtext="";
								var bHaveBefore=false;
								if (typeof item.Temp != 'undefined') {
										 status+=item.Temp + '° C';
										 bigtext=item.Temp + '\u00B0';
										 bHaveBefore=true;
								}
								if (typeof item.Chill != 'undefined') {
									if (bHaveBefore) {
										status+=', ';
										bigtext+=' / ';
									}
									status+='Chill: ' + item.Chill + '° C';
									bigtext+=item.Chill + '\u00B0';
									bHaveBefore=true;
								}
								if (typeof item.Direction != 'undefined') {
									status+='<br>' + item.Direction + ' ' + item.DirectionStr + ', Speed: ' + item.Speedms + ' ms, Gust: ' + item.Gustms + ' ms\n';
								}
								if (typeof item.Humidity != 'undefined') {
									if (bHaveBefore==true) {
										status+=', ';
										bigtext+=' / ';
									}
									status+='Humidity: ' + item.Humidity + ' %';
									bigtext+=item.Humidity + '%';
								}
								if (typeof item.HumidityStatus != 'undefined') {
									status+=' (' + item.HumidityStatus + ')';
								}
								if (typeof item.Barometer != 'undefined') {
									status+='<br>' + item.Barometer + ' hPa';
								}
								if (typeof item.ForecastStr != 'undefined') {
									status+=', Prediction: ' + item.ForecastStr;
								}
								
								var nbackcolor="#D4E1EE";
								if (item.HaveTimeout==true) {
									nbackcolor="#DF2D3A";
								}
								var obackcolor=rgb2hex($(id + " #name").css( "background-color" )).toUpperCase();
								if (obackcolor!=nbackcolor) {
									$(id + " #name").css( "background-color", nbackcolor );
								}
								
								if ($(id + " #status").html()!=status) {
									if (typeof $(id + " #bigtext") != 'undefined') {
										$(id + " #bigtext").html(bigtext);
									}
									$(id + " #status").html(status);
								}
								if ($(id + " #lastupdate").html()!=item.LastUpdate) {
									$(id + " #lastupdate").html(item.LastUpdate);
								}
							}
						}
          }
        }); //temp devices

        //Weather Sensors
        $.each(data.result, function(i,item){
          if (
                ( (typeof item.Rain != 'undefined') || (typeof item.UVI != 'undefined') || (typeof item.Direction != 'undefined') || (typeof item.Barometer != 'undefined') ) &&
                (item.Favorite!=0)
              )
          {
						id="#dashcontent #weather_" + item.idx;
						var obj=$(id);
						if (typeof obj != 'undefined') {
							if ($(id + " #name").html()!=item.Name) {
								$(id + " #name").html(item.Name);
							}
							if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								var status="";
								if (typeof item.Rain != 'undefined') {
									status=item.Rain + ' mm';
									if (typeof item.RainRate != 'undefined') {
										if (item.RainRate!=0) {
											status+=', Rate: ' + item.RainRate + ' mm/h';
										}
									}
								}
								else if (typeof item.UVI != 'undefined') {
									status=item.UVI + ' UVI';
								}
								else if (typeof item.Direction != 'undefined') {
									img='<img src="images/Wind' + item.DirectionStr + '.png" height="40">';
									status=item.Direction + ' ' + item.DirectionStr + ', Speed: ' + item.Speedms + ' ms, Gust: ' + item.Gustms + ' ms';
								}
								else if (typeof item.Barometer != 'undefined') {
                  status=item.Barometer + ' hPa, Prediction: ' + item.ForecastStr;
                }
								if ($(id + " #status").html()!=status) {
									$(id + " #status").html(status);
								}
							}
							else {
								var img="";
								var status="";
								var bigtext="";
								if (typeof item.Rain != 'undefined') {
									img='<img src="images/rain48.png" height="40">';
									status=item.Rain + ' mm';
									bigtext=item.Rain + ' mm';
									if (typeof item.RainRate != 'undefined') {
										if (item.RainRate!=0) {
											status+=', Rate: ' + item.RainRate + ' mm/h';
										}
									}
								}
								else if (typeof item.UVI != 'undefined') {
									img='<img src="images/uv48.png" height="40">';
									status=item.UVI + ' UVI';
									bigtext=item.UVI + ' UVI';
									if (typeof item.Temp!= 'undefined') {
										status+=', Temp: ' + item.Temp + '° C';
									}
								}
								else if (typeof item.Direction != 'undefined') {
									img='<img src="images/Wind' + item.DirectionStr + '.png" height="40">';
									status=item.Direction + ' ' + item.DirectionStr + ', Speed: ' + item.Speedms + ' ms, Gust: ' + item.Gustms + ' ms<br>\n';
									if (typeof item.Temp != 'undefined') {
										status+='Temp: ' + item.Temp + '° C, ';
									}
									status+='Chill: ' + item.Chill + '° C';
									bigtext=item.DirectionStr + '/' + item.Speedms + ' ms';
								}
								else if (typeof item.Barometer != 'undefined') {
                  img='<img src="images/baro48.png" height="40">';
                  status=item.Barometer + ' hPa, Prediction: ' + item.ForecastStr;
                  bigtext=item.Barometer + ' hPa';
                }
                
								var nbackcolor="#D4E1EE";
								if (item.HaveTimeout==true) {
									nbackcolor="#DF2D3A";
								}
								var obackcolor=rgb2hex($(id + " #name").css( "background-color" )).toUpperCase();
								if (obackcolor!=nbackcolor) {
									$(id + " #name").css( "background-color", nbackcolor );
								}
                
								if ($(id + " #img").html()!=img) {
									$(id + " #img").html(img);
								}
								if ($(id + " #status").html()!=status) {
									$(id + " #status").html(status);
								}
								if ($(id + " #bigtext").html()!=bigtext) {
									$(id + " #bigtext").html(bigtext);
								}
								if ($(id + " #lastupdate").html()!=item.LastUpdate) {
									$(id + " #lastupdate").html(item.LastUpdate);
								}
							}
						}
          }
        }); //weather devices
        
        //security devices
        $.each(data.result, function(i,item){
          if ((item.Type.indexOf('Security') == 0)&&(item.Favorite!=0))
          {
						id="#dashcontent #security_" + item.idx;
						var obj=$(id);
						if (typeof obj != 'undefined') {
							if ($(id + " #name").html()!=item.Name) {
								$(id + " #name").html(item.Name);
							}
							if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								if ($(id + " #status").html()!=item.Status) {
									$(id + " #status").html(item.Status);
								}
							}
							else {
								var img="";
								if (item.SubType.indexOf('remote') > 0) {
									img='<img src="images/remote48.png" height="40">';
								}
								else if (item.SwitchType == "Smoke Detector") {
										if (
												(item.Status == "Panic")||
												(item.Status == "On")
											 ) {
												img='<img src="images/smoke48on.png" title="Turn Alarm On" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
										}
										else {
												img='<img src="images/smoke48off.png" title="Turn Alarm On" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
										}
								}
								else {
									if ((item.Status.indexOf('Alarm') >= 0)||(item.Status.indexOf('Tamper') >= 0)) {
										img='<img src="images/alarm48.png" height="40">';
									}
									else {
										img='<img src="images/security48.png" height="40">';
									}
								}
								
								var nbackcolor="#D4E1EE";
								if (item.HaveTimeout==true) {
									nbackcolor="#DF2D3A";
								}
								var obackcolor=rgb2hex($(id + " #name").css( "background-color" )).toUpperCase();
								if (obackcolor!=nbackcolor) {
									$(id + " #name").css( "background-color", nbackcolor );
								}
								
								if ($(id + " #img").html()!=img) {
									$(id + " #img").html(img);
								}
								if ($(id + " #status").html()!=item.Status) {
									$(id + " #status").html(item.Status);
								}
								if ($(id + " #lastupdate").html()!=item.LastUpdate) {
									$(id + " #lastupdate").html(item.LastUpdate);
								}
							}
						}
          }
        }); //security devices
        
        //Utility Sensors
        $.each(data.result, function(i,item){
          if (
                ( (typeof item.Counter != 'undefined') || (item.Type == "Current") || (item.Type == "Energy") || (item.Type == "Current/Energy")) &&
                (item.Favorite!=0)
              )
          {
						id="#dashcontent #utility_" + item.idx;
						var obj=$(id);
						if (typeof obj != 'undefined') {
							if ($(id + " #name").html()!=item.Name) {
								$(id + " #name").html(item.Name);
							}
							if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								var status="";
								if (typeof item.Counter != 'undefined') {
									if (data.DashboardType==0) {
										status+=item.Counter + ', Today: ' + item.CounterToday;
									}
									else {
										status+=item.Counter + ', T: ' + item.CounterToday;
									}
								}
								else if ((item.Type == "Current") || (item.Type == "Current/Energy")) {
									status+=item.Data;
								}
								else if (item.Type == "Energy") {
									status+=item.Data;
								}
								if (typeof item.Usage != 'undefined') {
									if (data.DashboardType==0) {
										status+=", Usage: " + item.Usage;
									}
									else {
										status+=", U: " + item.Usage;
									}
								}
								if (typeof item.CounterDeliv != 'undefined') {
									if (item.CounterDeliv!=0) {
										if (data.DashboardType==0) {
											status+='<br>Return: ' + item.CounterDeliv + ', Today: ' + item.CounterDelivToday;
											status+=", Actual: " + item.UsageDeliv;
										}
										else {
											status+='<br>R: ' + item.CounterDeliv + ', T: ' + item.CounterDelivToday;
											status+=", A: " + item.UsageDeliv;
										}
									}
								}
								if ($(id + " #status").html()!=status) {
									$(id + " #status").html(status);
								}
							}
							else {
								var img="";
								var status="";
								var bigtext="";
								
								if (typeof item.Counter != 'undefined') {
									img='<img src="images/counter.png" height="40">';
									if (data.DashboardType==0) {
										status=item.Counter + ', Today: ' + item.CounterToday;
									}
									else {
										status=item.Counter + ', T: ' + item.CounterToday;
									}
								}
								else if ((item.Type == "Current") || (item.Type == "Current/Energy")) {
									img='<img src="images/current48.png" height="40">';
									status=item.Data;
								}
								else if (item.Type == "Energy") {
									img='<img src="images/current48.png" height="40">';
									status=item.Data;
								}
								if (typeof item.Usage != 'undefined') {
									bigtext=item.Usage;
									if (data.DashboardType==0) {
										status+=", Usage: " + item.Usage;
									}
									else {
										status+=", U: " + item.Usage;
									}
								}
								if (typeof item.CounterDeliv != 'undefined') {
									if (item.CounterDeliv!=0) {
										status+='<br>';
										if (data.DashboardType==0) {
											status+='Return: ' + item.CounterDeliv + ', Today: ' + item.CounterDelivToday;
											status+=", Actual: " + item.UsageDeliv;
										}
										else {
											status+='R: ' + item.CounterDeliv + ', T: ' + item.CounterDelivToday;
											status+=", A: " + item.UsageDeliv;
										}
									}
								}
								
								var nbackcolor="#D4E1EE";
								if (item.HaveTimeout==true) {
									nbackcolor="#DF2D3A";
								}
								var obackcolor=rgb2hex($(id + " #name").css( "background-color" )).toUpperCase();
								if (obackcolor!=nbackcolor) {
									$(id + " #name").css( "background-color", nbackcolor );
								}
								
								if ($(id + " #img").html()!=img) {
									$(id + " #img").html(img);
								}
								if ($(id + " #status").html()!=status) {
									$(id + " #status").html(status);
								}
								if ($(id + " #bigtext").html()!=bigtext) {
									$(id + " #bigtext").html(bigtext);
								}
								if ($(id + " #lastupdate").html()!=item.LastUpdate) {
									$(id + " #lastupdate").html(item.LastUpdate);
								}
							}
						}
          }
        }); //Utility devices
      }
     }
  });
  $.myglobals.refreshTimer = setInterval(RefreshFavorites, 10000);
}

function ShowFavorites()
{
  clearInterval($.myglobals.refreshTimer);
  var totdevices=0;
  var jj=0;
  var bHaveAddedDevider = false;

  $.myglobals.ismobile=( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) );

	var htmlcontent = "";

  var sunRise="";
  var sunSet="";
  var ServerTime="";

  $.ajax({
     url: "json.htm?type=command&param=getSunRiseSet",
     async: false, 
     dataType: 'json',
     success: function(data) {
        if (typeof data.Sunrise != 'undefined') {
          sunRise=data.Sunrise;
          sunSet=data.Sunset;
          ServerTime=data.ServerTime;
        }
     }
  });

  $.ajax({
     url: "json.htm?type=devices&filter=all&used=true&order=Name",
     async: false,
     dataType: 'json',
     success: function(data) {
			var rowItems=3;
			if (data.DashboardType==1) {
				rowItems=4;
			}
			if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
				rowItems=1000;
			}
			$.myglobals.DashboardType=data.DashboardType;

      if (typeof data.result != 'undefined') {
				//Scenes
        jj=0;
        bHaveAddedDevider = false;
        $.each(data.result, function(i,item){
          if ((item.Type.indexOf('Scene') == 0)&&(item.Favorite!=0))
          {
            totdevices+=1;
            if (jj == 0)
            {
              //first time
              if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								htmlcontent+='\t    <table class="mobileitem">\n';
								htmlcontent+='\t    <thead>\n';
								htmlcontent+='\t    <tr>\n';
								htmlcontent+='\t    		<th>Scenes</th>\n';
								htmlcontent+='\t    		<th style="text-align:right"><a id="cLightSwitches" href="javascript:SwitchLayout(\'Scenes\')"><img src="images/next.png"></a></th>\n';
								htmlcontent+='\t    </tr>\n';
								htmlcontent+='\t    </thead>\n';
              }
              else {
								htmlcontent+='<h2>Scenes:</h2>\n';
							}
            }
            if (jj % rowItems == 0)
            {
              //add devider
              if (bHaveAddedDevider == true) {
                //close previous devider
                htmlcontent+='</div>\n';
              }
              htmlcontent+='<div class="row divider">\n';
              bHaveAddedDevider=true;
            }
            
            var xhtm="";
						if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
							xhtm+=
									'\t    <tr id="scene_' + item.idx +'">\n' +
									'\t      <td id="name">' + item.Name;
							xhtm+=
									 '</td>\n';
							var status=item.Status + " ";
							if (item.Status == 'On') {
											status+='<img src="images/lightbulb.png" title="Turn Off" onclick="SwitchScene(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
							}
							else if (item.Status == 'Mixed') {
											status+='<img src="images/lightbulbunknown.png" title="Turn Off" onclick="SwitchScene(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
							}
							else {
										status+='<img src="images/lightbulboff.png" title="Turn On" onclick="SwitchScene(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
							}
							xhtm+=
										'\t      <td id="status">' + status + '</td>\n' +
										'\t    </tr>\n';
						}
						else {
							if (data.DashboardType==0) {
								xhtm='\t<div class="span4" id="scene_' + item.idx +'">\n';
							}
							else if (data.DashboardType==1) {
								xhtm='\t<div class="span3" id="scene_' + item.idx +'">\n';
							}
							xhtm+='\t  <section>\n';
							if (data.DashboardType==0) {
								xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							}
							else if (data.DashboardType==1) {
								xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							}
							xhtm+=
									'\t    <tr>\n' +
									'\t      <td id="name">' + item.Name + '</td>\n'+
									'\t      <td id="bigtext"></td>\n';
							if (item.Status == 'On') {
										xhtm+='\t      <td id="img"><img src="images/light-on.png" title="Turn Off" onclick="SwitchScene(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
							}
							else if (item.Status == 'Mixed') {
										xhtm+='\t      <td id="img"><img src="images/light-unknown.png" title="Turn Off" onclick="SwitchScene(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
							}
							else {
										xhtm+='\t      <td id="img"><img src="images/light-off.png" title="Turn On" onclick="SwitchScene(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
							}
							xhtm+=
										'\t      <td id="status">' + item.Status + '</td>\n' +
										'\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n';
							if (item.SwitchType == "Dimmer") {
								xhtm+='<td><div style="margin-left:50px; margin-top: 0.2em;" class="dimslider" id="slider" data-idx="' + item.idx + '" data-maxlevel="' + item.MaxDimLevel + '" data-svalue="' + item.LevelInt + '"></div></td>';
							}
							xhtm+=
										'\t    </tr>\n' +
										'\t    </table>\n' +
										'\t  </section>\n' +
										'\t</div>\n';
						}
            htmlcontent+=xhtm;
            jj+=1;
          }
        }); //scenes
        if (bHaveAddedDevider == true) {
          //close previous devider
          htmlcontent+='</div>\n';
        }
        if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
					htmlcontent+='\t    </table>\n';
        }
        
        //light devices
        jj=0;
        bHaveAddedDevider = false;
        $.each(data.result, function(i,item){
          if (
							((item.Type.indexOf('Light') == 0)&&(item.Favorite!=0))||
              ((item.Type.indexOf('Value') == 0) && (typeof item.SwitchType != 'undefined'))
              )
          {
            totdevices+=1;
            if (jj == 0)
            {
              //first time
              if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								if (htmlcontent!="") {
									htmlcontent+='<br>';
								}
								htmlcontent+='\t    <table class="mobileitem">\n';
								htmlcontent+='\t    <thead>\n';
								htmlcontent+='\t    <tr>\n';
								htmlcontent+='\t    		<th>Light/Switch Devices</th>\n';
								htmlcontent+='\t    		<th style="text-align:right"><a id="cLightSwitches" href="javascript:SwitchLayout(\'LightSwitches\')"><img src="images/next.png"></a></th>\n';
								htmlcontent+='\t    </tr>\n';
								htmlcontent+='\t    </thead>\n';
              }
              else {
								htmlcontent+='<h2>Light/Switch Devices:</h2>\n';
							}
            }
            if (jj % rowItems == 0)
            {
              //add devider
              if (bHaveAddedDevider == true) {
                //close previous devider
                htmlcontent+='</div>\n';
              }
              htmlcontent+='<div class="row divider">\n';
              bHaveAddedDevider=true;
            }
            
            var xhtm="";
						if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
							xhtm+=
									'\t    <tr id="light_' + item.idx +'">\n' +
									'\t      <td id="name">' + item.Name;
							xhtm+=
									 '</td>\n';
							var status=item.Status + " ";
							if (item.SwitchType == "Doorbell") {
								status+='<img src="images/door.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
							}
							else if (item.SwitchType == "X10 Siren") {
								status+='<img src="images/siren.png" height="16">';
							}
							else if (item.SwitchType == "Contact") {
									if (item.Status == 'Closed') {
										status+='<img src="images/contact.png" height="16">';
									}
									else {
										status+='<img src="images/contact_open.png" height="16">';
									}
							}
							else if (item.SwitchType == "Blinds") {
								if (item.Status == 'Closed') {
										status+='<img src="images/blinds48.png" title="Open Blinds" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
								else {
										status+='<img src="images/blinds.png" title="Close Blinds" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
							}
							else if (item.SwitchType == "Blinds Inverted") {
								if (item.Status == 'Closed') {
										status+='<img src="images/blinds48.png" title="Open Blinds" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
								else {
										status+='<img src="images/blinds.png" title="Close Blinds" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
							}               
							else if (item.SwitchType == "Dimmer") {
								var img="";
								if (
										(item.Status == 'On')||
										(item.Status == 'Chime')||
										(item.Status == 'Group On')||
										(item.Status.indexOf('Set ') == 0)
									 ) {
											img='<img src="images/dimmer.png" title="Turn Off" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
								else {
											img='<img src="images/dimmeroff.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
								status="<label id=\"statustext\">" + item.Status + "</label> <label id=\"dimimage\">" + img + "</label>";
							}
							else if (item.SwitchType == "Motion Sensor") {
								if (
										(item.Status == 'On')||
										(item.Status == 'Chime')||
										(item.Status == 'Group On')||
										(item.Status.indexOf('Set ') == 0)
									 ) {
											status+='<img src="images/motion.png" height="16">';
								}
								else {
											status+='<img src="images/motionoff.png" height="16">';
								}
							}
							else if (item.SwitchType == "Smoke Detector") {
									if (
											(item.Status == "Panic")||
											(item.Status == "On")
										 ) {
											status+='<img src="images/smoke.png" height="16">';
									}
									else {
											status+='<img src="images/smokeoff.png" height="16">';
									}
							}
							else {
								if (
										(item.Status == 'On')||
										(item.Status == 'Chime')||
										(item.Status == 'Group On')||
										(item.Status.indexOf('Set ') == 0)
									 ) {
											status+='<img src="images/lightbulb.png" title="Turn Off" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
								else {
											status+='<img src="images/lightbulboff.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
								}
							}
							xhtm+=
										'\t      <td id="status">' + status + '</td>\n' +
										'\t    </tr>\n';
							if (item.SwitchType == "Dimmer") {
								xhtm+='<tr>';
								xhtm+='<td colspan="2" style="border:0px solid red;">';
								xhtm+='<div style="margin-top: -11px; margin-left: 4px;" class="dimslider" id="slider" data-idx="' + item.idx + '" data-maxlevel="' + item.MaxDimLevel + '" data-svalue="' + item.LevelInt + '"></div>';
								xhtm+='</td>';
								xhtm+='</tr>';
							}
										
						}
						else {
							if (data.DashboardType==0) {
								xhtm='\t<div class="span4" id="light_' + item.idx +'">\n';
							}
							else if (data.DashboardType==1) {
								xhtm='\t<div class="span3" id="light_' + item.idx +'">\n';
							}
							xhtm+='\t  <section>\n';
							if (data.DashboardType==0) {
								xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							}
							else if (data.DashboardType==1) {
								xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							}
							xhtm+=
									'\t    <tr>\n' +
									'\t      <td id="name">' + item.Name + '</td>\n'+
									'\t      <td id="bigtext"></td>\n';
							if (item.SwitchType == "Doorbell") {
								xhtm+='\t      <td id="img"><img src="images/door48.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
							}
							else if (item.SwitchType == "X10 Siren") {
								if (
										(item.Status == 'On')||
										(item.Status == 'Chime')||
										(item.Status == 'Group On')||
										(item.Status == 'All On')
									 )
								{
										xhtm+='\t      <td id="img"><img src="images/siren-on.png" height="40"></td>\n';
								}
								else {
										xhtm+='\t      <td id="img"><img src="images/siren-off.png" height="40"></td>\n';
								}
							}
							else if (item.SwitchType == "Contact") {
								if (item.Status == 'Closed') {
									xhtm+='\t      <td id="img"><img src="images/contact48.png" height="40"></td>\n';
								}
								else {
									xhtm+='\t      <td id="img"><img src="images/contact48_open.png" height="40"></td>\n';
								}
							}
							else if (item.SwitchType == "Blinds") {
								if (item.Status == 'Closed') {
										xhtm+='\t      <td id="img"><img src="images/blinds48.png" title="Open Blinds" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
								}
								else {
										xhtm+='\t      <td id="img"><img src="images/blindsopen48.png" title="Close Blinds" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
								}
							}
							else if (item.SwitchType == "Blinds Inverted") {
								if (item.Status == 'Closed') {
										xhtm+='\t      <td id="img"><img src="images/blinds48.png" title="Open Blinds" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
								}
								else {
										xhtm+='\t      <td id="img"><img src="images/blindsopen48.png" title="Close Blinds" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
								}
							}               
							else if (item.SwitchType == "Dimmer") {
								if (
										(item.Status == 'On')||
										(item.Status == 'Chime')||
										(item.Status == 'Group On')||
										(item.Status.indexOf('Set ') == 0)
									 ) {
											xhtm+='\t      <td id="img"><img src="images/dimmer48-on.png" title="Turn Off" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
								}
								else {
											xhtm+='\t      <td id="img"><img src="images/dimmer48-off.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
								}
							}
							else if (item.SwitchType == "Motion Sensor") {
								if (
										(item.Status == 'On')||
										(item.Status == 'Chime')||
										(item.Status == 'Group On')||
										(item.Status.indexOf('Set ') == 0)
									 ) {
											xhtm+='\t      <td id="img"><img src="images/motion48-on.png" height="40"></td>\n';
								}
								else {
											xhtm+='\t      <td id="img"><img src="images/motion48-off.png" height="40"></td>\n';
								}
							}
							else if (item.SwitchType == "Smoke Detector") {
									if (
											(item.Status == "Panic")||
											(item.Status == "On")
										 ) {
											xhtm+='\t      <td id="img"><img src="images/smoke48on.png" height="40"></td>\n';
									}
									else {
											xhtm+='\t      <td id="img"><img src="images/smoke48off.png" height="40"></td>\n';
									}
							}
							else {
								if (
										(item.Status == 'On')||
										(item.Status == 'Chime')||
										(item.Status == 'Group On')||
										(item.Status.indexOf('Set ') == 0)
									 ) {
											xhtm+='\t      <td id="img"><img src="images/light-on.png" title="Turn Off" onclick="SwitchLight(' + item.idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
								}
								else {
											xhtm+='\t      <td id="img"><img src="images/light-off.png" title="Turn On" onclick="SwitchLight(' + item.idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
								}
							}
							xhtm+=
										'\t      <td id="status">' + item.Status + '</td>\n' +
										'\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n';
							if (item.SwitchType == "Dimmer") {
								xhtm+='<td><div style="margin-left:50px; margin-top: 0.2em;" class="dimslider" id="slider" data-idx="' + item.idx + '" data-maxlevel="' + item.MaxDimLevel + '" data-svalue="' + item.LevelInt + '"></div></td>';
							}
							xhtm+=
										'\t    </tr>\n' +
										'\t    </table>\n' +
										'\t  </section>\n' +
										'\t</div>\n';
						}
            htmlcontent+=xhtm;
            jj+=1;
          }
        }); //light devices
        if (bHaveAddedDevider == true) {
          //close previous devider
          htmlcontent+='</div>\n';
        }
        if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
					htmlcontent+='\t    </table>\n';
        }

        //Temperature Sensors
        jj=0;
        bHaveAddedDevider = false;
        $.each(data.result, function(i,item){
          if (
                ((typeof item.Temp != 'undefined')||(typeof item.Humidity != 'undefined')||(typeof item.Chill != 'undefined')) &&
                (item.Favorite!=0)
              )
          {
            totdevices+=1;
            if (jj == 0)
            {
              //first time
              if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								if (htmlcontent!="") {
									htmlcontent+='<br>';
								}
								htmlcontent+='\t    <table class="mobileitem">\n';
								htmlcontent+='\t    <thead>\n';
								htmlcontent+='\t    <tr>\n';
								htmlcontent+='\t    		<th>Temperature Sensors</th>\n';
								htmlcontent+='\t    		<th style="text-align:right"><a id="cTemperature" href="javascript:SwitchLayout(\'Temperature\')"><img src="images/next.png"></a></th>\n';
								htmlcontent+='\t    </tr>\n';
								htmlcontent+='\t    </thead>\n';
              }
              else {
								htmlcontent+='<h2>Temperature Sensors:</h2>\n';
							}
            }
            if (jj % rowItems == 0)
            {
              //add devider
              if (bHaveAddedDevider == true) {
                //close previous devider
                htmlcontent+='</div>\n';
              }
              htmlcontent+='<div class="row divider">\n';
              bHaveAddedDevider=true;
            }
            var xhtm="";
						if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
							xhtm+=
									'\t    <tr id="temp_' + item.idx +'">\n' +
									'\t      <td id="name">' + item.Name + '</td>\n';
							var status="";
							var bHaveBefore=false;
							if (typeof item.Temp != 'undefined') {
									 status+=item.Temp + '° C';
									 bHaveBefore=true;
							}
							if (typeof item.Chill != 'undefined') {
								if (bHaveBefore) {
									status+=', ';
								}
								status+='Chill: ' + item.Chill + '° C';
								bHaveBefore=true;
							}
							if (typeof item.Humidity != 'undefined') {
								if (bHaveBefore==true) {
									status+=', ';
								}
								status+=item.Humidity + ' %';
							}
							if (typeof item.HumidityStatus != 'undefined') {
								status+=' (' + item.HumidityStatus + ')';
							}
							if (typeof item.Barometer != 'undefined') {
								status+='<br>' + item.Barometer + ' hPa';
							}
							if (typeof item.ForecastStr != 'undefined') {
								status+=', Prediction: ' + item.ForecastStr;
							}
							xhtm+=
										'\t      <td id="status">' + status + '</td>\n' +
										'\t    </tr>\n';
						}
						else {
							if (data.DashboardType==0) {
								xhtm='\t<div class="span4" id="temp_' + item.idx +'">\n';
							}
							else if (data.DashboardType==1) {
								xhtm='\t<div class="span3" id="temp_' + item.idx +'">\n';
							}
							xhtm+='\t  <section>\n';
							xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							xhtm+=
										'\t    <tr>\n';
							if (item.HaveTimeout==false) {			
								xhtm+='\t      <td id="name">' + item.Name + '</td>\n';
							}
							else {
								xhtm+='\t      <td id="name" style="background-color: #DF2D3A;">' + item.Name + '</td>\n';
							}
							xhtm+='\t      <td id="bigtext">';
							var bigtext="";
							if (typeof item.Temp != 'undefined') {
								bigtext=item.Temp + '\u00B0';
							}
							if (typeof item.Humidity != 'undefined') {
								if (bigtext!="") {
									bigtext+=' / ';
								}
								bigtext+=item.Humidity + '%';
							}
							if (typeof item.Chill != 'undefined') {
								if (bigtext!="") {
									bigtext+=' / ';
								}
								bigtext+=item.Chill + '\u00B0';
							}
							xhtm+=bigtext+'</td>\n';
							xhtm+='\t      <td id="img"><img src="images/';
							if (typeof item.Temp != 'undefined') {
								xhtm+=GetTemp48Item(item.Temp);
							}
							else {
								xhtm+=GetTemp48Item(item.Chill);
							}
							xhtm+='" height="40"></td>\n' +
									'\t      <td id="status">';
							var bHaveBefore=false;
							if (typeof item.Temp != 'undefined') {
									 xhtm+=item.Temp + '° C';
									 bHaveBefore=true;
							}
							if (typeof item.Chill != 'undefined') {
								if (bHaveBefore) {
									xhtm+=', ';
								}
								xhtm+='Chill: ' + item.Chill + '° C';
								bHaveBefore=true;
							}
							if (typeof item.Direction != 'undefined') {
								xhtm+='<br>' + item.Direction + ' ' + item.DirectionStr + ', Speed: ' + item.Speedms + ' ms, Gust: ' + item.Gustms + ' ms\n';
							}
							if (typeof item.Humidity != 'undefined') {
								if (bHaveBefore==true) {
									xhtm+=', ';
								}
								xhtm+='Humidity: ' + item.Humidity + ' %';
							}
							if (typeof item.HumidityStatus != 'undefined') {
								xhtm+=' (' + item.HumidityStatus + ')';
							}
							if (typeof item.Barometer != 'undefined') {
								xhtm+='<br>' + item.Barometer + ' hPa';
							}
							if (typeof item.ForecastStr != 'undefined') {
								xhtm+=', Prediction: ' + item.ForecastStr;
							}
							xhtm+=
									'</td>\n' +
									'\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n' +
							'\t    </tr>\n' +
							'\t    </table>\n' +
							'\t  </section>\n' +
							'\t</div>\n';
						}
            htmlcontent+=xhtm;
            jj+=1;
          }
        }); //temp devices
        if (bHaveAddedDevider == true) {
          //close previous devider
          htmlcontent+='</div>\n';
        }
        if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
					htmlcontent+='\t    </table>\n';
        }

        //Weather Sensors
        jj=0;
        bHaveAddedDevider = false;
        $.each(data.result, function(i,item){
          if (
                ( (typeof item.Rain != 'undefined') || (typeof item.UVI != 'undefined') || (typeof item.Direction != 'undefined') || (typeof item.Barometer != 'undefined') ) &&
                (item.Favorite!=0)
              )
          {
            totdevices+=1;
            if (jj == 0)
            {
              //first time
              if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								if (htmlcontent!="") {
									htmlcontent+='<br>';
								}
								htmlcontent+='\t    <table class="mobileitem">\n';
								htmlcontent+='\t    <thead>\n';
								htmlcontent+='\t    <tr>\n';
								htmlcontent+='\t    		<th>Weather Sensors</th>\n';
								htmlcontent+='\t    		<th style="text-align:right"><a id="cWeather" href="javascript:SwitchLayout(\'Weather\')"><img src="images/next.png"></a></th>\n';
								htmlcontent+='\t    </tr>\n';
								htmlcontent+='\t    </thead>\n';
              }
              else {
								htmlcontent+='<h2>Weather Sensors:</h2>\n';
							}
            }
            if (jj % rowItems == 0)
            {
              //add devider
              if (bHaveAddedDevider == true) {
                //close previous devider
                htmlcontent+='</div>\n';
              }
              htmlcontent+='<div class="row divider">\n';
              bHaveAddedDevider=true;
            }
            var xhtm="";
						if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
							xhtm+=
									'\t    <tr id="weather_' + item.idx +'">\n' +
									'\t      <td id="name">' + item.Name + '</td>\n';
							var status="";
							if (typeof item.Rain != 'undefined') {
								status+=item.Rain + ' mm';
								if (typeof item.RainRate != 'undefined') {
									if (item.RainRate!=0) {
										status+=', Rate: ' + item.RainRate + ' mm/h';
									}
								}
							}
							else if (typeof item.UVI != 'undefined') {
								status+=item.UVI + ' UVI';
							}
							else if (typeof item.Direction != 'undefined') {
								status=item.Direction + ' ' + item.DirectionStr + ', Speed: ' + item.Speedms + ' ms, Gust: ' + item.Gustms + ' ms';
							}
							else if (typeof item.Barometer != 'undefined') {
								status=item.Barometer + ' hPa, Prediction: ' + item.ForecastStr;
              }
							xhtm+=
										'\t      <td id="status">' + status + '</td>\n' +
										'\t    </tr>\n';
						}
						else {
							if (data.DashboardType==0) {
								xhtm='\t<div class="span4" id="weather_' + item.idx +'">\n';
							}
							else if (data.DashboardType==1) {
								xhtm='\t<div class="span3" id="weather_' + item.idx +'">\n';
							}
							xhtm+='\t  <section>\n';
							xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							xhtm+='\t    <tr>\n';
							if (item.HaveTimeout==false) {			
								xhtm+='\t      <td id="name">' + item.Name + '</td>\n';
							}
							else {
								xhtm+='\t      <td id="name" style="background-color: #DF2D3A;">' + item.Name + '</td>\n';
							}
							xhtm+='\t      <td id="bigtext">';
							if (typeof item.Barometer != 'undefined') {
								xhtm+=item.Barometer + ' hPa';
							}
							else if (typeof item.Rain != 'undefined') {
								xhtm+=item.Rain + ' mm';
							}
							else if (typeof item.UVI != 'undefined') {
								xhtm+=item.UVI + ' UVI';
							}
							else if (typeof item.Direction != 'undefined') {
								xhtm+=item.DirectionStr + '/' + item.Speedms + ' ms';
							}
							xhtm+='</td>\n';
							xhtm+='\t      <td id="img"><img src="images/';
							if (typeof item.Rain != 'undefined') {
								xhtm+='rain48.png" height="40"></td>\n' +
								'\t      <td id="status">' + item.Rain + ' mm';
								if (typeof item.RainRate != 'undefined') {
									if (item.RainRate!=0) {
										xhtm+=', Rate: ' + item.RainRate + ' mm/h';
									}
								}
							}
							else if (typeof item.UVI != 'undefined') {
								xhtm+='uv48.png" height="40"></td>\n' +
								'\t      <td id="status">' + item.UVI + ' UVI';
								if (typeof item.Temp!= 'undefined') {
									xhtm+=', Temp: ' + item.Temp + '° C';
								}
							}
							else if (typeof item.Direction != 'undefined') {
								xhtm+='Wind' + item.DirectionStr + '.png" height="40"></td>\n' +
								'\t      <td id="status">' + item.Direction + ' ' + item.DirectionStr + ', Speed: ' + item.Speedms + ' ms, Gust: ' + item.Gustms + ' ms<br>\n';
								if (typeof item.Temp != 'undefined') {
									xhtm+='Temp: ' + item.Temp + '° C, ';
								}
								xhtm+='Chill: ' + item.Chill + '° C';
							}
							else if (typeof item.Barometer != 'undefined') {
								xhtm+='baro48.png" height="40"></td>\n' +
								'\t      <td id="status">' + item.Barometer + ' hPa, Prediction: ' + item.ForecastStr;
              }
							xhtm+=
									'</td>\n' +
									'\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n' +
							'\t    </tr>\n' +
							'\t    </table>\n' +
							'\t  </section>\n' +
							'\t</div>\n';
						}
            htmlcontent+=xhtm;
            jj+=1;
          }
        }); //weather devices
        if (bHaveAddedDevider == true) {
          //close previous devider
          htmlcontent+='</div>\n';
        }
        if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
					htmlcontent+='\t    </table>\n';
        }

        //security devices
        jj=0;
        bHaveAddedDevider = false;
        $.each(data.result, function(i,item){
          if ((item.Type.indexOf('Security') == 0)&&(item.Favorite!=0))
          {
            totdevices+=1;
            if (jj == 0)
            {
              //first time
              if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								if (htmlcontent!="") {
									htmlcontent+='<br>';
								}
								htmlcontent+='\t    <table class="mobileitem">\n';
								htmlcontent+='\t    <thead>\n';
								htmlcontent+='\t    <tr>\n';
								htmlcontent+='\t    		<th>Security Devices</th>\n';
								htmlcontent+='\t    		<th style="text-align:right"><a id="cLightSwitches" href="javascript:SwitchLayout(\'LightSwitches\')"><img src="images/next.png"></a></th>\n';
								htmlcontent+='\t    </tr>\n';
								htmlcontent+='\t    </thead>\n';
              }
              else {
								htmlcontent+='<h2>Security Devices:</h2>\n';
							}
            }
            if (jj % rowItems == 0)
            {
              //add devider
              if (bHaveAddedDevider == true) {
                //close previous devider
                htmlcontent+='</div>\n';
              }
              htmlcontent+='<div class="row divider">\n';
              bHaveAddedDevider=true;
            }
            var xhtm="";
						if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
							xhtm+=
									'\t    <tr id="security_' + item.idx +'">\n' +
									'\t      <td id="name">' + item.Name + '</td>\n';
							var status=item.Status;
							xhtm+=
										'\t      <td id="status">' + status + '</td>\n' +
										'\t    </tr>\n';
						}
						else {
							if (data.DashboardType==0) {
								xhtm='\t<div class="span4" id="security_' + item.idx +'">\n';
							}
							else if (data.DashboardType==1) {
								xhtm='\t<div class="span3" id="security_' + item.idx +'">\n';
							}
							xhtm+='\t  <section>\n';
							if (data.DashboardType==0) {
										xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							}
							else if (data.DashboardType==1) {
										xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							}
							xhtm+=
										'\t    <tr>\n' +
										'\t      <td id="name">' + item.Name + '</td>\n' +
										'\t      <td id="bigtext"></td>\n';

							if (item.SubType.indexOf('remote') > 0) {
								xhtm+='\t      <td id="img"><img src="images/remote48.png" height="40"></td>\n';
							}
							else if (item.SwitchType == "Smoke Detector") {
									if (
											(item.Status == "Panic")||
											(item.Status == "On")
										 ) {
											xhtm+='\t      <td id="img"><img src="images/smoke48on.png" height="40"></td>\n';
									}
									else {
											xhtm+='\t      <td id="img"><img src="images/smoke48off.png" height="40"></td>\n';
									}
							}
							else {
								if ((item.Status.indexOf('Alarm') >= 0)||(item.Status.indexOf('Tamper') >= 0)) {
									xhtm+='\t      <td id="img"><img src="images/alarm48.png" height="40"></td>\n';
								}
								else {
									xhtm+='\t      <td id="img"><img src="images/security48.png" height="40"></td>\n';
								}
							}
							xhtm+=
										'\t      <td id="status">' + item.Status + '</td>\n' +
										'\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n' +
										'\t    </tr>\n' +
										'\t    </table>\n' +
										'\t  </section>\n' +
										'\t</div>\n';
						}
            htmlcontent+=xhtm;
            jj+=1;
          }
        }); //security devices
        if (bHaveAddedDevider == true) {
          //close previous devider
          htmlcontent+='</div>\n';
        }
        if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
					htmlcontent+='\t    </table>\n';
        }
        
        //Utility Sensors
        jj=0;
        bHaveAddedDevider = false;
        $.each(data.result, function(i,item){
          if (
                ( (typeof item.Counter != 'undefined') || (item.Type == "Current") || (item.Type == "Energy") || (item.Type == "Current/Energy")) &&
                (item.Favorite!=0)
              )
          {
            totdevices+=1;
            if (jj == 0)
            {
              //first time
              if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
								if (htmlcontent!="") {
									htmlcontent+='<br>';
								}
								htmlcontent+='\t    <table class="mobileitem">\n';
								htmlcontent+='\t    <thead>\n';
								htmlcontent+='\t    <tr>\n';
								htmlcontent+='\t    		<th>Utility Sensors</th>\n';
								htmlcontent+='\t    		<th style="text-align:right"><a id="cUtility" href="javascript:SwitchLayout(\'Utility\')"><img src="images/next.png"></a></th>\n';
								htmlcontent+='\t    </tr>\n';
								htmlcontent+='\t    </thead>\n';
              }
              else {
								htmlcontent+='<h2>Utility Sensors:</h2>\n';
							}
            }
            if (jj % rowItems == 0)
            {
              //add devider
              if (bHaveAddedDevider == true) {
                //close previous devider
                htmlcontent+='</div>\n';
              }
              htmlcontent+='<div class="row divider">\n';
              bHaveAddedDevider=true;
            }
            var xhtm="";
						if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
							xhtm+=
									'\t    <tr id="utility_' + item.idx +'">\n' +
									'\t      <td id="name">' + item.Name + '</td>\n';
							var status="";
							if (typeof item.Counter != 'undefined') {
								if (data.DashboardType==0) {
									status=item.Counter + ', Today: ' + item.CounterToday;
								}
								else {
									status=item.Counter + ', T: ' + item.CounterToday;
								}
							}
							else if ((item.Type == "Current") || (item.Type == "Current/Energy")){
								status=item.Data;
							}
							else if (item.Type == "Energy") {
								status=item.Data;
							}
							if (typeof item.Usage != 'undefined') {
								if (data.DashboardType==0) {
									status+=", Usage: " + item.Usage;
								}
								else {
									status+=", U: " + item.Usage;
								}
							}
							if (typeof item.CounterDeliv != 'undefined') {
								if (item.CounterDeliv!=0) {
									status+='<br>R: ';
									if (data.DashboardType==0) {
										status+=item.CounterDeliv + ', Today: ' + item.CounterDelivToday;
										status+=", Actual: " + item.UsageDeliv;
									}
									else {
										status+=item.CounterDeliv + ', T: ' + item.CounterDelivToday;
										status+=", A: " + item.UsageDeliv;
									}
								}
							}
							xhtm+=
										'\t      <td id="status">' + status + '</td>\n' +
										'\t    </tr>\n';
						}
						else {
							if (data.DashboardType==0) {
								xhtm='\t<div class="span4" id="utility_' + item.idx +'">\n';
							}
							else if (data.DashboardType==1) {
								xhtm='\t<div class="span3" id="utility_' + item.idx +'">\n';
							}
							xhtm+='\t  <span>\n';
							xhtm+='\t    <table id="itemtablesmall" border="0" cellpadding="0" cellspacing="0">\n';
							xhtm+='\t    <tr>\n';
							if (item.HaveTimeout==false) {			
								xhtm+='\t      <td id="name">' + item.Name + '</td>\n';
							}
							else {
								xhtm+='\t      <td id="name" style="background-color: #DF2D3A;">' + item.Name + '</td>\n';
							}
							xhtm+='\t      <td id="bigtext">';
							if (typeof item.Usage != 'undefined') {
								xhtm+=item.Usage;
							}
							xhtm+='</td>\n';
							xhtm+='\t      <td id="img"><img src="images/';
							var status="";
							if (typeof item.Counter != 'undefined') {
								xhtm+='counter.png" height="40"></td>\n';
								if (data.DashboardType==0) {
									status=item.Counter + ', Today: ' + item.CounterToday;
								}
								else {
									status=item.Counter + ', T: ' + item.CounterToday;
								}
							}
							else if ((item.Type == "Current") || (item.Type == "Current/Energy")) {
								xhtm+='current48.png" height="40"></td>\n';
								status=item.Data;
							}
							else if (item.Type == "Energy") {
								xhtm+='current48.png" height="40"></td>\n';
								status=item.Data;
							}
							if (typeof item.Usage != 'undefined') {
								if (data.DashboardType==0) {
									status+=", Usage: " + item.Usage;
								}
								else {
									status+=", U: " + item.Usage;
								}
							}
							if (typeof item.CounterDeliv != 'undefined') {
								if (item.CounterDeliv!=0) {
									status+='<br>';
									if (data.DashboardType==0) {
										status+='Return: ' + item.CounterDeliv + ', Today: ' + item.CounterDelivToday;
										status+=", Actual: " + item.UsageDeliv;
									}
									else {
										status+='R: ' + item.CounterDeliv + ', T: ' + item.CounterDelivToday;
										status+=", A: " + item.UsageDeliv;
									}
								}
							}
							
							xhtm+=
									'\t      <td id="status">' + status + '</td>\n' +
									'\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n' +
							'\t    </tr>\n' +
							'\t    </table>\n' +
							'\t  </span>\n' +
							'\t</div>\n';
						}
            htmlcontent+=xhtm;
            jj+=1;
          }
        }); //Utility devices
        if (bHaveAddedDevider == true) {
          //close previous devider
          htmlcontent+='</div>\n';
        }
        if ((data.DashboardType==2)||($.myglobals.ismobile==true)) {
					htmlcontent+='\t    </table>\n';
        }

      }
     }
  });

	if (htmlcontent == "")
	{
    htmlcontent=
      '<h2>No favorite devices defined ... (Or communication Lost!)</h2><br>\n' +
      'If this is your first time here, please setup your <a href="javascript:SwitchLayout(\'Hardware\')">hardware</a>, and add some <a href="javascript:SwitchLayout(\'Devices\')">devices</a>.';
	}
	else {
		htmlcontent+="<br>";
	}
	
	var suntext="";
  if (sunRise!="")
  {
    suntext+='<div id="timesun">' + ServerTime + ', SunRise: ' + sunRise + ', SunSet: ' + sunSet + '</div><br>\n';
  }
  $('#dashcontent').html(suntext+htmlcontent);

	//Create Dimmer Sliders
	$('#dashcontent .dimslider').slider({
		//Config
		range: "min",
		min: 1,
		max: 16,
		value: 5,

		//Slider Events
		create: function(event,ui ) {
			$( this ).slider( "option", "max", $( this ).data('maxlevel'));
			$( this ).slider( "value", $( this ).data('svalue')+1 );
		},
		slide: function(event, ui) { //When the slider is sliding
			clearInterval($.setDimValue);
			var maxValue=$( this ).slider( "option", "max");
			var fPercentage=0;
			if (ui.value!=1) {
				fPercentage=parseInt((100.0/(maxValue-1))*((ui.value-1)));
			}
			var idx=$( this ).data('idx');
			id="#dashcontent #light_" + idx;
			var obj=$(id);
			if (typeof obj != 'undefined') {
				var img="";
				var status="";
				if (($.myglobals.DashboardType==2)||($.myglobals.ismobile==true)) {
					if (fPercentage==0)
					{
						status="Off ";
						img='<img src="images/dimmeroff.png" title="Turn On" onclick="SwitchLight(' + idx + ',\'On\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
					}
					else {
						status="Set Level: " + fPercentage + " % ";
						img='<img src="images/dimmer.png" title="Turn Off" onclick="SwitchLight(' + idx + ',\'Off\',ShowFavorites);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="16">';
					}
					if ($(id + " #statustext").html()!=status) {
						$(id + " #statustext").html(status);
					}
					if ($(id + " #dimimage").html()!=img) {
						$(id + " #dimimage").html(img);
					}
				}
				else {
					if (fPercentage==0)
					{
						img='<img src="images/dimmer48-off.png" title="Turn On" onclick="SwitchLight(' + idx + ',\'On\',RefreshLights);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
						status="Off";
					}
					else {
						img='<img src="images/dimmer48-on.png" title="Turn Off" onclick="SwitchLight(' + idx + ',\'Off\',RefreshLights);" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
						status="Set Level: " + fPercentage + " %";
					}
					if ($(id + " #img").html()!=img) {
						$(id + " #img").html(img);
					}
					if ($(id + " #status").html()!=status) {
						$(id + " #status").html(status);
					}
				}
			}
			$.setDimValue = setInterval(function() { SetDimValue(idx,ui.value); }, 500);
		}
	});
	ResizeDimSliders();

	if ($.myglobals.ismobile==false) {
		$("#dashcontent .span4").draggable({
				drag: function() {
					clearInterval($.myglobals.refreshTimer);
					$.devIdx=$(this).attr("id");
					$(this).css("z-index", 2);
				},
				revert: true
		});
		$("#dashcontent .span4").droppable({
				drop: function() {
					var myid=$(this).attr("id");
					var parts1 = myid.split('_');
					var parts2 = $.devIdx.split('_');
					if (parts1[0]!=parts2[0]) {
						alert('Only possible between Sensors of the same kind!');
						$.myglobals.refreshTimer = setInterval(ShowFavorites, 10000);
					} else {
					
						$.ajax({
							 url: "json.htm?type=command&param=switchdeviceorder&idx1=" + parts1[1] + "&idx2=" + parts2[1],
							 async: false, 
							 dataType: 'json',
							 success: function(data) {
									ShowFavorites();
							 }
						});
					}
				}
		});
		$("#dashcontent .span3").draggable({
				drag: function() {
					clearInterval($.myglobals.refreshTimer);
					$.devIdx=$(this).attr("id");
					$(this).css("z-index", 2);
				},
				revert: true
		});
		$("#dashcontent .span3").droppable({
				drop: function() {
					var myid=$(this).attr("id");
					var parts1 = myid.split('_');
					var parts2 = $.devIdx.split('_');
					if (parts1[0]!=parts2[0]) {
						alert('Only possible between Sensors of the same kind!');
						$.myglobals.refreshTimer = setInterval(ShowFavorites, 10000);
					} else {
					
						$.ajax({
							 url: "json.htm?type=command&param=switchdeviceorder&idx1=" + parts1[1] + "&idx2=" + parts2[1],
							 async: false, 
							 dataType: 'json',
							 success: function(data) {
									ShowFavorites();
							 }
						});
					}
				}
		});
	}
  $.myglobals.refreshTimer = setInterval(RefreshFavorites, 10000);
}

function ResizeDimSliders()
{
	var width=$(".span4").width()-70;
	$("#dashcontent .span4 .dimslider").width(width);
	width=$(".span3").width()-70;
	$("#dashcontent .span3 .dimslider").width(width);
	width=$(".mobileitem").width()-23;
	$("#dashcontent .mobileitem .dimslider").width(width);
}

$(document).ready(function() {
	if( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ) {
		$.myglobals.ismobile=true;
	}
	
	$(window).resize(function() { ResizeDimSliders(); });
  ShowFavorites();
} );
</script>