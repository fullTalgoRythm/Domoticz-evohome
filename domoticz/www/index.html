<!DOCTYPE html>
<html> 
<head>
		<meta charset="utf-8">
		<title>Domoticz</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> 
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />

		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" href="images/iphone-icon.png"/>

		<!-- iPhone -->
		<link href="images/startup/apple-touch-startup-image-320x460.png" 
			media="(device-width: 320px)" 
			rel="apple-touch-startup-image">
		
		<!-- iPhone (Retina) -->
		<link href="images/startup/apple-touch-startup-image-640x920.png" 
			media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)" 
			rel="apple-touch-startup-image">

		<!-- iPad (portrait) -->
		<link href="images/startup/apple-touch-startup-image-768x1004.png" 
					media="(device-width: 768px) and (orientation: portrait)" 
					rel="apple-touch-startup-image">

		<!-- iPad (landscape) -->
		<link href="images/startup/apple-touch-startup-image-1024x748.png" 
					media="(device-width: 768px) and (orientation: landscape)" 
					rel="apple-touch-startup-image">      

		<!--iPad (Retina, portrait) -->
		<link href="images/startup/apple-touch-startup-image-1536x2008.png" 
					media="(device-width: 768px) 
					 and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" 
					rel="apple-touch-startup-image">

		<!-- iPad (Retina, landscape) -->
		<link href="images/startup/apple-touch-startup-image-2048x1496.png" 
					media="(device-width: 768px) 
					 and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" 
					rel="apple-touch-startup-image"> 

        <link rel="stylesheet" href="css/bootstrap.css">
        <link href="css/bootstrap-responsive.css" rel="stylesheet" media="screen">
        <link type="text/css" rel="stylesheet" href="css/ui-darkness/jquery-ui-1.10.1.custom.min.css" />
		<link type="text/css" rel="stylesheet" href="css/demo_table_jui.css" />
		<link type="text/css" rel="stylesheet" href="css/TableTools.css" />
		<link type="text/css" rel="stylesheet" href="css/jquery.uix.multiselect.css" />
        <link type="text/css" rel="stylesheet" href="css/style.css" />

        <script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/jquery.i18n.js"></script>
		<script src="js/jquery.i18n.messages.js"></script>
		<script src="js/jquery.i18n.fallbacks.js"></script>
		<script src="js/jquery.i18n.parser.js"></script>
		<script src="js/jquery.i18n.emitter.js"></script>
		<script src="js/jquery.i18n.language.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/jquery-ui-1.10.1.custom.min.js"></script>
		<script src="js/jquery.ui.touch-punch.min.js"></script>
		<script src="js/jquery.uix.multiselect.min.js"></script>
		<script type="text/javascript" src="js/noty/jquery.noty.js"></script>
        <script type="text/javascript" src="js/noty/layouts/top.js"></script>
        <script type="text/javascript" src="js/noty/layouts/topRight.js"></script>
        <script type="text/javascript" src="js/noty/themes/default.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/jquery.dataTables.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/ZeroClipboard.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/TableTools.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/date.format.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/highcharts.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/highcharts-more.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/modules/exporting.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/themes/dark-blue.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/domoticz.js"></script>

		<link rel="localization" hreflang="de" href="i18n/domoticz-de.json" type="application/l10n+json"/>
		<link rel="localization" hreflang="en" href="i18n/domoticz-en.json" type="application/l10n+json"/>
		<link rel="localization" hreflang="es" href="i18n/domoticz-es.json" type="application/l10n+json"/>
		<link rel="localization" hreflang="fr" href="i18n/domoticz-fr.json" type="application/l10n+json"/>
		<link rel="localization" hreflang="nl" href="i18n/domoticz-nl.json" type="application/l10n+json"/>
		<link rel="localization" hreflang="it" href="i18n/domoticz-it.json" type="application/l10n+json"/>
		<link rel="localization" hreflang="sv" href="i18n/domoticz-sv.json" type="application/l10n+json"/>
<script type="text/javascript" charset="utf-8" id="init-code">

function logEvent(event) {
  //console.log(event.type);
}

function NotifyCacheRefresh()
{
	generate_noty('information', '<b>' + $.i18n('Browser Cache is being refreshed') + '...</b><br>' + $.i18n('Please standby') + '...', 5000);
}

function RefreshMain()
{
	window.location.reload();
}

function CheckForUpdate(showdialog) {
	$.ajax({
		 url: "json.htm?type=command&param=checkforupdate&forced=" + showdialog,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			var urights=data.statuscode;
			var bDisplayLogout=false;
			if (urights!=3) {
				bDisplayLogout=true;
			}
			else {
				bDisplayLogout=false;
				urights=2;
			}
			window.my_config =
			{
				userrights : urights
			};
			
			if (bDisplayLogout) {
				if (window.my_config.userrights!=2) {
					//no setup menu
					$("#dLogout").show();
					$("#mLogout").show();
					$("#dLogoutSetup").hide();
					$("#mLogoutSetup").hide();
				}
				else {
					$("#dLogout").hide();
					$("#mLogout").hide();
					$("#dLogoutSetup").show();
					$("#mLogoutSetup").show();
				}
			}
			else {
				$("#dLogout").hide();
				$("#mLogout").hide();
				$("#dLogoutSetup").hide();
				$("#mLogoutSetup").hide();
			}
			
			if (window.my_config.userrights!=2) {
				$("#setupmenu").hide();
			}
			
			//data.HaveUpdate=true;
			if (data.HaveUpdate == true) {
				$("#mUpdate").show();
				$("#mCheckUpdate").hide();
				if (showdialog) {
					var bValid = false;
					bValid=(confirm($.i18n("Update Available !... Update Now?"))==true);
					if (bValid) {
						SwitchLayout('Update');
					}
				}
				else {
					var msgtxt=$.i18n('A new version of Domoticz is Available!...<br>Use the Setup tab to update.');
					//msgtxt+=
						//'<br>Version: <b>1923</b>, Latest Changes: <b>Click Here</b>'+
						//'<br><center><b>Update Now</b></center>';
					generate_noty('success', msgtxt, false);
				}
			}
			else
			{
				if (data.IsSupported==false) {
					$("#dUpdate").hide();
					$("#mUpdate").hide();
					$("#mCheckUpdate").hide();
				}
				else {
					$("#mUpdate").hide();
					$("#mCheckUpdate").show();
				}
				if (showdialog) {
					alert($.i18n("No Update Available !..."));
				}
			}
		 },
		 error: function(){
				$("#mUpdate").hide();
				$("#mCheckUpdate").show();
				if (showdialog) {
					alert($.i18n("Error communicating to server!"));
				}
		 }     
	});
}

function TransferDevice(idx,backfunction)
{
	$.ajax({
		 url: "json.htm?type=gettransfers&idx=" + idx,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
				if (typeof data.result == 'undefined') 
				{
					alert($.i18n('No devices to Transfer too!'));
					return;
				}
				$("#dialog-transferdevice #newdevice").html("");
				
				$.each(data.result, function(i,item){
					var option = $('<option />');
					option.attr('value', item.idx).text(item.Name);
					$("#dialog-transferdevice #newdevice").append(option);
				});
				$.devIdx = idx;
				$.backfunction=backfunction;
        $( "#dialog-transferdevice" ).dialog( "open" );
		 }
	});
}

$(document).ready(function() {
	$.myglobals = {
		actlayout : "",
		prevlayout : "",
		ismobile: false,
		ismobileint: false,
		windscale: 1.0,
		windsign: "m/s",
		historytype : 1
	};
	
	if( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ) {
		$.myglobals.ismobile=true;
		$.myglobals.ismobileint=true;
	}

	var matched = matchua( navigator.userAgent );
	var browser = {};
	if ( matched.browser ) {
		browser[ matched.browser ] = true;
		browser.version = matched.version;
	}
	
	if ( browser.msie ) {
		var bVersion=parseFloat(browser.version);
		if (bVersion < 10.0) {
			alert($.i18n('This Application is is designed for Internet Explorer version 10+!\nPlease upgrade your browser!'));
		}
	}

	$("#appversion").click( function( e ) {
		e.preventDefault();
		$.myglobals.historytype=1;
		SwitchLayout('History');
	});
	
	//Highcharts.getOptions().exporting.buttons.contextButton.menuItems.push({
	//	text: 'Download CSV',
	//	onclick: function () {
	//		ExportChart2CSV(this);
	//	}
	//});

	EnableDisableTabs();
	
	window.myglobals=$.myglobals;

    $( "#dialog-transferdevice" ).dialog({
          autoOpen: false,
          width: 380,
          height: 160,
          modal: true,
          resizable: false,
          buttons: {
              "OK": function() {
                  var bValid = true;
                  $( this ).dialog( "close" );
                  
									var NewDeviceIdx=$("#dialog-transferdevice #newdevice option:selected").val();
									if (typeof NewDeviceIdx == 'undefined') {
										alert($.i18n('No New Device Selected!'));
										return ;
									}
									$.ajax({
										 url: "json.htm?type=transferdevice&idx=" + $.devIdx + "&newidx=" + NewDeviceIdx,
										 async: false, 
										 dataType: 'json',
										 success: function(data) {
											if (data.status == 'OK') {
												$.backfunction();
											}
											else {
												ShowNotify($.i18n('Problem Transfering Device!'), 2500, true);
											}
										 },
										 error: function(){
												HideNotify();
												ShowNotify($.i18n('Problem Transfering Device!'), 2500, true);
										 }     
									});
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });
    
    CheckForUpdate(false);

	SwitchLayout(GetLayoutFromURL());

	window.onhashchange = function(){
		if($.myglobals.layoutFull != GetLayoutFromURL()) {
			SwitchLayout(GetLayoutFromURL());
		}
	}; 
} );

</script>

</head class="homepage">
<body>
	<div id="globaldaylog" style="display:none;">
	  <h2 data-i18n="Day">Day</h2>
	  <div id="globaldaygraph" style="height: 300px;"></div>
	  <br>
	  <h2 data-i18n="Month">Month</h2>
	  <div id="globalmonthgraph" style="height: 300px;"></div>
	  <br>
	  <h2 data-i18n="Year">Year</h2>
	  <div id="globalyeargraph" style="height: 300px;"></div>
	</div>
	<div id="lightlog" style="display:none;">
		<table class="display" id="lighttable" border="0" cellpadding="0" cellspacing="0" width="100%">
				<thead>
						<tr>
								<th width="140" align="left" data-i18n="Date">Date</th>
								<th data-i18n="Data">Data</th>
						</tr>
				</thead>
		</table>
		<table id="updelclr" border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td>
				</td>
				<td align="right">
					<a class="btnstyle3" id="clearlog" onclick="ClearLightLog();" data-i18n="Clear">Clear</a>
				</td>
			</tr>
		</table>
		<br>
		<div id="lightgraph" style="height: 200px;"></div>
	</div>
	<div id="editnotifications" style="display:none;">
			<table class="display" id="notificationtable" border="0" cellpadding="0" cellspacing="0" width="100%">
					<thead>
							<tr>
									<th width="120" align="left" data-i18n="Type">Type</th>
									<th align="left" data-i18n="When">When</th>
							</tr>
					</thead>
			</table>
			<table id="updelclr" border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td>
						<a class="btnstyle3-dis" id="notificationupdate" data-i18n="Update">Update</a>&nbsp;&nbsp;&nbsp;
						<a class="btnstyle3-dis" id="notificationdelete" data-i18n="Delete">Delete</a>
					</td>
					<td align="right">
						<a class="btnstyle3" onclick="ClearNotifications();" data-i18n="Clear">Clear</a>
					</td>
				</tr>
			</table>
			<br>
			<table class="display" id="notificationparamstable" border="0" cellpadding="0" cellspacing="20">
				<tr>
					<td align="right" style="width:80px"><label for="name"><span data-i18n="Type"></span>:</label></td>
					<td><select id="combotype" style="width:120px" class="combobox ui-corner-all"></select></td>
				</tr>
				<tr id="notiwhen">
					<td align="right" style="width:80px"><label for="name"><span data-i18n="When"></span>:</label></td>
					<td><select id="combowhen" style="width:120px" class="combobox ui-corner-all">
								<option value="0" data-i18n="Greater">Greater</option>
								<option value="1" data-i18n="Below">Below</option>
							</select>
					</td>
				</tr>
				<tr id="notival">
					<td align="right" style="width:80px"><label for="name"><span data-i18n="Value"></span>:</label></td>
					<td><input type="text" id="value" style="width: 50px; padding: .2em;" class="text ui-widget-content ui-corner-all" /><label id="valuetype">&nbsp;&deg; C</label></td>
				</tr>
			</table>
			<br>
			<a class="btnstyle3" onclick="AddNotification();" data-i18n="Add">Add</a>
	</div>
	<div id="dialog-transferdevice" title="Transfer Device">
			<form>
					<label for="newdevice"><span data-i18n="New Device"></span>: </label>
					<select id="newdevice" style="width:250px" class="combobox ui-corner-all">
					</select>
			</form>
	</div>
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
					<a class="brand" href="javascript:SwitchLayout('Dashboard')"><h1>Domoticz</h1> <h2 id="appversion">*</h2></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li id="mDashboard"><a id="cDashboard" href="javascript:SwitchLayout('Dashboard')"><img src="images/desktop.png"> <span data-i18n="Dashboard">Dashboard</span></img></a></li>
                            <li class="divider-vertical"></li>
								<li id="mLightSwitches"><a id="cLightSwitches" href="javascript:SwitchLayout('LightSwitches')"><img src="images/lightbulb.png"> <span data-i18n="Switches">Switches</span></a></li>
                            <li class="divider-vertical"></li>
								<li id="mScenes"><a id="cScenes" href="javascript:SwitchLayout('Scenes')"><img src="images/scenes.png"> <span data-i18n="Scenes">Scenes</span></a></li>
                            <li class="divider-vertical"></li>
								<li id="mTemperature"><a id="cTemperature" href="javascript:SwitchLayout('Temperature')"><img src="images/temperature.png"> <span data-i18n="Temperature">Temperature</span></a></li>
                            <li class="divider-vertical"></li>
								<li id="mWeather"><a id="cWeather" href="javascript:SwitchLayout('Weather')"><img src="images/rain.png"> <span data-i18n="Weather">Weather</span></a></li>
                            <li class="divider-vertical"></li>
								<li id="mUtility"><a id="cUtility" href="javascript:SwitchLayout('Utility')"><img src="images/utility.png"> <span data-i18n="Utility">Utility</span></a></li>
                            <li class="divider-vertical"></li>
                            <li class="dropdown">
                                <a id="setupmenu" class="dropdown-toggle" data-toggle="dropdown" onmouseover="cursorhand()" onmouseout="cursordefault()"><img src="images/setup.png"> <span data-i18n="Setup">Setup</span> <b class="caret"></b></a>
                                <ul class="dropdown-menu pull-right">
									<li id="mHardware"><a id="cHardware" href="javascript:SwitchLayout('Hardware')"><img src="images/hardware.png"> <span data-i18n="Hardware">Hardware</span></a></li>
									<li id="mDevices"><a id="cDevices" href="javascript:SwitchLayout('Devices')"><img src="images/devices.png"> <span data-i18n="Devices">Devices</span></a></li>
                                    <li id="mSetup"><a id="cSetup" href="javascript:SwitchLayout('Setup')"><img src="images/setup.png"> <span data-i18n="Application Settings">Application Settings</span></a></li>
                                    <li id="dUpdate" class="divider"></li>
                                    <li id="mUpdate"><a id="cUpdate" href="javascript:SwitchLayout('Update')"><img src="images/utility.png"> <span data-i18n="Update Domoticz">Update Domoticz</span></a></li>
                                    <li id="mCheckUpdate"><a id="cCheckUpdate" href="javascript:CheckForUpdate(true)"><img src="images/utility.png"> <span data-i18n="Check for Update">Check for Update</span></a></li>
                                    <li class="dropdown-submenu">
										<a id="cMoreOptions" tabindex="-1" data-i18n="More options">More options</a>
										<ul class="dropdown-menu pull-left">
											<li id="mCam"><a id="cCam" href="javascript:SwitchLayout('Cam')"><img src="images/camera-web.png"> <span data-i18n="Cameras">Cameras</span></a></li>
											<li id="mUsers"><a id="cUsers" href="javascript:SwitchLayout('Users')"><img src="images/users.png"> <span data-i18n="Edit Users">Edit Users</span></a></li>
											<li id="mEvents"><a id="cEvents" href="javascript:SwitchLayout('Events')"><img src="images/events.png"> <span data-i18n="Events">Events</span></a></li>
											<li id="mSecurity"><a id="cSecurity" href="secpanel/index.html"><img src="images/security.png"> <span data-i18n="SecurityPanel">Security Panel</span></a></li>
											<li id="mNotification"><a id="cNotification" href="javascript:SwitchLayout('Notification')"><img src="images/notification.png"> <span data-i18n="Send Notification">Send Notification</span></a></li>
											<li class="divider"></li>
											<li id="mRestart"><a id="cRestart" href="javascript:SwitchLayout('Restart')"><img src="images/restart.png"> <span data-i18n="Restart System">Restart System</span></a></li>
											<li id="mShutdown"><a id="cShutdown" href="javascript:SwitchLayout('Shutdown')"><img src="images/shutdown.png"> <span data-i18n="Shutdown System">Shutdown System</span></a></li>
										</ul>
                                    </li>
                                    <li class="divider"></li>
                                    <li id="mLog"><a id="cLog" href="javascript:SwitchLayout('Log')"><img src="images/log.png"> <span data-i18n="Log">Log</span></a></li>
                                    <li id="dLogoutSetup" class="divider" style="display: none;"></li>
									<li id="mLogoutSetup" style="display: none;"><a id="cLogout" href="javascript:SwitchLayout('Logout')"><img src="images/logout.png"> <span data-i18n="Logout">Logout</span></a></li>
                                </ul>
                            </li>
                            <li id="dLogout" class="divider-vertical" style="display: none;"></li>
							<li id="mLogout" style="display: none;"><a id="cLogout" href="javascript:SwitchLayout('Logout')"><img src="images/logout.png"> <span data-i18n="Logout">Logout</span></a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>
        <div id="holder">
					<div class="container">
							<div id="notification" style="display: none;"></div>
							<div class="bannercontent"></div>
							<div id="copyright">
									<p>&copy; 2012-2013 Domoticz | WWW: <a href="http://domoticz.com/">Domoticz.com</a></p>
							</div>
					</div> <!-- /container -->
		</div>
		<iframe src="/offline.html" style="display: none;"></iframe>
    </body>
</html>
