<div id="dialog-confirm-delete-subs" title="Warning:" style="display:none;">
    <p>This device is used as a Sub/Slave device for other Devices.<br>Do you want to remove this device from those devices too?</p>
</div>
<div id="editlightswitch" style="display:none;">
		<table class="display" id="paramstable" border="0" cellpadding="0" cellspacing="20">
			<tr>
				<td align="right" style="width:120px"><label for="name"><span data-i18n="Name"></span>: </label></td>
				<td><input type="text" id="devicename" style="width: 250px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
			</tr>
			<tr id="SwitchType">
				<td align="right"><label for="comboswitchtype"><span data-i18n="Switch Type"></span>: </label></td>
				<td><select id="comboswitchtype" style="width:150px" class="combobox ui-corner-all">
					<!--#embed switchtypes -->
				</select></td>
			</tr>
			<tr id="SwitchIconDiv">
				<td align="right"><label for="comboswitchicon"><span data-i18n="Switch Icon"></span>: </label></td>
				<td>
					<select id="comboswitchicon" style="width:200px" class="combobox ui-corner-all">
					</select>
            	</td>
			</tr>
			<tr id="MotionDiv">
				<td align="right"<label for="motionoffdelay"><span data-i18n="Off Delay"></span>:</label></td>
				<td><input type="text" id="motionoffdelay" style="width: 40px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="(Seconds) 0 = Use sensor time">(Seconds) 0 = Use sensor time</span></td>
			</tr>
			<tr id="OnDelayDiv">
				<td align="right"><label for="ondelay"><span data-i18n="On Delay">On Delay</span>:</label></td>
				<td><input type="text" id="ondelay" style="width: 40px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="(Seconds) 0 = Disabled">(Seconds) 0 = Disabled</span></td>
			</tr>
			<tr id="OffDelayDiv">
				<td align="right"><label for="offdelay"><span data-i18n="Off Delay"></span>:</label></td>
				<td><input type="text" id="offdelay" style="width: 40px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="(Seconds) 0 = Disabled">(Seconds) 0 = Disabled</span></td>
			</tr>
			<tr id="OnActionDiv">
				<td align="right"><label for="onaction"><span data-i18n="On Action">On Action</span>:</label></td>
				<td><input type="text" id="onaction" style="width: 340px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="(Should start with http:// or script://)">(Should start with http:// or script://)</span></td>
			</tr>
			<tr id="OffActionDiv">
				<td align="right"><label for="offaction"><span data-i18n="Off Action">Off Action</span>:</label></td>
				<td><input type="text" id="offaction" style="width: 340px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="(Should start with http:// or script://)">(Should start with http:// or script://)</span></td>
			</tr>
			<tr id="ProtectionDiv">
				<td align="right"><label for="protected"><span data-i18n="Protected">Protected</span>:</label></td>
				<td><input type="checkbox" id="protected"></td>
			</tr>
			<tr id="optionsWhite">
				<td align="right"><label><span data-i18n="Color">Color</span>:</label></td>
				<td>
					<button id="brightUp" onclick="appLampBrightnessUp()">Brightness Up</button><button id="brightDown" onclick="appLampBrightnessDown()">Brightness Down</button><br />
					<button id="discoUp" onclick="appLampWarmer()">Warm White</button><button id="discoDown" onclick="appLampCooler()">Cool White</button><br />
					<button id="speedUp" onclick="appLampFull()">Full Light</button><button id="speedDown" onclick="appLampNight()">Night Light</button><br />
				</td>
			</tr>
			</div>
			<tr id="LedColor">
				<td align="right"><label><span data-i18n="Color">Color</span>:</label></td>
				<td>
					<table class="display" id="ledtable" border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td align="left" style="width:200px">
							<div id="picker" width="100px" height="100px"></div>
						</td>
						<td align="left" style="vertical-align: top;">
							<input type="text" id="Hue" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="Hue"></span><br>
							<input type="text" id="Brightness" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="Brightness"></span><br>
							<div class="radio" id="optionsRGBW" style="display:none;">
								<label>
									<input type="radio" name="optionsType" id="optionRGB" value="false" checked>
										RGB
								</label>
								<label>
									<input type="radio" name="optionsType" id="optionWhite" value="true">
										White
								</label>
							</div>
							<div id="optionsRGB" style="display:none;">
								<button id="brightUp" onclick="appLampBrightnessUp()">Brightness Up</button><button id="brightDown" onclick="appLampBrightnessDown()">Brightness Down</button><br />
								<button id="discoUp" onclick="appLampDiscoUp()">Disco Mode Up</button><button id="discoDown" onclick="appLampDiscoDown()">Disco Mode Down</button><br />
								<button id="speedUp" onclick="appLampSpeedUp()">Speed Up</button><button id="speedDown" onclick="appLampSpeedDown()">Speed Down</button><br />
								<button id="speedUpLong" onclick="appLampSpeedUpLong()">Exclude Lamp</button><br />
							</div>
						</td>
					</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td></td>
				<td>
					<a class="btnstyle3" onclick="SaveLightSwitch();" data-i18n="Save">Save</a>&nbsp;&nbsp;&nbsp;
					<a class="btnstyle3" onclick="DeleteLightSwitch();" data-i18n="Delete">Delete</a>
				</td>
			</tr>
		</table>
		<br>
		<h2><span data-i18n="Sub/Slave Devices"></span>:</h2>
		<br>
		<table class="display" id="subdevicestable" border="0" cellpadding="0" cellspacing="0" width="100%">
				<thead>
						<tr>
								<th align="left" data-i18n="Name">Name</th>
						</tr>
				</thead>
		</table>
    <table id="delclr" border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td>
					<a class="btnstyle3-dis" id="subdevicedelete" data-i18n="Delete">Delete</a>
				</td>
				<td align="right">
					<a class="btnstyle3" onclick="ClearSubDevices();" data-i18n="Clear">Clear</a>
				</td>
			</tr>
		</table>
		<br>
		<table class="display" id="paramstable" border="0" cellpadding="0" cellspacing="20">
			<tr>
				<td align="right" style="width:120px"><label for="name"><span data-i18n="Sub/Slave Device"></span>: </label></td>
				<td>
					<select id="combosubdevice" style="width:250px" class="combobox ui-corner-all">
					</select>
					<a class="btnstyle3" onclick="AddSubDevice();" data-i18n="Add">Add</a>
				</td>
			</tr>
		</table>
		<br>
</div>
<div id="dialog-addlightdevice" title="Add Light/Switch Device">
    <form>
        <table class="display" id="lighttable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:120px"><label for="name">Name: </label></td>
          <td><input type="text" id="devicename" style="width: 244px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
        <tr>
          <td align="right"><label for="switchtype">Switch Type: </label></td>
          <td><select id="comboswitchtype" style="width:150px" class="combobox ui-corner-all">
            <!--#embed switchtypes -->
          </select></td>
		    </tr>
		    <br>
        <tr>
          <td align="right"><label>As: </label></td>
          <td><input type="radio" name="how" id="how_1" value="New" checked>&nbsp;Main Device&nbsp;&nbsp;<input type="radio" name="how" id="how_2" value="Sub Device">&nbsp;Sub/Slave Device</td>
        <tr>
		<tr id="subdevice" style="display:none">
			<td align="right"><label>Device: </label></td>
			<td>
				<select id="combosubdevice" style="width:244px" class="combobox ui-corner-all">
				</select>
			</td>
		</tr>
		</table>
    </form>
</div>
<div id="dialog-addmanuallightdevice" title="Add Manual Light/Switch Device">
    <form>
        <table class="display" id="lighttable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:120px"><label for="name">Hardware: </label></td>
          <td><select id="combohardware" style="width:260px" class="combobox ui-corner-all">
          </select></td>
        <tr>
        <tr>
          <td align="right"><label for="name">Name: </label></td>
          <td><input type="text" id="devicename" style="width: 250px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
        <tr>
          <td align="right"><label for="switchtype">Switch Type: </label></td>
					<td><select id="comboswitchtype" style="width:170px" class="combobox ui-corner-all">
						<!--#embed switchtypes -->
					</select></td>
	    </tr>
	    <tr>
			<td></td>
			<td></td>
	    </tr>
	    <tr>
          <td align="right"><label>Type: </label></td>
          <td>
			<select id="combolighttype" style="width:170px" class="combobox ui-corner-all">
						<option value="0">X10</option>
						<option value="1">ARC</option>
						<option value="2">AB400D</option>
						<option value="3">Waveman</option>
						<option value="4">EMW200</option>
						<option value="5">Impuls</option>
						<option value="6">RisingSun</option>
						<option value="8">Energenie</option>
						<option value="9">Energenie 5-gang</option>
						<option value="10">COCO GDR2</option>
						<option value="20">AC</option>
						<option value="21">HE EU</option>
						<option value="22">ANSLUT</option>
						<option value="50">LightwaveRF</option>
						<option value="55">Livolo</option>
						<option value="57">Aoke</option>
						<option value="60">Blyss</option>
						<option value="70">EnOcean</option>
						<option value="68">GPIO</option>
						<option value="100">ByronSX</option>
						<option value="101">Harrison Curtain</option>
						<option value="102">RFY</option>
						<option value="103">Meiantech Security</option>
			</select>
			</td>
		  </tr>
		</table>
		<div id="lighting1params">
			<table class="display" id="lightparams1" border="0" cellpadding="0" cellspacing="20">
				<tr>
					<td align="right" style="width:110px"><label>House Code:</label></td>
					<td><select id="combohousecode" style="width:60px" class="combobox ui-corner-all">
							</select>
					</td>
				</tr>
				<tr>
					<td align="right"><label>Unit Code:</label></td>
					<td><select id="combounitcode" style="width:60px" class="combobox ui-corner-all">
							</select>
					</td>
				</tr>
			</table>
		</div>
		<div id="lighting2params">
			<table class="display" id="lightparams2" border="0" cellpadding="0" cellspacing="20">
				<tr>
					<td align="right" style="width:110px"><label>ID:</label></td>
					<td>
						<select id="combocmd1" style="width:60px" class="combobox ui-corner-all">
								<option value="0">0</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
						</select>
						<select id="combocmd2" style="width:60px" class="combobox ui-corner-all"></select>
						<select id="combocmd3" style="width:60px" class="combobox ui-corner-all"></select>
						<select id="combocmd4" style="width:60px" class="combobox ui-corner-all"></select>
					</td>
				</tr>
				<tr id="lighting2paramsUnitCode">
					<td align="right"><label>Unit Code:</label></td>
					<td><select id="combounitcode" style="width:60px" class="combobox ui-corner-all">
							</select>
					</td>
				</tr>
			</table>
		</div>
		<div id="lighting3params">
			<table class="display" id="lightparams3" border="0" cellpadding="0" cellspacing="20">
				<tr>
					<td align="right" style="width:110px"><label>ID:</label></td>
					<td>
						<select id="combocmd1" style="width:60px" class="combobox ui-corner-all"></select>
						<select id="combocmd2" style="width:60px" class="combobox ui-corner-all"></select>
					</td>
				</tr>
				<tr>
					<td align="right"><label>Group Code:</label></td>
					<td>
						<select id="combogroupcode" style="width:60px" class="combobox ui-corner-all"></select>
					</td>
				</tr>
				<tr>
					<td align="right"><label>Unit Code:</label></td>
					<td>
						<select id="combounitcode" style="width:60px" class="combobox ui-corner-all"></select>
					</td>
				</tr>
			</table>
		</div>
		<div id="lightingparams_enocean">
			<table class="display" id="lightparams_enocean" border="0" cellpadding="0" cellspacing="20">
				<tr>
					<td align="right" style="width:110px"><label>ID:</label></td>
					<td>
						<select id="comboid" style="width:60px" class="combobox ui-corner-all"></select>
					</td>
				</tr>
				<tr>
					<td align="right"><label>Rocker_ID:</label></td>
					<td>
						<select id="combounitcode" style="width:60px" class="combobox ui-corner-all"></select>
					</td>
				</tr>
			</table>
		</div>
		<div id="lightingparams_gpio">
			<table class="display" id="lightparams_gpio" border="0" cellpadding="0" cellspacing="20">
				<tr>
					<td align="right" style="width:110px"><label>GPIO:</label></td>
					<td>
						<select id="combogpio" style="width:220px" class="combobox ui-corner-all"><option value="-1">?</option></select>
					</td>
				</tr>
			</table>
		</div>
		<br>
		<center><a class="btnstyle3" onclick="TestManualLight();">Test</a></center>
		<br>
        <table class="display" id="howtable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right"><label>As: </label></td>
          <td><input type="radio" name="how" id="how_1" value="New" checked>&nbsp;Main Device&nbsp;&nbsp;<input type="radio" name="how" id="how_2" value="Sub Device">&nbsp;Sub/Slave Device</td>
        <tr>
		<tr id="subdevice" style="display:none">
			<td align="right" style="width:60px"><label>Device: </label></td>
			<td>
				<select id="combosubdevice" style="width:250px" class="combobox ui-corner-all">
				</select>
			</td>
		</tr>
		</table>
    </form>
</div>
<div id="lightcontent">
</div>
<div id="edittimers" style="display:none;">
    <table class="display" id="timertable" border="0" cellpadding="0" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th width="40" align="center" data-i18n="Active">Active</th>
                <th width="120" align="center" data-i18n="Type">Type</th>
                <th width="60" align="center" data-i18n="Time">Time</th>
                <th width="60" align="center" data-i18n="Randomness">Randomness</th>
                <th width="80" align="center" data-i18n="Command">Command</th>
                <th align="left" data-i18n="Days">Days</th>
            </tr>
        </thead>
    </table>
    <table id="updelclr" border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td>
					<a class="btnstyle3-dis" id="timerupdate" data-i18n="Update">Update</a>&nbsp;&nbsp;&nbsp;
					<a class="btnstyle3-dis" id="timerdelete" data-i18n="Delete">Delete</a>
				</td>
				<td align="right">
					<a class="btnstyle3" onclick="ClearTimers();" data-i18n="Clear">Clear</a>
				</td>
			</tr>
		</table>
		<br>
		<table class="display" id="timerparamstable" border="0" cellpadding="0" cellspacing="20">
			<tr>
				<td align="right" style="width:80px"><label for="enabled"><span data-i18n="Enabled"></span>:</label></td>
				<td><input type="checkbox" id="enabled" checked></td>
			</tr>
			<tr>
				<td align="right" style="width:80px"><label for="name"><span data-i18n="Type"></span>:</label></td>
				<td><select id="combotype" style="width:150px" class="combobox ui-corner-all">
						<!--#embed timertypes -->
						</select>
				</td>
			</tr>
			<tr>
				<td align="right" style="width:80px"><label for="name"><span data-i18n="Time"></span>:</label></td>
				<td><select id="combotimehour" style="width:50px" class="combobox ui-corner-all"></select>
						:
						<select id="combotimemin" style="width:50px" class="combobox ui-corner-all"></select>
						<span data-i18n="(hour/minute)"></span>
				</td>
			</tr>
			<tr>
				<td align="right" style="width:80px"><label for="randomness"><span data-i18n="Randomness"></span>:</label></td>
				<td><input type="checkbox" id="randomness"></td>
			</tr>
			<tr>
				<td align="right" style="width:80px"><label for="combocommand"><span data-i18n="Command"></span>:</label></td>
				<td>
					<select id="combocommand" style="width:90px" class="combobox ui-corner-all">
					<option value="0" data-i18n="On">On</option>
					<option value="1" data-i18n="Off">Off</option>
					</select>
				</td>
			</tr>
			<tr id="LevelDiv">
				<td align="right" style="width:80px"><label for="combolevel"><span data-i18n="Level"></span>:</label></td>
				<td>
					<select id="combolevel" style="width:70px" class="combobox ui-corner-all">
					<option value="5">5%</option>
					<option value="10">10%</option>
					<option value="15">15%</option>
					<option value="20">20%</option>
					<option value="25">25%</option>
					<option value="30">30%</option>
					<option value="35">35%</option>
					<option value="40">40%</option>
					<option value="45">45%</option>
					<option value="50">50%</option>
					<option value="55">55%</option>
					<option value="60">60%</option>
					<option value="65">65%</option>
					<option value="70">70%</option>
					<option value="75">75%</option>
					<option value="80">80%</option>
					<option value="85">85%</option>
					<option value="90">90%</option>
					<option value="95">95%</option>
					<option value="100">100%</option>
					</select>
				</td>
			</tr>
			<tr id="LedColor">
				<td align="right"><label><span data-i18n="Color">Color</span>:</label></td>
				<td>
					<table class="display" id="ledtable" border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td align="left" style="width:200px">
							<div id="picker" width="100px" height="100px"></div>
						</td>
						<td align="left" style="vertical-align: top;">
							<input type="text" id="Hue" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="Hue"></span><br>
							<input type="text" id="Brightness" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> <span data-i18n="Brightness"></span><br>
							<div class="radio" id="optionsRGBW" style="display:none;">
								<label>
									<input type="radio" name="optionsType" id="optionRGB" value="false" checked>
										RGB
								</label>
								<label>
									<input type="radio" name="optionsType" id="optionWhite" value="true">
										White
								</label>
							</div>
						</td>
					</tr>
					</table>
				</td>
			</tr>
			<tr><td></td></tr>
			<tr>
				<td align="right" style="width:80px"><label for="when"><span data-i18n="When"></span>:</label></td>
				<td>
					<input type="radio" name="when" id="when_1" value="Everyday" checked>&nbsp;<span data-i18n="Everyday"></span><br><br>
					<input type="radio" name="when" id="when_2" value="Weekdays">&nbsp;<span data-i18n="Weekdays"></span><br><br>
					<input type="radio" name="when" id="when_3" value="Weekends">&nbsp;<span data-i18n="Weekends"></span><br><br>
					<input type="radio" name="when" id="when_4" value="SelectedDays">&nbsp;<span data-i18n="Selected Days"></span><br><br>
				</td>
			</tr>
			<tr><td></td></tr>
			<tr>
				<td align="right" style="width:80px"><label for="name"><span data-i18n="Days"></span>:</label></td>
				<td>
					<input type="checkbox" id="ChkMon"/>&nbsp;<span data-i18n="Monday"></span>&nbsp;
					<input type="checkbox" id="ChkTue"/>&nbsp;<span data-i18n="Tuesday"></span>&nbsp;
					<input type="checkbox" id="ChkWed"/>&nbsp;<span data-i18n="Wednesday"></span>&nbsp;
					<input type="checkbox" id="ChkThu"/>&nbsp;<span data-i18n="Thursday"></span>&nbsp;
					<input type="checkbox" id="ChkFri"/>&nbsp;<span data-i18n="Friday"></span>&nbsp;
					<input type="checkbox" id="ChkSat"/>&nbsp;<span data-i18n="Saturday"></span>&nbsp;
					<input type="checkbox" id="ChkSun"/>&nbsp;<span data-i18n="Sunday"></span>&nbsp;
				</td>
			</tr>
		</table>
		<br>
    <a class="btnstyle3" onclick="AddTimer();" data-i18n="Add">Add</a>
</div>

<script type="text/javascript" charset="utf-8">

function DeleteTimer(idx)
{
	bootbox.confirm($.i18n("Are you sure to delete this timers?\n\nThis action can not be undone..."), function(result) {
		if (result==true) {
			$.ajax({
				 url: "json.htm?type=command&param=deletetimer&idx=" + idx,
				 async: false, 
				 dataType: 'json',
				 success: function(data) {
					RefreshTimerTable($.devIdx);
				 },
				 error: function(){
						HideNotify();
						ShowNotify($.i18n('Problem deleting timer!'), 2500, true);
				 }     
			});
		}
	});
}

function ClearTimers()
{
	bootbox.confirm($.i18n("Are you sure to delete ALL timers?\n\nThis action can not be undone!"), function(result) {
		if (result==true) {
			$.ajax({
				 url: "json.htm?type=command&param=cleartimers&idx=" + $.devIdx,
				 async: false, 
				 dataType: 'json',
				 success: function(data) {
					RefreshTimerTable($.devIdx);
				 },
				 error: function(){
						HideNotify();
						ShowNotify($.i18n('Problem clearing timers!'), 2500, true);
				 }     
			});
		}
	});
}

function GetTimerSettings()
{
	var tsettings = {};
	tsettings.level=100;
	tsettings.hue=0;
	tsettings.Active=$('#lightcontent #timerparamstable #enabled').is(":checked");
	tsettings.timertype=$("#lightcontent #timerparamstable #combotype").val();
	tsettings.hour=$("#lightcontent #timerparamstable #combotimehour").val();
	tsettings.min=$("#lightcontent #timerparamstable #combotimemin").val();
	tsettings.Randomness=$('#lightcontent #timerparamstable #randomness').is(":checked");
	tsettings.cmd=$("#lightcontent #timerparamstable #combocommand").val();
	tsettings.days=0;
	var everyday=$("#lightcontent #timerparamstable #when_1").is(":checked");
	var weekdays=$("#lightcontent #timerparamstable #when_2").is(":checked");
	var weekends=$("#lightcontent #timerparamstable #when_3").is(":checked");
	if (everyday==true)
		tsettings.days=0x80;
	else if (weekdays==true)
		tsettings.days=0x100;
	else if (weekends==true)
		tsettings.days=0x200;
	else {
		if ($('#lightcontent #timerparamstable #ChkMon').is(":checked"))
			tsettings.days|=0x01;
		if ($('#lightcontent #timerparamstable #ChkTue').is(":checked"))
			tsettings.days|=0x02;
		if ($('#lightcontent #timerparamstable #ChkWed').is(":checked"))
			tsettings.days|=0x04;
		if ($('#lightcontent #timerparamstable #ChkThu').is(":checked"))
			tsettings.days|=0x08;
		if ($('#lightcontent #timerparamstable #ChkFri').is(":checked"))
			tsettings.days|=0x10;
		if ($('#lightcontent #timerparamstable #ChkSat').is(":checked"))
			tsettings.days|=0x20;
		if ($('#lightcontent #timerparamstable #ChkSun').is(":checked"))
			tsettings.days|=0x40;
	}
	if (tsettings.cmd==0)
	{
		if ($.bIsLED) {
			tsettings.level=$("#lightcontent #Brightness").val();
			tsettings.hue=$("#lightcontent #Hue").val();
			var bIsWhite=$('#lightcontent #ledtable #optionWhite').is(":checked")
			if (bIsWhite==true) {
				tsettings.hue=1000;
			}
		}
		else {
			if ($.isDimmer) {
				tsettings.level=$("#lightcontent #timerparamstable #combolevel").val();
			}
		}
	}
	return tsettings;
}

function UpdateTimer(idx)
{
	var tsettings=GetTimerSettings();
	if (tsettings.days==0)
	{
		ShowNotify($.i18n('Please select some days!'), 2500, true);
		return;
	}
	$.ajax({
		 url: "json.htm?type=command&param=updatetimer&idx=" + idx + 
					"&active=" + tsettings.Active + 
					"&timertype=" + tsettings.timertype +
					"&hour=" + tsettings.hour +
					"&min=" + tsettings.min +
					"&randomness=" + tsettings.Randomness +
					"&command=" + tsettings.cmd +
					"&level=" + tsettings.level +
					"&hue=" + tsettings.hue +
					"&days=" + tsettings.days,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			RefreshTimerTable($.devIdx);
		 },
		 error: function(){
				HideNotify();
				ShowNotify($.i18n('Problem updating timer!'), 2500, true);
		 }     
	});
}

function AddTimer()
{
	var tsettings=GetTimerSettings();
	if (tsettings.days==0)
	{
		ShowNotify($.i18n('Please select some days!'), 2500, true);
		return;
	}
	$.ajax({
		 url: "json.htm?type=command&param=addtimer&idx=" + $.devIdx + 
					"&active=" + tsettings.Active + 
					"&timertype=" + tsettings.timertype +
					"&hour=" + tsettings.hour +
					"&min=" + tsettings.min +
					"&randomness=" + tsettings.Randomness +
					"&command=" + tsettings.cmd +
					"&level=" + tsettings.level +
					"&hue=" + tsettings.hue +
					"&days=" + tsettings.days,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			RefreshTimerTable($.devIdx);
		 },
		 error: function(){
				HideNotify();
				ShowNotify($.i18n('Problem adding timer!'), 2500, true);
		 }     
	});
}

function EnableDisableDays(TypeStr, bDisabled)
{
		$('#lightcontent #timerparamstable #ChkMon').prop('checked', ((TypeStr.indexOf("Mon") >= 0)||(TypeStr=="Everyday")||(TypeStr=="Weekdays")) ? true : false);
		$('#lightcontent #timerparamstable #ChkTue').prop('checked', ((TypeStr.indexOf("Tue") >= 0)||(TypeStr=="Everyday")||(TypeStr=="Weekdays")) ? true : false);
		$('#lightcontent #timerparamstable #ChkWed').prop('checked', ((TypeStr.indexOf("Wed") >= 0)||(TypeStr=="Everyday")||(TypeStr=="Weekdays")) ? true : false);
		$('#lightcontent #timerparamstable #ChkThu').prop('checked', ((TypeStr.indexOf("Thu") >= 0)||(TypeStr=="Everyday")||(TypeStr=="Weekdays")) ? true : false);
		$('#lightcontent #timerparamstable #ChkFri').prop('checked', ((TypeStr.indexOf("Fri") >= 0)||(TypeStr=="Everyday")||(TypeStr=="Weekdays")) ? true : false);
		$('#lightcontent #timerparamstable #ChkSat').prop('checked', ((TypeStr.indexOf("Sat") >= 0)||(TypeStr=="Everyday")||(TypeStr=="Weekends")) ? true : false);
		$('#lightcontent #timerparamstable #ChkSun').prop('checked', ((TypeStr.indexOf("Sun") >= 0)||(TypeStr=="Everyday")||(TypeStr=="Weekends")) ? true : false);

		$('#lightcontent #timerparamstable #ChkMon').attr('disabled', bDisabled);
		$('#lightcontent #timerparamstable #ChkTue').attr('disabled', bDisabled);
		$('#lightcontent #timerparamstable #ChkWed').attr('disabled', bDisabled);
		$('#lightcontent #timerparamstable #ChkThu').attr('disabled', bDisabled);
		$('#lightcontent #timerparamstable #ChkFri').attr('disabled', bDisabled);
		$('#lightcontent #timerparamstable #ChkSat').attr('disabled', bDisabled);
		$('#lightcontent #timerparamstable #ChkSun').attr('disabled', bDisabled);
}

function RefreshTimerTable(idx)
{
  $('#modal').show();

	$('#updelclr #timerupdate').attr("class", "btnstyle3-dis");
	$('#updelclr #timerdelete').attr("class", "btnstyle3-dis");

  var oTable = $('#timertable').dataTable();
  oTable.fnClearTable();
  
  $.ajax({
     url: "json.htm?type=timers&idx=" + idx, 
     async: false, 
     dataType: 'json',
     success: function(data) {
        
      if (typeof data.result != 'undefined') {
        $.each(data.result, function(i,item){
			var active="No";
			if (item.Active == "true")
				active="Yes";
			var Command="On";
			if (item.Cmd == 1) {
				Command="Off";
			}
			var tCommand=Command;
			if ((Command=="On") && ($.isDimmer)) {
				tCommand+=" (" + item.Level + "%)";
				if ($.bIsLED) {
					var hue=item.Hue;
					var sat=100;
					if (hue==1000) {
						hue=0;
						sat=0;
					}
					var cHSB=[];
					cHSB.h=hue;
					cHSB.s=sat;
					cHSB.b=item.Level;
					tCommand+='<div id="picker4" class="ex-color-box" style="background-color: #' + $.colpickHsbToHex(cHSB) + ';"></div>';
				}
			}
			
			var DayStr = "";
			var dayflags = parseInt(item.Days);
			if (dayflags & 0x80)
				DayStr="Everyday";
			else if (dayflags & 0x100)
				DayStr="Weekdays";
			else if (dayflags & 0x200)
				DayStr="Weekends";
			else {
				if (dayflags & 0x01) {
					if (DayStr!="") DayStr+=", ";
					DayStr+="Mon";
				}
				if (dayflags & 0x02) {
					if (DayStr!="") DayStr+=", ";
					DayStr+="Tue";
				}
				if (dayflags & 0x04) {
					if (DayStr!="") DayStr+=", ";
					DayStr+="Wed";
				}
				if (dayflags & 0x08) {
					if (DayStr!="") DayStr+=", ";
					DayStr+="Thu";
				}
				if (dayflags & 0x10) {
					if (DayStr!="") DayStr+=", ";
					DayStr+="Fri";
				}
				if (dayflags & 0x20) {
					if (DayStr!="") DayStr+=", ";
					DayStr+="Sat";
				}
				if (dayflags & 0x40) {
					if (DayStr!="") DayStr+=", ";
					DayStr+="Sun";
				}
			}
			var rEnabled="No";
			if (item.Randomness==true) {
				rEnabled="Yes";
			}
						
			var addId = oTable.fnAddData( {
				"DT_RowId": item.idx,
				"Command": Command,
				"Level": item.Level,
				"Hue": item.Hue,
				"0": active,
				"1": $.myglobals.TimerTypesStr[item.Type],
				"2": item.Time,
				"3": rEnabled,
				"4": tCommand,
				"5": DayStr
			} );
        });
		/* Add a click handler to the rows - this could be used as a callback */
		$("#timertable tbody tr").click( function( e ) {
			if ( $(this).hasClass('row_selected') ) {
					$(this).removeClass('row_selected');
					$('#updelclr #timerupdate').attr("class", "btnstyle3-dis");
					$('#updelclr #timerdelete').attr("class", "btnstyle3-dis");
			}
			else {
				oTable.$('tr.row_selected').removeClass('row_selected');
				$(this).addClass('row_selected');
				$('#updelclr #timerupdate').attr("class", "btnstyle3");
				$('#updelclr #timerdelete').attr("class", "btnstyle3");
				var anSelected = fnGetSelected( oTable );
				if ( anSelected.length !== 0 ) {
					var data = oTable.fnGetData( anSelected[0] );
					var idx= data["DT_RowId"];
					$.myglobals.SelectedTimerIdx=idx;
					$("#updelclr #timerupdate").attr("href", "javascript:UpdateTimer(" + idx + ")");
					$("#updelclr #timerdelete").attr("href", "javascript:DeleteTimer(" + idx + ")");
					//update user interface with the paramters of this row
					$('#lightcontent #timerparamstable #enabled').prop('checked', (data["0"]=="Yes") ? true : false);
					$("#lightcontent #timerparamstable #combotype").val(jQuery.inArray(data["1"], $.myglobals.TimerTypesStr));
					$("#lightcontent #timerparamstable #combotimehour").val(parseInt(data["2"].substring(0,2)));
					$("#lightcontent #timerparamstable #combotimemin").val(parseInt(data["2"].substring(3,5)));
					$('#lightcontent #timerparamstable #randomness').prop('checked', (data["3"]=="Yes") ? true : false);
					$("#lightcontent #timerparamstable #combocommand").val(jQuery.inArray(data["Command"], $.myglobals.CommandStr));
					var level=data["Level"];
					if ($.bIsLED) {
						$('#lightcontent #Brightness').val(level&255);
						var hue=data["Hue"];
						var sat=100;
						if (hue==1000) {
							hue=0;
							sat=0;
						}
						$('#lightcontent #Hue').val(hue);
						var cHSB=[];
						cHSB.h=hue;
						cHSB.s=sat;
						cHSB.b=level;
						
						$("#lightcontent #optionRGB").prop('checked',(sat==100));
						$("#lightcontent #optionWhite").prop('checked',!(sat==100));

						$('#lightcontent #picker').colpickSetColor(cHSB);
					}
					else if ($.isDimmer) {
						$("#lightcontent #timerparamstable #combolevel").val(level);
					}
					
					var disableDays=false;
					if (data["5"]=="Everyday") {
						$("#lightcontent #timerparamstable #when_1").prop('checked', 'checked');
						disableDays=true;
					}
					else if (data["5"]=="Weekdays") {
						$("#lightcontent #timerparamstable #when_2").prop('checked', 'checked');
						disableDays=true;
					}
					else if (data["5"]=="Weekends") {
						$("#lightcontent #timerparamstable #when_3").prop('checked', 'checked');
						disableDays=true;
					}
					else
						$("#lightcontent #timerparamstable #when_4").prop('checked', 'checked');
						
					EnableDisableDays(data["5"],disableDays);
				}
			}
		}); 
      }
     }
  });
  
  RefreshTimeAndSun();
  
  $('#modal').hide();
}

function ShowTimers(id,name, isdimmer, stype,devsubtype)
{
	clearInterval($.myglobals.refreshTimer);
	$.devIdx=id;
	$.isDimmer=isdimmer;
	
	$.bIsRGBW=(devsubtype.indexOf("RGBW") >= 0);
	$.bIsLED=(devsubtype.indexOf("RGB") >= 0);
  
	var oTable;
	
	$('#modal').show();
	var htmlcontent = '';
	htmlcontent='<p><h2><span data-i18n="Name"></span>: ' + name + '</h2></p><br>\n';

	var sunRise="";
	var sunSet="";
	$.ajax({
		 url: "json.htm?type=command&param=getSunRiseSet",
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			if (typeof data.Sunrise != 'undefined') {
			  sunRise=data.Sunrise;
			  sunSet=data.Sunset;
			}
		 }
	});
  
	var suntext='<div id="timesun" /><br>\n';
	htmlcontent+=suntext;
  
	htmlcontent+=$('#edittimers').html();
	$('#lightcontent').html(GetBackbuttonHTMLTable('ShowLights')+htmlcontent);
	$('#lightcontent').i18n();

	RefreshTimeAndSun();

	var sat=180;
	var cHSB=[];
	cHSB.h=128;
	cHSB.s=sat;
	cHSB.b=100;
	$('#lightcontent #Brightness').val(100);
	$('#lightcontent #Hue').val(128);
	
	if ($.bIsLED==true) {
		$("#lightcontent #LedColor").show();
	}
	else {
		$("#lightcontent #LedColor").hide();
	}
	if ($.bIsRGBW==true) {
		$("#lightcontent #optionsRGBW").show();
	}
	else {
		$("#lightcontent #optionsRGBW").hide();
	}
	$('#lightcontent #picker').colpick({
		flat:true,
		layout:'hex',
		submit:0,
		onChange:function(hsb,hex,rgb,fromSetColor) {
			if(!fromSetColor) {
				$('#lightcontent #Hue').val(hsb.h);
				$('#lightcontent #Brightness').val(hsb.b);
				var bIsWhite=(hsb.s<20);
				$("#lightcontent #optionRGB").prop('checked',!bIsWhite);
				$("#lightcontent #optionWhite").prop('checked',bIsWhite);
			}
		}
	});

	$("#lightcontent #optionRGB").prop('checked',(sat==180));
	$("#lightcontent #optionWhite").prop('checked',!(sat==180));

	$('#lightcontent #picker').colpickSetColor(cHSB);

	oTable = $('#timertable').dataTable( {
	  "sDom": '<"H"lfrC>t<"F"ip>',
	  "oTableTools": {
		"sRowSelect": "single",
	  },
	  "aaSorting": [[ 0, "desc" ]],
	  "bSortClasses": false,
	  "bProcessing": true,
	  "bStateSave": true,
	  "bJQueryUI": true,
	  "aLengthMenu": [[25, 50, 100, -1], [25, 50, 100, "All"]],
	  "iDisplayLength" : 25,
	  "sPaginationType": "full_numbers"
	} );
	$('#timerparamstable #combotimehour >option').remove();
	$('#timerparamstable #combotimemin >option').remove();
                
	//fill hour/minute comboboxes
	for (ii=0; ii<24; ii++)
	{
		$('#timerparamstable #combotimehour').append($('<option></option>').val(ii).html($.strPad(ii,2)));  
	}
	for (ii=0; ii<60; ii++)
	{
		$('#timerparamstable #combotimemin').append($('<option></option>').val(ii).html($.strPad(ii,2)));  
	}
  
	$("#lightcontent #timerparamstable #when_1").click(function() {
		EnableDisableDays("Everyday",true);
	});
	$("#lightcontent #timerparamstable #when_2").click(function() {
		EnableDisableDays("Weekdays",true);
	});
	$("#lightcontent #timerparamstable #when_3").click(function() {
		EnableDisableDays("Weekends",true);
	});
	$("#lightcontent #timerparamstable #when_4").click(function() {
		EnableDisableDays("",false);
	});

	$("#lightcontent #timerparamstable #combocommand").change(function() {
		var cval=$("#lightcontent #timerparamstable #combocommand").val();
		var bShowLevel=false;
		if (!$.bIsLED) {
			if ($.isDimmer) {
				if (cval==0) {
					bShowLevel=true;
				}
			}
		}
		if (bShowLevel==true) {
			$("#lightcontent #LevelDiv").show();
		}
		else {
			$("#lightcontent #LevelDiv").hide();
		}
	});

	if (($.isDimmer)&&(!$.bIsLED)) {
		$("#lightcontent #LevelDiv").show();
	}
	else {
		$("#lightcontent #LevelDiv").hide();
	}
  
	$('#modal').hide();
	RefreshTimerTable(id);
}

function MakeFavorite(id,isfavorite)
{
	if (window.my_config.userrights!=2) {
        HideNotify();
		ShowNotify($.i18n('You do not have permission to do that!'), 2500, true);
		return;
	}
	clearInterval($.myglobals.refreshTimer);
	$.ajax({
		url: "json.htm?type=command&param=makefavorite&idx=" + id + "&isfavorite=" + isfavorite, 
		async: false, 
		dataType: 'json',
		success: function(data) {
			ShowLights();
		}
	});
}

function DeleteLightSwitchIntern(bRemoveSubDevices)
{
	$.ajax({
		 url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + encodeURIComponent($("#lightcontent #devicename").val()) + '&used=false&RemoveSubDevices=' + bRemoveSubDevices,
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
				ShowLights();
		 }
	});
}

function DeleteLightSwitch()
{
	bootbox.confirm($.i18n("Are you sure to remove this Light/Switch?"), function(result) {
		if (result==true) {
			var bRemoveSubDevices=true;
			if ($.isslave==true) {
					var result=false;
					$( "#dialog-confirm-delete-subs" ).dialog({
						resizable: false,
						width: 440,
						height:180,
						modal: true,
						buttons: {
							"Yes": function() {
									$( this ).dialog( "close" );
									DeleteLightSwitchIntern(true);
						},
							"No": function() {
									$( this ).dialog( "close" );
									DeleteLightSwitchIntern(false);
						}
					}
				});
			}
			else {
				DeleteLightSwitchIntern(false);
			}
		}
	});
}

function SaveLightSwitch()
{
	var bValid = true;
	bValid = bValid && checkLength( $("#lightcontent #devicename"), 2, 100 );

	var strParam1=$("#lightcontent #onaction").val();
	var strParam2=$("#lightcontent #offaction").val();
	
	var bIsProtected=$('#lightcontent #protected').is(":checked");

	if (strParam1!="") {
		if ( (strParam1.indexOf("http://") !=0) && (strParam1.indexOf("script://") !=0) ) {
			bootbox.alert($.i18n("Invalid ON Action!"));
			return;
		}
		else {
			if (checkLength( $("#lightcontent #onaction"), 10, 500 )==false) {
				bootbox.alert($.i18n("Invalid ON Action!"));
				return;
			}
		}
	}
	if (strParam2!="") {
		if ( (strParam2.indexOf("http://") !=0) && (strParam2.indexOf("script://") !=0) ) {
			bootbox.alert($.i18n("Invalid Off Action!"));
			return;
		}
		else {
			if (checkLength( $("#lightcontent #offaction"), 10, 500 )==false) {
				bootbox.alert($.i18n("Invalid Off Action!"));
				return;
			}
		}
	}

	if ( bValid ) {
		if ($.stype=="Security") {
			$.ajax({
				 url: "json.htm?type=setused&idx=" + $.devIdx +
				  '&name=' + encodeURIComponent($("#lightcontent #devicename").val()) +
				  '&strparam1=' + btoa(strParam1) +
				  '&strparam2=' + btoa(strParam2) +
				  '&protected=' + bIsProtected +
				  '&used=true',
				 async: false, 
				 dataType: 'json',
				 success: function(data) {
						ShowLights();
				 }
			});
		}
		else {
			var addjvalstr="";
			var switchtype=$("#lightcontent #comboswitchtype").val();
			if (switchtype==8) {
				addjvalstr="&addjvalue=" + $("#lightcontent #motionoffdelay").val();
			}
			else if ((switchtype==0)||(switchtype==9)||(switchtype==11)) {
				addjvalstr="&addjvalue=" + $("#lightcontent #offdelay").val();
				addjvalstr+="&addjvalue2=" + $("#lightcontent #ondelay").val();
			}
			var CustomImage=0;
			if (switchtype==0) {
				CustomImage=$('#lightcontent #comboswitchicon').data('ddslick').selectedIndex;
			}
			$.ajax({
				 url: "json.htm?type=setused&idx=" + $.devIdx + 
					'&name=' + encodeURIComponent($("#lightcontent #devicename").val()) + 
					'&strparam1=' + btoa(strParam1) +
					'&strparam2=' + btoa(strParam2) +
					'&protected=' + bIsProtected +
					'&switchtype=' + $("#lightcontent #comboswitchtype").val() + 
					'&customimage=' + CustomImage + 
					'&used=true' + addjvalstr ,
				 async: false, 
				 dataType: 'json',
				 success: function(data) {
						ShowLights();
				 }
			});
		}
	}
}

function ClearSubDevices()
{
	bootbox.confirm($.i18n("Are you sure to delete ALL Sub/Slave Devices?\n\nThis action can not be undone!"), function(result) {
		if (result==true) {
			$.ajax({
					url: "json.htm?type=command&param=deleteallsubdevices&idx=" + $.devIdx,
					async: false, 
					dataType: 'json',
					success: function(data) {
					RefreshSubDeviceTable($.devIdx);
				}
			});
		}
	});
}

function DeleteSubDevice(idx)
{
	bootbox.confirm($.i18n("Are you sure to delete this Sub/Slave Device?\n\nThis action can not be undone..."), function(result) {
		if (result==true) {
			$.ajax({
				 url: "json.htm?type=command&param=deletesubdevice&idx=" + idx,
				 async: false, 
				 dataType: 'json',
				 success: function(data) {
					RefreshSubDeviceTable($.devIdx);
				 }
			});
		}
	});
}

function RefreshSubDeviceTable(idx)
{
	$('#modal').show();

	$('#lightcontent #delclr #subdevicedelete').attr("class", "btnstyle3-dis");

	var oTable = $('#lightcontent #subdevicestable').dataTable();
	oTable.fnClearTable();
  
	$.ajax({
		url: "json.htm?type=command&param=getsubdevices&idx=" + idx, 
		async: false, 
		dataType: 'json',
		success: function(data) {
			if (typeof data.result != 'undefined') {
				$.each(data.result, function(i,item){
				  var addId = oTable.fnAddData( {
										"DT_RowId": item.ID,
						"0": item.Name
									} );
				});
				/* Add a click handler to the rows - this could be used as a callback */
				$("#lightcontent #subdevicestable tbody tr").click( function( e ) {
					if ( $(this).hasClass('row_selected') ) {
						$(this).removeClass('row_selected');
						$('#lightcontent #delclr #subdevicedelete').attr("class", "btnstyle3-dis");
					}
					else {
						oTable.$('tr.row_selected').removeClass('row_selected');
						$(this).addClass('row_selected');
						$('#lightcontent #delclr #subdevicedelete').attr("class", "btnstyle3");
						
						var anSelected = fnGetSelected( oTable );
						if ( anSelected.length !== 0 ) {
							var data = oTable.fnGetData( anSelected[0] );
							var idx= data["DT_RowId"];
							$("#lightcontent #delclr #subdevicedelete").attr("href", "javascript:DeleteSubDevice(" + idx + ")");
						}
					}
				}); 
			}
		}
	});
  $('#modal').hide();
}

function AddSubDevice()
{
	var SubDeviceIdx=$("#lightcontent #combosubdevice option:selected").val();
	if (typeof SubDeviceIdx == 'undefined') {
		bootbox.alert($.i18n('No Sub/Slave Device Selected!'));
		return ;
	}
	$.ajax({
		url: "json.htm?type=command&param=addsubdevice&idx=" + $.devIdx + "&subidx=" + SubDeviceIdx,
		async: false, 
		dataType: 'json',
		success: function(data) {
			if (data.status == 'OK') {
				RefreshSubDeviceTable($.devIdx);
			}
			else {
				ShowNotify($.i18n('Problem adding Sub/Slave Device!'), 2500, true);
			}
		},
		error: function(){
			HideNotify();
			ShowNotify($.i18n('Problem adding Sub/Slave Device!'), 2500, true);
		}     
	});
}

function SetColValue(idx,hue,brightness)
{
	clearInterval($.setColValue);
	if (window.my_config.userrights==0) {
        HideNotify();
		ShowNotify($.i18n('You do not have permission to do that!'), 2500, true);
		return;
	}
	var bIsWhite=$('#lightcontent #ledtable #optionWhite').is(":checked");
	$.ajax({
		 url: "json.htm?type=command&param=setcolbrightnessvalue&idx=" + idx + "&hue=" + hue + "&brightness=" + brightness + "&iswhite=" + bIsWhite,
		 async: false, 
		 dataType: 'json'
	});
}

function appLampBrightnessUp()
{
	$.ajax({
		 url: "json.htm?type=command&param=brightnessup&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}

function appLampBrightnessDown()
{
	$.ajax({
		 url: "json.htm?type=command&param=brightnessdown&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}
function appLampDiscoUp()
{
	$.ajax({
		 url: "json.htm?type=command&param=discoup&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}

function appLampDiscoDown()
{
	$.ajax({
		 url: "json.htm?type=command&param=discodown&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}
function appLampSpeedUp()
{
	$.ajax({
		 url: "json.htm?type=command&param=speedup&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}
function appLampSpeedUpLong()
{
	$.ajax({
		 url: "json.htm?type=command&param=speeduplong&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}



function appLampSpeedDown()
{
	$.ajax({
		 url: "json.htm?type=command&param=speeddown&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}

function appLampWarmer()
{
	$.ajax({
		 url: "json.htm?type=command&param=warmer&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}

function appLampFull()
{
	$.ajax({
		 url: "json.htm?type=command&param=fulllight&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}

function appLampNight()
{
	$.ajax({
		 url: "json.htm?type=command&param=nightlight&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}

function appLampCooler()
{
	$.ajax({
		 url: "json.htm?type=command&param=cooler&idx=" + $.devIdx,
		 async: false, 
		 dataType: 'json'
	});
}

function EditLightDevice(idx,name,stype,switchtype,addjvalue,addjvalue2,isslave,customimage,devsubtype,strParam1,strParam2,bIsProtected)
{
	clearInterval($.myglobals.refreshTimer);
	$.devIdx=idx;
	$.isslave=isslave;
	$.stype=stype;

	var oTable;
	
	$('#modal').show();
	var htmlcontent = '';
	htmlcontent+=$('#editlightswitch').html();
	$('#lightcontent').html(GetBackbuttonHTMLTable('ShowLights')+htmlcontent);
	$('#lightcontent').i18n();
	
	oTable = $('#lightcontent #subdevicestable').dataTable( {
		"sDom": '<"H"frC>t<"F"i>',
		"oTableTools": {
			"sRowSelect": "single",
		},
		"aaSorting": [[ 0, "desc" ]],
		"bSortClasses": false,
		"bProcessing": true,
		"bStateSave": true,
		"bJQueryUI": true,
		"sPaginationType": "full_numbers"
	});

	var sat=100;
	var cHSB=[];
	cHSB.h=128;
	cHSB.s=sat;
	cHSB.b=100;
	$('#lightcontent #Brightness').val(100);
	$('#lightcontent #Hue').val(128);
	
	$.bIsLED=(devsubtype.indexOf("RGB") >= 0);
	$.bIsRGB=(devsubtype=="RGB");
	$.bIsRGBW=(devsubtype=="RGBW");
	$.bIsWhite=(devsubtype=="White");

	if ($.bIsLED==true) {
		$("#lightcontent #LedColor").show();
	}
	else {
		$("#lightcontent #LedColor").hide();
	}
	if ($.bIsRGB==true) {
		$("#lightcontent #optionsRGB").show();
	}
	else {
		$("#lightcontent #optionsRGB").hide();
	}
	if ($.bIsRGBW==true) {
		$("#lightcontent #optionsRGBW").show();
	}
	else {
		$("#lightcontent #optionsRGBW").hide();
	}
	if ($.bIsWhite) {
		$("#lightcontent #optionsWhite").show();
	}
	else {
		$("#lightcontent #optionsWhite").hide();
	}
	$('#lightcontent #picker').colpick({
		flat:true,
		layout:'hex',
		submit:0,
		onChange:function(hsb,hex,rgb,fromSetColor) {
			if(!fromSetColor) {
				$('#lightcontent #Hue').val(hsb.h);
				$('#lightcontent #Brightness').val(hsb.b);
				var bIsWhite=(hsb.s<20);
				$("#lightcontent #optionRGB").prop('checked',!bIsWhite);
				$("#lightcontent #optionWhite").prop('checked',bIsWhite);
				clearInterval($.setColValue);
				$.setColValue = setInterval(function() { SetColValue($.devIdx,hsb.h,hsb.b); }, 200);
			}
		}
	});
	$("#lightcontent #optionRGB").prop('checked',(sat==100));
	$("#lightcontent #optionWhite").prop('checked',!(sat==100));

	$('#lightcontent #picker').colpickSetColor(cHSB);

	$("#lightcontent #devicename").val(name);
	
	if ($.stype=="Security") {
		$("#lightcontent #SwitchType").hide();
		$("#lightcontent #OnDelayDiv").hide();
		$("#lightcontent #OffDelayDiv").hide();
		$("#lightcontent #MotionDiv").hide();
		$("#lightcontent #SwitchIconDiv").hide();
		$("#lightcontent #onaction").val(atob(strParam1));
		$("#lightcontent #offaction").val(atob(strParam2));
	}
	else {
		$("#lightcontent #SwitchType").show();
		$("#lightcontent #comboswitchtype").change(function() {
			var switchtype=$("#lightcontent #comboswitchtype").val();
			$("#lightcontent #OnDelayDiv").hide();
			$("#lightcontent #OffDelayDiv").hide();
			$("#lightcontent #MotionDiv").hide();
			$("#lightcontent #SwitchIconDiv").hide();
			if (switchtype==8) {
				$("#lightcontent #MotionDiv").show();
				$("#lightcontent #motionoffdelay").val(addjvalue);
			}
			else if ((switchtype==0)||(switchtype==9)||(switchtype==11)) {
				$("#lightcontent #OnDelayDiv").show();
				$("#lightcontent #OffDelayDiv").show();
				$("#lightcontent #offdelay").val(addjvalue);
				$("#lightcontent #ondelay").val(addjvalue2);
			}
			if (switchtype==0) {
				$("#lightcontent #SwitchIconDiv").show();
			}
		});
		
		$("#lightcontent #comboswitchtype").val(switchtype);

		$("#lightcontent #OnDelayDiv").hide();
		$("#lightcontent #OffDelayDiv").hide();
		$("#lightcontent #MotionDiv").hide();
		$("#lightcontent #SwitchIconDiv").hide();
		if (switchtype==8) {
			$("#lightcontent #MotionDiv").show();
			$("#lightcontent #motionoffdelay").val(addjvalue);
		}
		else if ((switchtype==0)||(switchtype==9)||(switchtype==11)) {
			$("#lightcontent #OnDelayDiv").show();
			$("#lightcontent #OffDelayDiv").show();
			$("#lightcontent #offdelay").val(addjvalue);
			$("#lightcontent #ondelay").val(addjvalue2);
		}
		if (switchtype==0) {
			$("#lightcontent #SwitchIconDiv").show();
		}
		$("#lightcontent #combosubdevice").html("");
		
		$("#lightcontent #onaction").val(atob(strParam1));
		$("#lightcontent #offaction").val(atob(strParam2));
		
		$('#lightcontent #protected').prop('checked',(bIsProtected==true));
		
		$.each($.LightsAndSwitches, function(i,item){
			var option = $('<option />');
			option.attr('value', item.idx).text(item.name);
			$("#lightcontent #combosubdevice").append(option);
		});

		$('#lightcontent #comboswitchicon').ddslick({
			data: $.ddData,
			width:200,
			selectText: "Select Switch Icon",
			imagePosition:"left"
		});
		//alert(customimage);
		 var i=customimage;
		 $('#lightcontent #comboswitchicon').ddslick('select', {index: i });
	}
	
	RefreshSubDeviceTable(idx);
}

function AddManualLightDevice()
{
	clearInterval($.myglobals.refreshTimer);

	$("#dialog-addmanuallightdevice #combosubdevice").html("");
	
	$.each($.LightsAndSwitches, function(i,item){
		var option = $('<option />');
		option.attr('value', item.idx).text(item.name);
		$("#dialog-addmanuallightdevice #combosubdevice").append(option);
	});
	$( "#dialog-addmanuallightdevice #comboswitchtype" ).val(0);
	$( "#dialog-addmanuallightdevice" ).dialog( "open" );
}

function AddLightDevice()
{
	clearInterval($.myglobals.refreshTimer);
  
    $("#dialog-addlightdevice #combosubdevice").html("");
	$.each($.LightsAndSwitches, function(i,item){
		var option = $('<option />');
		option.attr('value', item.idx).text(item.name);
		$("#dialog-addlightdevice #combosubdevice").append(option);
	});
  
	ShowNotify($.i18n('Press button on Remote...'));

	setTimeout(function() {
		var bHaveFoundDevice = false;
		var deviceID = "";
		var deviceidx = 0;
		var bIsUsed = false;
		var Name = "";

		$.ajax({
		   url: "json.htm?type=command&param=learnsw", 
		   async: false, 
		   dataType: 'json',
		   success: function(data) {
			if (typeof data.status != 'undefined') {
			  if (data.status == 'OK')
			  {
				bHaveFoundDevice=true;
				deviceID=data.ID;
				deviceidx=data.idx;
				bIsUsed=data.Used;
				Name=data.Name;
			  }
			}
		   }
		});
		HideNotify();

		setTimeout(function() {
			if ((bHaveFoundDevice == true) && (bIsUsed == false))
			{
				$.devIdx = deviceidx;
				$( "#dialog-addlightdevice" ).dialog( "open" );
			}
			else {
				if (bIsUsed == true)
					ShowNotify($.i18n('Already used by') + ':<br>"' + Name +'"', 3500, true);
				else
					ShowNotify($.i18n('Timeout...<br>Please try again!'), 2500, true);
			}
		}, 200);
	}, 600);
}

function RefreshHardwareComboArray()
{
	$.ComboHardware = [];
	$.ajax({
		url: "json.htm?type=command&param=getmanualhardware", 
		async: false, 
		dataType: 'json',
		success: function(data) {
			if (typeof data.result != 'undefined') {
				$.each(data.result, function(i,item) {
					$.ComboHardware.push({
						idx: item.idx,
						name: item.Name
					});
				});
			}
		}
	});
}

function RefreshGpioComboArray()
{
	$.ComboGpio = [];
	$.ajax({
		url: "json.htm?type=command&param=getgpio", 
		async: false, 
		dataType: 'json',
		success: function(data) {
			if (typeof data.result != 'undefined') {
				$.each(data.result, function(i,item) {
					$.ComboGpio.push({
						idx: item.idx,
						name: item.Name
					});
				});
			}
		}
	});
}

function RefreshLightSwitchesComboArray()
{
	$.LightsAndSwitches = [];
	$.ajax({
		url: "json.htm?type=command&param=getlightswitches", 
		async: false, 
		dataType: 'json',
		success: function(data) {
			if (typeof data.result != 'undefined') {
				$.each(data.result, function(i,item) {
					$.LightsAndSwitches.push({
						idx: item.idx,
						name: item.Name
					});
				});
			}
		}
	});
}

function RefreshLights()
{
  clearInterval($.myglobals.refreshTimer);
  var id="";
  
  $.ajax({
     url: "json.htm?type=devices&filter=light&used=true&order=Name&lastupdate="+$.LastUpdateTime,
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {

		if (typeof data.ActTime != 'undefined') {
			$.LastUpdateTime=parseInt(data.ActTime);
		}
      
        $.each(data.result, function(i,item){
					id="#lightcontent #" + item.idx;
					var obj=$(id);
					if (typeof obj != 'undefined') {
						if ($(id + " #name").html()!=item.Name) {
							$(id + " #name").html(item.Name);
						}
						var img="";
						var img2="";
						var img3="";
						if (item.SubType=="Security Panel") {
							img='<a href="secpanel/"><img src="images/security48.png" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></a>';
						}
						else if (item.SwitchType == "X10 Siren") {
							if (
									(item.Status == 'On')||
									(item.Status == 'Chime')||
									(item.Status == 'Group On')||
									(item.Status == 'All On')
								 )
							{
											img='<img src="images/siren-on.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
							else {
											img='<img src="images/siren-off.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
						}
						else if (item.SwitchType == "Doorbell") {
							img='<img src="images/doorbell48.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
						}
						else if (item.SwitchType == "Push On Button") {
							if (item.InternalState=="On") {
								img='<img src="images/pushon48.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
							else {
								img='<img src="images/push48.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
						}
						else if (item.SwitchType == "Door Lock") {
							if (item.InternalState=="Open") {
								img='<img src="images/door48open.png" title="' + $.i18n("Close Door") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
							else {
								img='<img src="images/door48.png" title="' + $.i18n("Open Door") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
						}
						else if (item.SwitchType == "Push Off Button") {
							img='<img src="images/pushoff48.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
						}
						else if (item.SwitchType == "Contact") {
							if (item.Status == 'Closed') {
								img='<img src="images/contact48.png" height="48" width="48">';
							}
							else {
								img='<img src="images/contact48_open.png" height="48" width="48">';
							}
						}
						else if ((item.SwitchType == "Blinds")||(item.SwitchType.indexOf("Venetian Blinds") == 0)) {
							if ((item.SubType=="RAEX")||(item.SubType.indexOf('A-OK') == 0)||(item.SubType.indexOf('RollerTrol') == 0)||(item.SubType=="Harrison")||(item.SubType.indexOf('RFY') == 0)||(item.SwitchType.indexOf("Venetian Blinds") == 0)) {
								if (item.Status == 'Closed') {
									img='<img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									img3='<img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
								else {
									img='<img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									img3='<img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
							}
							else {
								if (item.Status == 'Closed') {
									img='<img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									img2='<img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
								else {
									img='<img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									img2='<img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
							}
						}
						else if (item.SwitchType == "Blinds Inverted") {
							if ((item.SubType=="RAEX")||(item.SubType.indexOf('A-OK') == 0)||(item.SubType.indexOf('RollerTrol') == 0)||(item.SubType=="Harrison")||(item.SubType.indexOf('RFY') == 0)) {
								if (item.Status == 'Closed') {
									img='<img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									img3='<img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
								else {
									img='<img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									img3='<img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
							}
							else {
								if (item.Status == 'Closed') {
									img='<img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									img2='<img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
								else {
									img='<img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									img2='<img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
							}
						}
						else if (item.SwitchType == "Blinds Percentage") {
							if (item.Status == 'Closed') {
								img='<img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
								img2='<img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
							}
							else {
								img='<img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
								img2='<img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40">';
							}
						}
						else if (item.SwitchType=="Smoke Detector") {
								if (
										(item.Status == 'Panic')||
										(item.Status == 'On')
									) {
									img='<img src="images/smoke48on.png" title="' + $.i18n("Turn Alarm On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									$(id + ' #resetbtn').attr("class", "btnsmall-sel");
								}
								else {
									img='<img src="images/smoke48off.png" title="' + $.i18n("Turn Alarm On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									$(id + ' #resetbtn').attr("class", "btnsmall-dis");
								}

						}
						else if (item.Type == "Security") {
							if (item.SubType.indexOf('remote') > 0) {
								if ((item.Status.indexOf('Arm') >= 0)||(item.Status.indexOf('Panic') >= 0)) {
									img+='<img src="images/remote48.png" title="' + $.i18n("Turn Alarm Off") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">\n';
								}
								else {
									img+='<img src="images/remote48.png" title="' + $.i18n("Turn Alarm On") + '" onclick="ArmSystem(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">\n';
								}
							}
							else if (item.SubType == "X10 security") {
								if (item.Status.indexOf('Normal') >= 0) {
									img+='<img src="images/security48.png" title="' + $.i18n("Turn Alarm On") + '" onclick="SwitchLight(' + item.idx + ',\'' + ((item.Status == "Normal Delayed")?"Alarm Delayed":"Alarm") + '\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
								else {
									img+='<img src="images/Alarm48_On.png" title="' + $.i18n("Turn Alarm Off") + '" onclick="SwitchLight(' + item.idx + ',\'' + ((item.Status == "Alarm Delayed")?"Normal Delayed":"Normal") + '\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
							}
							else if (item.SubType == "X10 security motion") {
								if ((item.Status == "No Motion")) {
									img+='<img src="images/security48.png" title="' + $.i18n("Turn Alarm On") + '" onclick="SwitchLight(' + item.idx + ',\'Motion\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
								else {
									img+='<img src="images/Alarm48_On.png" title="' + $.i18n("Turn Alarm Off") + '" onclick="SwitchLight(' + item.idx + ',\'No Motion\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
								}
							}
							else if ((item.Status.indexOf('Alarm') >= 0)||(item.Status.indexOf('Tamper') >= 0)) {
								img='<img src="images/Alarm48_On.png" height="48" width="48">';
							}
							else {
								if (item.SubType.indexOf('Meiantech') >= 0) {
									if ((item.Status.indexOf('Arm') >= 0)||(item.Status.indexOf('Panic') >= 0)) {
										img='<img src="images/security48.png" title="' + $.i18n("Turn Alarm Off") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									}
									else {
										img='<img src="images/security48.png" title="' + $.i18n("Turn Alarm On") + '" onclick="ArmSystemMeiantech(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
									}
								}
								else {
									img='<img src="images/security48.png" height="48" width="48">';
								}
							}
						}
            else if (item.SwitchType == "Dimmer") {
							if (
									(item.Status == 'On')||
									(item.Status == 'Chime')||
									(item.Status == 'Group On')||
									(item.Status.indexOf('Set ') == 0)
								 ) {
											img='<img src="images/dimmer48-on.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
							else {
											img='<img src="images/dimmer48-off.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
            }
            else if (item.SwitchType == "Dusk Sensor") {
							if (
									(item.Status == 'On')
								 ) {
											img='<img src="images/uvdark.png" title="' + $.i18n("Nighttime") +'"  height="48" width="48">';
							}
							else {
											img='<img src="images/uvsunny.png" title="' + $.i18n("Daytime") +'"  height="48" width="48">';
							}
            }            
            else if (item.SwitchType == "Motion Sensor") {
							if (
									(item.Status == 'On')||
									(item.Status == 'Chime')||
									(item.Status == 'Group On')||
									(item.Status.indexOf('Set ') == 0)
								 ) {
											img='<img src="images/motion48-on.png" height="48" width="48">';
							}
							else {
											img='<img src="images/motion48-off.png" height="48" width="48">';
							}
            }
						else {
							if (
									(item.Status == 'On')||
									(item.Status == 'Chime')||
									(item.Status == 'Group On')||
									(item.Status.indexOf('Set ') == 0)
								 ) {
										img='<img src="images/' + item.Image + '48_On.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
							else {
										img='<img src="images/' + item.Image + '48_Off.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
							}
						}
						if ($(id + " #img").html()!=img) {
							$(id + " #img").html(img);
						}
						if (img2!="")
						{
							if ($(id + " #img2").html()!=img2) {
								$(id + " #img2").html(img2);
							}
						}
						if (img3!="")
						{
							if ($(id + " #img3").html()!=img3) {
								$(id + " #img3").html(img3);
							}
						}
						if ($(id + " #status").html()!=TranslateStatus(item.Status)) {
							$(id + " #status").html(TranslateStatus(item.Status));
						}
						if ($(id + " #lastupdate").html()!=item.LastUpdate) {
							$(id + " #lastupdate").html(item.LastUpdate);
						}
					}
        });
      }
     }
  });
  RefreshTimeAndSun();
  $.myglobals.refreshTimer = setInterval(RefreshLights, 10000);
}

function ShowLights()
{
  clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  
  RefreshLightSwitchesComboArray();
  
  var htmlcontent = '';
  var bHaveAddedDevider = false;
	var bAllowWidgetReorder=true;

	var suntext='<div id="timesun" />\n';

  var tophtm=
				'\t<center>' + suntext + '</center>\n';
	if (window.my_config.userrights==2) {
		tophtm+=
			'\t<table class="bannav" id="bannav" border="0" cellpadding="0" cellspacing="0" width="100%">\n' +
			'\t<tr>\n' +
			'\t  <td align="left"><a class="btnstylerev" onclick="AddManualLightDevice();" data-i18n="Manual Light/Switch">Manual Light/Switch</a></td>\n' +
			'\t  <td align="right"><a class="btnstyle" onclick="AddLightDevice();" data-i18n="Learn Light/Switch">Learn Light/Switch</a></td>\n' +
			'\t</tr>\n' +
			'\t</table>\n';
	}

  var i=0;
	var j=0;

  $.ajax({
     url: "json.htm?type=devices&filter=light&used=true&order=Name", 
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {
		bAllowWidgetReorder=data.AllowWidgetOrdering;

		if (typeof data.ActTime != 'undefined') {
			$.LastUpdateTime=parseInt(data.ActTime);
		}

        $.each(data.result, function(i,item){
          if (j % 3 == 0)
          {
            //add devider
            if (bHaveAddedDevider == true) {
              //close previous devider
              htmlcontent+='</div>\n';
            }
            htmlcontent+='<div class="row divider">\n';
            bHaveAddedDevider=true;
          }
          var bAddTimer=true;
          var bIsDimmer=false;
          var xhtm=
                '\t<div class="span4" id="' + item.idx + '">\n' +
                '\t  <section>\n';
			if (item.SwitchType == "Doorbell") {
				xhtm+='\t    <table id="itemtablenostatus" border="0" cellpadding="0" cellspacing="0">\n';
			}
			else if ((item.SwitchType == "Blinds")||(item.SwitchType == "Blinds Inverted")||(item.SwitchType == "Blinds Percentage")||(item.SwitchType.indexOf("Venetian Blinds") == 0)) {
				if ((item.SubType=="RAEX")||(item.SubType.indexOf('A-OK') == 0)||(item.SubType.indexOf('RollerTrol') == 0)||(item.SubType=="Harrison")||(item.SubType.indexOf('RFY') == 0)||(item.SwitchType.indexOf("Venetian Blinds") == 0)) {
					xhtm+='\t    <table id="itemtabletrippleicon" border="0" cellpadding="0" cellspacing="0">\n';
				}
				else {
					xhtm+='\t    <table id="itemtabledoubleicon" border="0" cellpadding="0" cellspacing="0">\n';
				}
			}
			else {
				xhtm+='\t    <table id="itemtable" border="0" cellpadding="0" cellspacing="0">\n';
			}
			
			var nbackcolor="#D4E1EE";
			if (item.Protected==true) {
				nbackcolor="#A4B1EE";
			}
			
			xhtm+=
                '\t    <tr>\n' +
                '\t      <td id="name" style="background-color: ' + nbackcolor + ';">' + item.Name + '</td>\n' +
								'\t      <td id="bigtext">';
		  if (item.UsedByCamera==true) {
			var streamimg='<img src="images/webcam.png" title="' + $.i18n('Stream Video') +'" height="16" width="16">';
			streamurl="<a href=\"javascript:ShowCameraLiveStream('" + item.Name + "','" + item.CameraIdx + "')\">" + streamimg + "</a>";
			xhtm+=streamurl;
		  }
		  
		  xhtm+='</td>\n';
		  if (item.SubType=="Security Panel") {
			xhtm+='\t      <td id="img"><a href="secpanel/"><img src="images/security48.png" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></a></td>\n';
		  }
          else if (item.SwitchType == "X10 Siren") {
            if (
                (item.Status == 'On')||
                (item.Status == 'Chime')||
                (item.Status == 'Group On')||
                (item.Status == 'All On')
               ) {
                    xhtm+='\t      <td id="img"><img src="images/siren-on.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
            }
            else {
                    xhtm+='\t      <td id="img"><img src="images/siren-off.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
            }
          }
          else if (item.SwitchType == "Doorbell") {
            xhtm+='\t      <td id="img"><img src="images/doorbell48.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
            bAddTimer=false;
          }
          else if (item.SwitchType == "Push On Button") {
			if (item.InternalState=="On") {
				xhtm+='\t      <td id="img"><img src="images/pushon48.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
			}
			else {
				xhtm+='\t      <td id="img"><img src="images/push48.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
			}
          }
          else if (item.SwitchType == "Door Lock") {
			if (item.InternalState=="Open") {
				xhtm+='\t      <td id="img"><img src="images/door48open.png" title="' + $.i18n("Close Door") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
			}
			else {
				xhtm+='\t      <td id="img"><img src="images/door48.png" title="' + $.i18n("Open Door") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
			}
            bAddTimer=false;
          }
          else if (item.SwitchType == "Push Off Button") {
            xhtm+='\t      <td id="img"><img src="images/pushoff48.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
          }
          else if (item.SwitchType == "Contact") {
			if (item.Status == 'Closed') {
				xhtm+='\t      <td id="img"><img src="images/contact48.png" height="48" width="48"></td>\n';
			}
			else {
				xhtm+='\t      <td id="img"><img src="images/contact48_open.png" height="48" width="48"></td>\n';
			}
			bAddTimer=false;
          }
          else if ((item.SwitchType == "Blinds")||(item.SwitchType.indexOf("Venetian Blinds") == 0)) {
			if ((item.SubType=="RAEX")||(item.SubType.indexOf('A-OK') == 0)||(item.SubType.indexOf('RollerTrol') == 0)||(item.SubType=="Harrison")||(item.SubType.indexOf('RFY') == 0)||(item.SwitchType.indexOf("Venetian Blinds") == 0)) {
				if (item.Status == 'Closed') {
					xhtm+='\t      <td id="img"><img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
					xhtm+='\t      <td id="img2"><img src="images/blindsstop.png" title="Stop Blinds" onclick="SwitchLight(' + item.idx + ',\'Stop\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="24"></td>\n';
					xhtm+='\t      <td id="img3"><img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
				else {
					xhtm+='\t      <td id="img"><img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
					xhtm+='\t      <td id="img2"><img src="images/blindsstop.png" title="Stop Blinds" onclick="SwitchLight(' + item.idx + ',\'Stop\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="24"></td>\n';
					xhtm+='\t      <td id="img3"><img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
			}
			else {
				if (item.Status == 'Closed') {
					xhtm+='\t      <td id="img"><img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
					xhtm+='\t      <td id="img2"><img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
				else {
					xhtm+='\t      <td id="img"><img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
					xhtm+='\t      <td id="img2"><img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
			}
          }
          else if (item.SwitchType == "Blinds Inverted") {
			if ((item.SubType=="RAEX")||(item.SubType.indexOf('A-OK') == 0)||(item.SubType.indexOf('RollerTrol') == 0)||(item.SubType=="Harrison")||(item.SubType.indexOf('RFY') == 0)) {
				if (item.Status == 'Closed') {
					xhtm+='\t      <td id="img"><img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
					xhtm+='\t      <td id="img2"><img src="images/blindsstop.png" title="Stop Blinds" onclick="SwitchLight(' + item.idx + ',\'Stop\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="24"></td>\n';
					xhtm+='\t      <td id="img3"><img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
				else {
					xhtm+='\t      <td id="img"><img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
					xhtm+='\t      <td id="img2"><img src="images/blindsstop.png" title="Stop Blinds" onclick="SwitchLight(' + item.idx + ',\'Stop\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="24"></td>\n';
					xhtm+='\t      <td id="img3"><img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
			}
			else {
				if (item.Status == 'Closed') {
					xhtm+='\t      <td id="img"><img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
					xhtm+='\t      <td id="img2"><img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
				else {
					xhtm+='\t      <td id="img"><img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
					xhtm+='\t      <td id="img2"><img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
			}
          }
          else if (item.SwitchType == "Blinds Percentage") {
			bIsDimmer=true;
			if (item.Status == 'Closed') {
				xhtm+='\t      <td id="img"><img src="images/blindsopen48.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
				xhtm+='\t      <td id="img2"><img src="images/blinds48sel.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
			}
			else {
				xhtm+='\t      <td id="img"><img src="images/blindsopen48sel.png" title="' + $.i18n("Open Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
				xhtm+='\t      <td id="img2"><img src="images/blinds48.png" title="' + $.i18n("Close Blinds") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="40"></td>\n';
			}
          }
			else if (item.SwitchType=="Smoke Detector") {
				if (
						(item.Status == 'Panic')||
						(item.Status == 'On')
					 ) {
						xhtm+='\t      <td id="img"><img src="images/smoke48on.png" title="' + $.i18n("Turn Alarm On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
				else {
					xhtm+='\t      <td id="img"><img src="images/smoke48off.png" title="' + $.i18n("Turn Alarm On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
				}
			}
					else if (item.Type == "Security") {
						if (item.SubType.indexOf('remote') > 0) {
							if ((item.Status.indexOf('Arm') >= 0)||(item.Status.indexOf('Panic') >= 0)) {
								xhtm+='\t      <td id="img"><img src="images/remote48.png" title="' + $.i18n("Turn Alarm Off") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
							}
							else {
								xhtm+='\t      <td id="img"><img src="images/remote48.png" title="' + $.i18n("Turn Alarm On") + '" onclick="ArmSystem(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
							}
						}
						else if (item.SubType == "X10 security") {
							if (item.Status.indexOf('Normal') >= 0) {
								xhtm+='\t      <td id="img"><img src="images/security48.png" title="' + $.i18n("Turn Alarm On") + '" onclick="SwitchLight(' + item.idx + ',\'' + ((item.Status == "Normal Delayed")?"Alarm Delayed":"Alarm") + '\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
							}
							else {
								xhtm+='\t      <td id="img"><img src="images/Alarm48_On.png" title="' + $.i18n("Turn Alarm Off") + '" onclick="SwitchLight(' + item.idx + ',\'' + ((item.Status == "Alarm Delayed")?"Normal Delayed":"Normal") + '\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
							}
						}
						else if (item.SubType == "X10 security motion") {
							if ((item.Status == "No Motion")) {
								xhtm+='\t      <td id="img"><img src="images/security48.png" title="' + $.i18n("Turn Alarm On") + '" onclick="SwitchLight(' + item.idx + ',\'Motion\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
							}
							else {
								xhtm+='\t      <td id="img"><img src="images/Alarm48_On.png" title="' + $.i18n("Turn Alarm Off") + '" onclick="SwitchLight(' + item.idx + ',\'No Motion\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
							}
						}
						else if ((item.Status.indexOf('Alarm') >= 0)||(item.Status.indexOf('Tamper') >= 0)) {
							xhtm+='\t      <td id="img"><img src="images/Alarm48_On.png" height="48" width="48"></td>\n';
						}
						else {
							if (item.SubType.indexOf('Meiantech') >= 0) {
								if ((item.Status.indexOf('Arm') >= 0)||(item.Status.indexOf('Panic') >= 0)) {
									xhtm+='\t      <td id="img"><img src="images/security48.png" title="' + $.i18n("Turn Alarm Off") + '" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
								}
								else {
									xhtm+='\t      <td id="img"><img src="images/security48.png" title="' + $.i18n("Turn Alarm On") + '" onclick="ArmSystemMeiantech(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
								}
							}
							else {
								xhtm+='\t      <td id="img"><img src="images/security48.png" height="48" width="48"></td>\n';
							}
						}
						bAddTimer=false;
					}
					else if (item.SwitchType == "Dimmer") {
						bIsDimmer=true;
						if (
							(item.Status == 'On')||
							(item.Status == 'Chime')||
							(item.Status == 'Group On')||
							(item.Status.indexOf('Set ') == 0)
						   ) {
								xhtm+='\t      <td id="img"><img src="images/dimmer48-on.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
							 }
							 else {
								xhtm+='\t      <td id="img"><img src="images/dimmer48-off.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
							 }
					}
					else if (item.SwitchType == "Dusk Sensor") {
						bAddTimer=false;
						if (item.Status == 'On')
							{
								xhtm+='\t      <td id="img"><img src="images/uvdark.png" title="' + $.i18n("Nighttime") +'  height="48" width="48"></td>\n';
							}
							else {
								xhtm+='\t      <td id="img"><img src="images/uvsunny.png" title="' + $.i18n("Daytime") + '  height="48" width="48"></td>\n';
							}
					}					
					else if (item.SwitchType == "Motion Sensor") {
						if (
							(item.Status == 'On')||
							(item.Status == 'Chime')||
							(item.Status == 'Group On')||
							(item.Status.indexOf('Set ') == 0)
						   ) {
								xhtm+='\t      <td id="img"><img src="images/motion48-on.png" height="48" width="48"></td>\n';
							}
							else {
								xhtm+='\t      <td id="img"><img src="images/motion48-off.png" height="48" width="48"></td>\n';
							}
							bAddTimer=false;
					}
				  else {
					if (
						(item.Status == 'On')||
						(item.Status == 'Chime')||
						(item.Status == 'Group On')||
						(item.Status.indexOf('Set ') == 0)
					   ) {
							xhtm+='\t      <td id="img"><img src="images/' + item.Image + '48_On.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + item.idx + ',\'Off\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
						}
						else {
							xhtm+='\t      <td id="img"><img src="images/' + item.Image + '48_Off.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + item.idx + ',\'On\',RefreshLights,' + item.Protected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48"></td>\n';
						}
				  }
			xhtm+=
                '\t      <td id="status">' + TranslateStatus(item.Status) + '</td>\n' +
                '\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n' +
                '\t      <td id="type">' + item.Type + ', ' + item.SubType + ', ' + item.SwitchType;
			if (item.SwitchType == "Dimmer") {
				xhtm+='<br><div style="margin-left:60px;" class="dimslider" id="slider" data-idx="' + item.idx + '" data-type="norm" data-maxlevel="' + item.MaxDimLevel + '" data-isprotected="' + item.Protected + '" data-svalue="' + item.LevelInt + '"></div>';
			}
			else if (item.SwitchType == "Blinds Percentage") {
				xhtm+='<br><div style="margin-left:60px;" class="dimslider" id="slider" data-idx="' + item.idx + '" data-type="blinds" data-maxlevel="' + item.MaxDimLevel + '" data-isprotected="' + item.Protected + '" data-svalue="' + item.LevelInt + '"></div>';
			}
			xhtm+=
						'</td>\n' +
						'\t      <td>';
			  if (item.Favorite == 0) {
				xhtm+=      
					  '<img src="images/nofavorite.png" title="' + $.i18n('Add to Dashboard') + '" onclick="MakeFavorite(' + item.idx + ',1);" onmouseover="cursorhand()" onmouseout="cursordefault()">&nbsp;&nbsp;&nbsp;&nbsp;';
			  }
			  else {
				xhtm+=      
					  '<img src="images/favorite.png" title="' + $.i18n('Remove from Dashboard') +'" onclick="MakeFavorite(' + item.idx + ',0);" onmouseover="cursorhand()" onmouseout="cursordefault()">&nbsp;&nbsp;&nbsp;&nbsp;';
			  }
          xhtm+=
                '<a class="btnsmall" onclick="ShowLightLog(' + item.idx + ',\'' + item.Name  + '\', \'#lightcontent\', \'ShowLights\');" data-i18n="Log">Log</a> ';
          if (window.my_config.userrights==2) {
			  xhtm+=
					'<a class="btnsmall" onclick="EditLightDevice(' + item.idx + ',\'' + item.Name + '\', ' + '\'' + item.Type + '\', ' + item.SwitchTypeVal +', ' + item.AddjValue + ', ' + item.AddjValue2 + ', ' + item.IsSubDevice + ', ' + item.CustomImage + ', \'' + item.SubType + '\', \'' + item.StrParam1 + '\', \'' + item.StrParam2 + '\', ' + item.Protected +');" data-i18n="Edit">Edit</a> ';
						if (bAddTimer == true) {
									if (item.Timers == "true") {
										xhtm+='<a class="btnsmall-sel" onclick="ShowTimers(' + item.idx + ',\'' + item.Name + '\',' + bIsDimmer + ',\'' + item.Type + '\'' + ', \'' + item.SubType + '\');" data-i18n="Timers">Timers</a> ';
									}
									else {
										xhtm+='<a class="btnsmall" onclick="ShowTimers(' + item.idx + ',\'' + item.Name + '\',' + bIsDimmer + ',\'' + item.Type + '\'' + ', \'' + item.SubType + '\');" data-i18n="Timers">Timers</a> ';
									}
						}
						if (item.SwitchType == "Smoke Detector") {
							if (
									(item.Status == 'Panic')||
									(item.Status == 'On')
								 ) {
								xhtm+='<a id="resetbtn" class="btnsmall-sel" onclick="ResetSecurityStatus(' + item.idx + ',\'Normal\',ShowLights);" data-i18n="Reset">Reset</a> ';
							}
							else {
								xhtm+='<a id="resetbtn" class="btnsmall-dis" onclick="ResetSecurityStatus(' + item.idx + ',\'Normal\',ShowLights);" data-i18n="Reset">Reset</a> ';
							}
			  }					
			  if (item.Notifications == "true")
				xhtm+='<a class="btnsmall-sel" onclick="ShowNotifications(' + item.idx + ',\'' + item.Name + '\', \'#lightcontent\', \'ShowLights\');" data-i18n="Notifications">Notifications</a>';
			  else
				xhtm+='<a class="btnsmall" onclick="ShowNotifications(' + item.idx + ',\'' + item.Name + '\', \'#lightcontent\', \'ShowLights\');" data-i18n="Notifications">Notifications</a>';
		  }
          xhtm+=
                '</td>\n' +
                '\t    </tr>\n' +
                '\t    </table>\n' +
                '\t  </section>\n' +
                '\t</div>\n';
          htmlcontent+=xhtm;
          j+=1;
        });
      }
     }
  });
  if (bHaveAddedDevider == true) {
    //close previous devider
    htmlcontent+='</div>\n';
  }
  if (htmlcontent == '')
  {
    htmlcontent='<h2>' + $.i18n('No Lights/Switches found or added in the system...') + '</h2>';
  }
  $('#modal').hide();
  $('#lightcontent').html(tophtm+htmlcontent);
  $('#lightcontent').i18n();

	if (bAllowWidgetReorder==true) {
		if (window.my_config.userrights==2) {
		  if (window.myglobals.ismobileint==false) {
				$("#lightcontent .span4").draggable({
						drag: function() {
							clearInterval($.myglobals.refreshTimer);
							$.devIdx=$(this).attr("id");
							$(this).css("z-index", 2);
						},
						revert: true
				});
				$("#lightcontent .span4").droppable({
						drop: function() {
							var myid=$(this).attr("id");
							$.devIdx.split(' ');
							$.ajax({
								 url: "json.htm?type=command&param=switchdeviceorder&idx1=" + myid + "&idx2=" + $.devIdx,
								 async: false, 
								 dataType: 'json',
								 success: function(data) {
										ShowLights();
								 }
							});
						}
				});
			}
		}
	}
	RefreshTimeAndSun();
	
	//Create Dimmer Sliders
	$('#lightcontent .dimslider').slider({
		//Config
		range: "min",
		min: 1,
		max: 16,
		value: 5,

		//Slider Events
		create: function(event,ui ) {
			$( this ).slider( "option", "max", $( this ).data('maxlevel'));
			$( this ).slider( "option", "type", $( this ).data('type'));
			$( this ).slider( "option", "isprotected", $( this ).data('isprotected'));
			$( this ).slider( "value", $( this ).data('svalue')+1 );
		},
		slide: function(event, ui) { //When the slider is sliding
			clearInterval($.setDimValue);
			var maxValue=$( this ).slider( "option", "max");
			var dtype=$( this ).slider( "option", "type");
			var isProtected=$( this ).slider( "option", "isprotected");
			var fPercentage=0;
			if (ui.value!=1) {
				fPercentage=parseInt((100.0/(maxValue-1))*((ui.value-1)));
			}
			var idx=$( this ).data('idx');
			id="#lightcontent #" + idx;
			var obj=$(id);
			if (typeof obj != 'undefined') {
				var img="";
				var status="";
				if (fPercentage==0)
				{
					img='<img src="images/dimmer48-off.png" title="' + $.i18n("Turn On") + '" onclick="SwitchLight(' + idx + ',\'On\',RefreshLights,' + isProtected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
					status="Off";
				}
				else {
					img='<img src="images/dimmer48-on.png" title="' + $.i18n("Turn Off") +'" onclick="SwitchLight(' + idx + ',\'Off\',RefreshLights,' + isProtected +');" onmouseover="cursorhand()" onmouseout="cursordefault()" height="48" width="48">';
					status="Set Level: " + fPercentage + " %";
				}
				if (dtype!="blinds") {
					if ($(id + " #img").html()!=img) {
						$(id + " #img").html(img);
					}
				}
				if ($(id + " #status").html()!=status) {
					$(id + " #status").html(status);
				}
			}
			$.setDimValue = setInterval(function() { SetDimValue(idx,ui.value); }, 500);
		}
	});
	ResizeDimSliders();
  $.myglobals.refreshTimer = setInterval(RefreshLights, 10000);
  return false;
}

function ResizeDimSliders()
{
	var width=$(".span4").width()-90;
	$("#lightcontent .dimslider").width(width);
}

$.strPad = function(i,l,s) {
	var o = i.toString();
	if (!s) { s = '0'; }
	while (o.length < l) {
		o = s + o;
	}
	return o;
};

function UpdateAddManualDialog()
{
	var lighttype=$("#dialog-addmanuallightdevice #lighttable #combolighttype option:selected").val();
	
	var bIsARCType=((lighttype<20)||(lighttype==101));
	var bIsType5=0;
	
	var tothousecodes=1;
	var totunits=1;
	if ((lighttype==0)||(lighttype==1)||(lighttype==3)||(lighttype==101)) {
		tothousecodes=16;
		totunits=16;
	}
	else if ((lighttype==2)||(lighttype==5)) {
		tothousecodes=16;
		totunits=64;
	}
	else if (lighttype==4) {
		tothousecodes=3;
		totunits=4;
	}
	else if (lighttype==6) {
		tothousecodes=4;
		totunits=4;
	}
	else if (lighttype==68) {
		//Do nothing. GPIO uses a custom form
	}
	else if (lighttype==7) {
		tothousecodes=16;
		totunits=8;
	}
	else if (lighttype==8) {
		tothousecodes=16;
		totunits=4;
	}
	else if (lighttype==9) {
		tothousecodes=4;
		totunits=4;
	}
	else if (lighttype==10) {
		tothousecodes=4;
		totunits=4;
	}
	else if (lighttype==60) {
		//Blyss
		tothousecodes=16;
		totunits=5;
	}
	else if (lighttype==70) {
		//EnOcean
		tothousecodes=128;
		totunits=2;
	}
	else if (lighttype==50) {
		//LightwaveRF
		bIsType5=1;
		totunits=16;
	}
	else if ((lighttype==55)||(lighttype==57)) {
		//Livolo
		bIsType5=1;
	}
	else if (lighttype==100) {
		//Chime/ByronSX
		bIsType5=1;
		totunits=4;
	}
	else if (lighttype==102) {
		//RFY
		bIsType5=1;
		totunits=16;
	}
	else if (lighttype==103) {
		//Meiantech
		bIsType5=1;
		totunits=0;
	}
	$("#dialog-addmanuallightdevice #lightingparams_enocean").hide();
	$("#dialog-addmanuallightdevice #lightingparams_gpio").hide();
	
	if (lighttype==60) {
		//Blyss
		$('#dialog-addmanuallightdevice #lightparams3 #combogroupcode >option').remove();
		$('#dialog-addmanuallightdevice #lightparams3 #combounitcode >option').remove();
		for (ii=0; ii<tothousecodes; ii++)
		{
			$('#dialog-addmanuallightdevice #lightparams3 #combogroupcode').append($('<option></option>').val(65+ii).html(String.fromCharCode(65+ii)));
		}
		for (ii=1; ii<totunits+1; ii++)
		{
			$('#dialog-addmanuallightdevice #lightparams3 #combounitcode').append($('<option></option>').val(ii).html(ii));
		}
		$("#dialog-addmanuallightdevice #lighting1params").hide();
		$("#dialog-addmanuallightdevice #lighting2params").hide();
		$("#dialog-addmanuallightdevice #lighting3params").show();
	}
	else if (lighttype==70) {
		//EnOcean
		$("#dialog-addmanuallightdevice #lightparams_enocean #comboid  >option").remove();
		$("#dialog-addmanuallightdevice #lightparams_enocean #combounitcode  >option").remove();
		for (ii=1; ii<tothousecodes+1; ii++)
		{
			$('#dialog-addmanuallightdevice #lightparams_enocean #comboid').append($('<option></option>').val(ii).html(ii));
		}
		for (ii=1; ii<totunits+1; ii++)
		{
			$('#dialog-addmanuallightdevice #lightparams_enocean #combounitcode').append($('<option></option>').val(ii).html(ii));
		}
		$("#dialog-addmanuallightdevice #lighting1params").hide();
		$("#dialog-addmanuallightdevice #lighting2params").hide();
		$("#dialog-addmanuallightdevice #lighting3params").hide();
		$("#dialog-addmanuallightdevice #lightingparams_enocean").show();
	}
	else if (lighttype==68) {
		//GPIO
		$("#dialog-addmanuallightdevice #lightparams_enocean #comboid  >option").remove();
		$("#dialog-addmanuallightdevice #lightparams_enocean #combounitcode  >option").remove();
		$("#dialog-addmanuallightdevice #lighting1params").hide();
		$("#dialog-addmanuallightdevice #lighting2params").hide();
		$("#dialog-addmanuallightdevice #lighting3params").hide();
		$("#dialog-addmanuallightdevice #lightingparams_gpio").show();
	}
	else if (bIsARCType==1) {
		$('#dialog-addmanuallightdevice #lightparams1 #combohousecode >option').remove();
		$('#dialog-addmanuallightdevice #lightparams1 #combounitcode >option').remove();
		for (ii=0; ii<tothousecodes; ii++)
		{
			$('#dialog-addmanuallightdevice #lightparams1 #combohousecode').append($('<option></option>').val(65+ii).html(String.fromCharCode(65+ii)));
		}
		for (ii=1; ii<totunits+1; ii++)
		{
			$('#dialog-addmanuallightdevice #lightparams1 #combounitcode').append($('<option></option>').val(ii).html(ii));
		}
		$("#dialog-addmanuallightdevice #lighting1params").show();
		$("#dialog-addmanuallightdevice #lighting2params").hide();
		$("#dialog-addmanuallightdevice #lighting3params").hide();
	}
	else {
		if (lighttype==103) {
			$("#dialog-addmanuallightdevice #lighting2paramsUnitCode").hide();
		}
		else {
			$("#dialog-addmanuallightdevice #lighting2paramsUnitCode").show();
		}
		$("#dialog-addmanuallightdevice #lighting2params #combocmd2").show();
		if (bIsType5==0) {
			$("#dialog-addmanuallightdevice #lighting2params #combocmd1").show();
		}
		else {
			$("#dialog-addmanuallightdevice #lighting2params #combocmd1").hide();
			if ((lighttype==55)||(lighttype==57)||(lighttype==100)) {
				$("#dialog-addmanuallightdevice #lighting2params #combocmd2").hide();
				if (lighttype!=100) {
					$("#dialog-addmanuallightdevice #lighting2paramsUnitCode").hide();
				}
			}
		}
		$("#dialog-addmanuallightdevice #lighting1params").hide();
		$("#dialog-addmanuallightdevice #lighting2params").show();
		$("#dialog-addmanuallightdevice #lighting3params").hide();
	}
}

function GetManualLightSettings(isTest)
{
	var mParams="";
	var hwdID=$("#dialog-addmanuallightdevice #lighttable #combohardware option:selected").val();
	if (typeof hwdID == 'undefined') {
			ShowNotify($.i18n('No Hardware Device selected!'), 2500, true);
			return "";
	}
	mParams+="&hwdid="+hwdID;
	
	var name=$("#dialog-addmanuallightdevice #devicename");
	if ((name.val()=="")||(!checkLength(name,2,100))) {
		if (!isTest) {
			ShowNotify($.i18n('Invalid Name!'), 2500, true);
			return "";
		}
	}
	mParams+="&name="+encodeURIComponent(name.val());
	mParams+="&switchtype="+$("#dialog-addmanuallightdevice #lighttable #comboswitchtype option:selected").val();
	var lighttype=$("#dialog-addmanuallightdevice #lighttable #combolighttype option:selected").val();
	mParams+="&lighttype="+lighttype;
	if (lighttype==60) {
		//Blyss
		mParams+="&groupcode="+$("#dialog-addmanuallightdevice #lightparams3 #combogroupcode option:selected").val();
		mParams+="&unitcode="+$("#dialog-addmanuallightdevice #lightparams3 #combounitcode option:selected").val();
		ID=
			$("#dialog-addmanuallightdevice #lightparams3 #combocmd1 option:selected").text()+
			$("#dialog-addmanuallightdevice #lightparams3 #combocmd2 option:selected").text();
		mParams+="&id="+ID;
	}
	else if (lighttype==70) {
		//EnOcean
		mParams+="&groupcode="+$("#dialog-addmanuallightdevice #lightingparams_enocean #comboid option:selected").val();
		mParams+="&unitcode="+$("#dialog-addmanuallightdevice #lightingparams_enocean #combounitcode option:selected").val();
		ID="EnOcean";
		mParams+="&id="+ID;
	}
	else if (lighttype==68) {
		//GPIO
		mParams+="&id=GPIO&unitcode="+$("#dialog-addmanuallightdevice #lightingparams_gpio #combogpio option:selected").val();
	}
	else if ((lighttype<20)||(lighttype==101)) {
		mParams+="&housecode="+$("#dialog-addmanuallightdevice #lightparams1 #combohousecode option:selected").val();
		mParams+="&unitcode="+$("#dialog-addmanuallightdevice #lightparams1 #combounitcode option:selected").val();
	}
	else {
		//AC
		var ID="";
		var bIsType5=0;
		if ((lighttype==50)||(lighttype==55)||(lighttype==57)||(lighttype==100)||(lighttype==102)||(lighttype==103))
		{
			bIsType5=1;
		}
		if (bIsType5==0) {
			ID=
				$("#dialog-addmanuallightdevice #lightparams2 #combocmd1 option:selected").text()+
				$("#dialog-addmanuallightdevice #lightparams2 #combocmd2 option:selected").text()+
				$("#dialog-addmanuallightdevice #lightparams2 #combocmd3 option:selected").text()+
				$("#dialog-addmanuallightdevice #lightparams2 #combocmd4 option:selected").text();
		}
		else {
			if ((lighttype!=55)&&(lighttype!=57)&&(lighttype!=100)) {
				ID=
					$("#dialog-addmanuallightdevice #lightparams2 #combocmd2 option:selected").text()+
					$("#dialog-addmanuallightdevice #lightparams2 #combocmd3 option:selected").text()+
					$("#dialog-addmanuallightdevice #lightparams2 #combocmd4 option:selected").text();
			}
			else {
				ID=
					$("#dialog-addmanuallightdevice #lightparams2 #combocmd3 option:selected").text()+
					$("#dialog-addmanuallightdevice #lightparams2 #combocmd4 option:selected").text();
			}
		}
		if (ID=="") {
			ShowNotify($.i18n('Invalid Switch ID!'), 2500, true);
			return "";
		}
		mParams+="&id="+ID;
		mParams+="&unitcode="+$("#dialog-addmanuallightdevice #lightparams2 #combounitcode option:selected").val();
	}

	var bIsSubDevice=$("#dialog-addmanuallightdevice #howtable #how_2").is(":checked");
	var MainDeviceIdx="";
	if (bIsSubDevice)
	{
		var MainDeviceIdx=$("#dialog-addmanuallightdevice #combosubdevice option:selected").val();
		if (typeof MainDeviceIdx == 'undefined') {
			bootbox.alert($.i18n('No Main Device Selected!'));
			return "";
		}
	}
	if (MainDeviceIdx!="")
	{
		mParams+="&maindeviceidx=" + MainDeviceIdx;
	}
	
	return mParams;
}

function TestManualLight()
{
	var mParams=GetManualLightSettings(1);
	if (mParams=="") {
		return;
	}
	$.ajax({
		 url: "json.htm?type=command&param=testswitch"+mParams, 
		 async: false, 
		 dataType: 'json',
		 success: function(data) {
			if (typeof data.status != 'undefined') {
				if (data.status != 'OK')
				{
					ShowNotify($.i18n("There was an error!<br>Wrong switch parameters?") + ((typeof data.message != 'undefined')?"<br>" + data.message:""), 2500,true);
				}
				else {
					ShowNotify($.i18n("'On' command send!"), 2500);
				}
			}
		 }
	});
}

function EnableDisableSubDevices(ElementID, bEnabled)
{
	var trow=$(ElementID);
	if (bEnabled == true) {
		trow.show();
	}
	else {
		trow.hide();
	}
}

$(document).ready(function() {
    //global var
    $.devIdx=0;
	$.LastUpdateTime=parseInt(0);
    
	$.myglobals = {
		TimerTypesStr : [],
		CommandStr : [],
		SelectedTimerIdx: 0
	};
	$.LightsAndSwitches = [];

	$('#timerparamstable #combotype > option').each(function() {
				 $.myglobals.TimerTypesStr.push($(this).text());
	});
	$('#timerparamstable #combocommand > option').each(function() {
				 $.myglobals.CommandStr.push($(this).text());
	});

	$(window).resize(function() { ResizeDimSliders(); });

    $( "#dialog-addlightdevice" ).dialog({
          autoOpen: false,
          width: 400,
          height: 290,
          modal: true,
          resizable: false,
          buttons: {
              "Add Device": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-addlightdevice #devicename"), 2, 100 );
									var bIsSubDevice=$("#dialog-addlightdevice #how_2").is(":checked");
									var MainDeviceIdx="";
									if (bIsSubDevice)
									{
										var MainDeviceIdx=$("#dialog-addlightdevice #combosubdevice option:selected").val();
										if (typeof MainDeviceIdx == 'undefined') {
											bootbox.alert($.i18n('No Main Device Selected!'));
											return;
										}
									}
                  
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + encodeURIComponent($("#dialog-addlightdevice #devicename").val()) + '&switchtype=' + $("#dialog-addlightdevice #comboswitchtype").val() + '&used=true&maindeviceidx=' + MainDeviceIdx,
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowLights();
                         }
                      });
                      
                  }
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });
		$("#dialog-addlightdevice #how_1").click(function() {
			EnableDisableSubDevices("#dialog-addlightdevice #subdevice",false);
		});
		$("#dialog-addlightdevice #how_2").click(function() {
			EnableDisableSubDevices("#dialog-addlightdevice #subdevice",true);
		});

    $( "#dialog-addmanuallightdevice" ).dialog({
          autoOpen: false,
          width: 440,
          height: 480,
          modal: true,
          resizable: false,
          buttons: {
              "Add Device": function() {
									var mParams=GetManualLightSettings(0);
									if (mParams=="") {
										return;
									}
									$.pDialog=$( this );
									$.ajax({
										 url: "json.htm?type=command&param=addswitch"+mParams, 
										 async: false, 
										 dataType: 'json',
										 success: function(data) {
											if (typeof data.status != 'undefined') {
												if (data.status == 'OK')
												{
													$.pDialog.dialog( "close" );
													ShowLights();
												}
												else {
													ShowNotify(data.message, 3000,true);
												}
											}
										 }
									});
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
				RefreshHardwareComboArray();
				
				$("#dialog-addmanuallightdevice #lighttable #combohardware").html("");
				$.each($.ComboHardware, function(i,item){
					var option = $('<option />');
					option.attr('value', item.idx).text(item.name);
					$("#dialog-addmanuallightdevice #lighttable #combohardware").append(option);
				});

				RefreshGpioComboArray();
				$("#combogpio").html("");
				$.each($.ComboGpio, function(i,item){
					var option = $('<option />');
					option.attr('value', item.idx).text(item.name);
					$("#combogpio").append(option);
				});

             	$("#dialog-addmanuallightdevice #lighttable #comboswitchtype").change(function() { 
								var switchtype=$("#dialog-addmanuallightdevice #lighttable #comboswitchtype option:selected").val();
								if (switchtype==1)
								{
									//AC device
									$("#dialog-addmanuallightdevice #lighttable #combolighttype").val(10);
									UpdateAddManualDialog();
								}
							});
             	$("#dialog-addmanuallightdevice #lighttable #combolighttype").change(function() { 
								UpdateAddManualDialog();
							});
							for (ii=0; ii<256; ii++)
							{
								$('#dialog-addmanuallightdevice #lightparams2 #combocmd2').append($('<option></option>').val(ii).html($.strPad(ii.toString(16).toUpperCase(),2)));
								$('#dialog-addmanuallightdevice #lightparams2 #combocmd3').append($('<option></option>').val(ii).html($.strPad(ii.toString(16).toUpperCase(),2)));
								$('#dialog-addmanuallightdevice #lightparams2 #combocmd4').append($('<option></option>').val(ii).html($.strPad(ii.toString(16).toUpperCase(),2)));
								$('#dialog-addmanuallightdevice #lightparams3 #combocmd1').append($('<option></option>').val(ii).html($.strPad(ii.toString(16).toUpperCase(),2)));
								$('#dialog-addmanuallightdevice #lightparams3 #combocmd2').append($('<option></option>').val(ii).html($.strPad(ii.toString(16).toUpperCase(),2)));
							}
							$('#dialog-addmanuallightdevice #lightparams2 #combounitcode >option').remove();
							for (ii=1; ii<16+1; ii++)
							{
								$('#dialog-addmanuallightdevice #lightparams2 #combounitcode').append($('<option></option>').val(ii).html(ii));
							}
							UpdateAddManualDialog();
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });

	$("#dialog-addmanuallightdevice #howtable #how_1").click(function() {
		EnableDisableSubDevices("#dialog-addmanuallightdevice #howtable #subdevice",false);
	});
	$("#dialog-addmanuallightdevice #howtable #how_2").click(function() {
		EnableDisableSubDevices("#dialog-addmanuallightdevice #howtable #subdevice",true);
	});

	$.ddData=[];
	//Get Custom icons
	$.ajax({
	 url: "json.htm?type=custom_light_icons", 
	 async: false, 
	 dataType: 'json',
	 success: function(data) {
		if (typeof data.result != 'undefined') {
			var totalItems=data.result.length;
			$.each(data.result, function(i,item){
				var bSelected=false;
				if (i==0) {
					bSelected=true;
				}
				var img="images/"+item.imageSrc+"48_On.png";
				$.ddData.push({ text: item.text, value: i, selected: bSelected, description: item.description, imageSrc: img });
			});
		}
	 }
   });

	ShowLights();
} );  
</script>