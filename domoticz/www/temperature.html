<div id="dialog-addtempdevice" title="Add Device">
    <form>
    <fieldset>
        <label for="name">Name: </label>
        <input type="text" id="devicename" style="width: 250px; padding: .4em;" class="text ui-widget-content ui-corner-all" />
    </fieldset>
    </form>
</div>
<div id="dialog-edittempdevice" title="Edit Device">
    <form>
    <fieldset>
        <label for="name">Name: </label>
        <input type="text" id="devicename" style="width: 250px; padding: .4em;" class="text ui-widget-content ui-corner-all" />
    </fieldset>
    </form>
</div>
<div id="tempcontent">
</div>
<div id="customlog" style="display:none;">
    <table width="95%">
        <tr>
            <td width="80%"><div id="customgraph" style="height: 400px;"></div></td>
            <td width="20%" style="padding-left:10px; padding-top:80px; vertical-align:top;">Select device(s) to display:<div id="devicecontainer" style="margin-top:10px; background-color: #7D7E7D; background-image: -moz-linear-gradient(center top , #7D7E7D, #0E0E0E); border: 1px solid #616261; width:100%; height: 240px; overflow-y: scroll;"></div>
                <div id="controlbar" style="height: 20px; padding: 5px;" align="center">
                    <table>
                        <tr><td align="left"><label for="graphfrom">From:&nbsp;</label></td>
                        <td><input type="text" style="width: 70px;" id="graphfrom" class="datepick" name="graphfrom" /></td>
                            <tr><td align="left"><label for="graphto">To:</label></td>
                        <td><input type="text" style="width: 70px;" id="graphto" class="datepick" name="graphto" /></td></tr>
                    </table>
                </div></td>
        </tr>
    </table>
</div>
<div id="templog" style="display:none;">
<h2>Day</h2><br>
<div id="tempdaygraph" style="height: 300px;"></div>
<br>
<h2>Month</h2><br>
<div id="tempmonthgraph" style="height: 300px;"></div>
<br>
<h2>Year</h2><br>
<div id="tempyeargraph" style="height: 300px;"></div>
</div>

<script type="text/javascript" charset="utf-8">

function MakeFavorite(id,isfavorite)
{
	clearInterval($.myglobals.refreshTimer);
  $.ajax({
     url: "json.htm?type=command&param=makefavorite&idx=" + id + "&isfavorite=" + isfavorite,
     async: false,
     dataType: 'json',
     success: function(data) {
      ShowTemps();
     }
  });
}
    

function EditTempDevice(idx,name)
{
	clearInterval($.myglobals.refreshTimer);
  $.devIdx=idx;
  $("#dialog-edittempdevice #devicename").val(name);
  $( "#dialog-edittempdevice" ).dialog( "open" );
}

function AddTempDevice()
{
  alert('todo, for now use the devices tab');
}

function AddDataToTempChart(data,chart,isday)
{
    var datatablete = [];
    var datatabletm = [];
    var datatablehu = [];
    var datatablech = [];
    var datatablecm = [];

    $.each(data.result, function(i,item)
    {
      if (isday==1) {
        if (typeof item.te != 'undefined') {
          datatablete.push( [GetUTCFromString(item.d), parseFloat(item.te) ] );
        }
        if (typeof item.hu != 'undefined') {
          datatablehu.push( [GetUTCFromString(item.d), parseFloat(item.hu) ] );
        }
        if (typeof item.ch != 'undefined') {
          datatablech.push( [GetUTCFromString(item.d), parseFloat(item.ch) ] );
        }
      } else {
        if (typeof item.te != 'undefined') {
          datatablete.push( [GetDateFromString(item.d), parseFloat(item.te) ] );
          datatabletm.push( [GetDateFromString(item.d), parseFloat(item.tm) ] );
        }
        if (typeof item.hu != 'undefined') {
          datatablehu.push( [GetDateFromString(item.d), parseFloat(item.hu) ] );
        }
        if (typeof item.ch != 'undefined') {
          datatablech.push( [GetDateFromString(item.d), parseFloat(item.ch) ] );
          datatablecm.push( [GetDateFromString(item.d), parseFloat(item.cm) ] );
        }
      }
    });
    var series;
    if (datatablehu.length!=0)
    {
      chart.addSeries(
        {
          id: 'humidity',
          name: 'Humidity',
          color: 'limegreen',
          yAxis: 1
        }
      );
      series = chart.get('humidity');
      series.setData(datatablehu);
    }

    if (datatablech.length!=0)
    {
      chart.addSeries(
        {
          id: 'chill',
          name: 'Chill',
          color: 'red',
          yAxis: 0
        }
      );
      series = chart.get('chill');
      series.setData(datatablech);
      
      if (isday==0) {
        chart.addSeries(
          {
            id: 'chillmin',
            name: 'Chill_min',
            color: 'rgba(255,127,39,0.8)',
            yAxis: 0
          }
        );
        series = chart.get('chillmin');
        series.setData(datatablecm);
      }
    }
    if (datatablete.length!=0)
    {
      //Add Temperature series
      chart.addSeries(
        {
          id: 'temperature',
          name: 'Temperature',
          color: 'yellow',
          yAxis: 0
        }
      );
      series = chart.get('temperature');
      series.setData(datatablete);
      if (isday==0) {
        chart.addSeries(
          {
            id: 'temperaturemin',
            name: 'Temperature_min',
            color: 'rgba(3,190,252,0.8)',
            yAxis: 0
          }
        );
        series = chart.get('temperaturemin');
        series.setData(datatabletm);
      }
    }
    //hide humidity label if not used
    //if (datatablehu.length==0) {
    //  var title = chart.yAxis[0].axisTitle;
    //  title.hide();
    //}
}

    
function AddMultipleDataToTempChart(data,chart,isday,deviceid,devicename)
{
    var datatablete = [];
    var datatabletm = [];
    var datatablehu = [];
    var datatablech = [];
    var datatablecm = [];

    $.each(data.result, function(i,item)
    {
      if (isday==1) {
        if (typeof item.te != 'undefined') {
          datatablete.push( [GetUTCFromString(item.d), parseFloat(item.te) ] );
        }
        if (typeof item.hu != 'undefined') {
          datatablehu.push( [GetUTCFromString(item.d), parseFloat(item.hu) ] );
        }
        if (typeof item.ch != 'undefined') {
          datatablech.push( [GetUTCFromString(item.d), parseFloat(item.ch) ] );
        }
      } else {
        if (typeof item.te != 'undefined') {
          datatablete.push( [GetDateFromString(item.d), parseFloat(item.te) ] );
          datatabletm.push( [GetDateFromString(item.d), parseFloat(item.tm) ] );
        }
        if (typeof item.hu != 'undefined') {
          datatablehu.push( [GetDateFromString(item.d), parseFloat(item.hu) ] );
        }
        if (typeof item.ch != 'undefined') {
          datatablech.push( [GetDateFromString(item.d), parseFloat(item.ch) ] );
          datatablecm.push( [GetDateFromString(item.d), parseFloat(item.cm) ] );
        }
      }
    });
    var series;

    if (datatablehu.length!=0)
    {
      chart.addSeries(
        {
          id: 'humidity'+deviceid,
          name: devicename+':humidity',
          yAxis: 1
        }
      );
      series = chart.get('humidity'+deviceid);
      series.setData(datatablehu);
    }

    if (datatablech.length!=0)
    {
      chart.addSeries(
        {
          id: 'chill'+deviceid,
          name: devicename+':chill',
          yAxis: 0
        }
      );
      series = chart.get('chill'+deviceid);
      series.setData(datatablech);
      
      if (isday==0) {
        chart.addSeries(
          {
            id: 'chillmin'+deviceid,
            name: devicename+':chill_min',
            yAxis: 0
          }
        );
        series = chart.get('chillmin'+deviceid);
        series.setData(datatablecm);
      }
    }
    if (datatablete.length!=0)
    {
      //Add Temperature series
      chart.addSeries(
        {
          id: 'temperature'+deviceid,
          name: devicename+':temperature',
          yAxis: 0
        }
      );
      series = chart.get('temperature'+deviceid);
      series.setData(datatablete);
      if (isday==0) {
        chart.addSeries(
          {
            id: 'temperaturemin'+deviceid,
            name: devicename+':temperature_min',
            yAxis: 0
          }
        );
        series = chart.get('temperaturemin'+deviceid);
        series.setData(datatabletm);
      }
    }
}    

function RemoveMultipleDataFromTempChart(chart,deviceid)
{
    hum=chart.get('humidity'+deviceid);
    if(hum!=null) {hum.remove()};
    chill=chart.get('chill'+deviceid)
    if(chill!=null) {chill.remove()};
    chillmin=chart.get('chillmin'+deviceid);
    if(chillmin!=null) {chillmin.remove()};
    temperature=chart.get('temperature'+deviceid);
    if(temperature!=null) {temperature.remove()};
    temperaturemin=chart.get('temperaturemin'+deviceid);
    if(temperaturemin!=null) {temperaturemin.remove()};
}

    
function SelectGraphDevices()
{
    clearInterval($.myglobals.refreshTimer);
    
    $.ajax({
           url: "json.htm?type=devices&filter=temp&used=true&order=Name",
           async: false,
           dataType: 'json',
           success: function(data) {
            if (typeof data.result != 'undefined') {
                $.each(data.result, function(i,item){
                    $("#devicecontainer").append('<input type="checkbox" class="devicecheckbox" id="'+item.idx+'" value="'+item.Name+'" onChange="AddDeviceToGraph(this)">'+item.Name+'<br />');
                    });
            }
           }
    });
}

function AddDeviceToGraph(cb)
{
    if (cb.checked==true) {
        $.ajax({
           url: "json.htm?type=graph&sensor=temp&idx="+cb.id+"&range="+$("#graphfrom").val()+"T"+$("#graphto").val(),
           async: false,
           dataType: 'json',
           success: function(data) {
            AddMultipleDataToTempChart(data,$.CustomChart,0,cb.id,cb.value);
           }
        });
    }
    else {
        RemoveMultipleDataFromTempChart($.CustomChart,cb.id);
    }
}
function datePickerChanged()
{
    $( "#tempcontent #graphfrom" ).datepicker('option', 'maxDate', $("#graphto").val());
    $( "#tempcontent #graphto" ).datepicker('option', 'minDate', $("#graphfrom").val());
    $('div[id="devicecontainer"] input:checkbox:checked').each(function() {
        RemoveMultipleDataFromTempChart($.CustomChart,$(this).attr('id'));
        $.ajax({
           url: "json.htm?type=graph&sensor=temp&idx="+$(this).attr('id')+"&range="+$("#graphfrom").val()+"T"+$("#graphto").val(),
           async: false,
           dataType: 'json',
           graphid: $(this).attr('id'),
           graphval: $(this).val(),
           success: function(data) {
            AddMultipleDataToTempChart(data,$.CustomChart,0,this.graphid,this.graphval);
           }
        });
    });   
}
    
function ShowCustomTempLog()
{
  clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  var htmlcontent = '';
  htmlcontent+=$('#customlog').html();
  $('#tempcontent').html(GetBackbuttonHTMLTable('ShowTemps')+htmlcontent);
    $('#tempcontent .datepick').each(function() {
        $(this).datepicker({
                           dateFormat: 'yy-mm-dd',
                           onClose:function(){ datePickerChanged() }});
        $(this).datepicker('setDate', new Date());
    });
    $("#tempcontent #graphfrom").datepicker('setDate', '-7');
    
  $.CustomChart = new Highcharts.Chart({
      chart: {
          renderTo: 'customgraph',
          type: 'line',
          zoomType: 'xy',
          alignTicks: false,
          
          events: {
              load: function() {
              }
          }
      },
      colors: ['#FF99CC','#FFCC99','#FFFF99','#CCFFCC','#CCFFFF','#99CCFF','#CC99FF','#FFFFFF',
               '#9999FF','#993366','#FFFFCC','#CCFFFF','#660066','#FF8080','#0066CC','#CCCCFF',
               '#000080','#FF00FF','#FFFF00','#00FFFF','#800080','#800000','#008080','#0000FF',
               '#00C0C0','#993300','#333300','#003300','#003366','#000080','#333399','#333333',
               '#800000','#FF6600','#808000','#008000','#008080','#0000FF','#666699','#808080',
               '#FF0000','#FF9900','#99CC00','#339966','#33CCCC','#3366FF','#800080','#969696',
               '#FF00FF','#FFCC00','#FFFF00','#00FF00','#00FFFF','#00CCFF','#993366','#C0C0C0'],
      loading: {
          hideDuration: 1000,
          showDuration: 1000
      },
      credits: {
        enabled: true,
        href: "http://www.domoticz.com",
        text: "Domoticz.com"
      },
      title: {
          text: 'Custom Temperature Graph'
      },
      xAxis: {
          type: 'datetime'
      },
      yAxis: [{ //temp label
          labels:  {
                   formatter: function() {
                        return this.value +'\u00B0 C';
                   },
                   style: {
                      color: 'white'
                   }
          },
          title: {
              text: 'degrees Celsius',
               style: {
                  color: 'white'
               }
          }
      }, { //humidity label
          labels:  {
                   formatter: function() {
                        return this.value +'%';
                   },
                   style: {
                      color: 'white'
                   }
          },
          title: {
              text: 'humidity %',
               style: {
                  color: 'white'
               }
          },
          opposite: true
      }],
      tooltip: {
          formatter: function() {
                var unit = '';
                var baseName = this.series.name.split(':')[1];
                if (baseName=="humidity") {unit = '%'} else {unit = '\u00B0 C'};
                return Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +'<br/>'+ this.series.name + ': ' + this.y + unit ;
          }
      },
      legend: {
          enabled: true
      },
      plotOptions: {
               line: {
                    lineWidth: 3,
                    states: {
                        hover: {
                            lineWidth: 3
                        }
                    },
                    marker: {
                        enabled: false,
                        states: {
                            hover: {
                                enabled: true,
                                symbol: 'circle',
                                radius: 5,
                                lineWidth: 1
                            }
                        }
                    }
                }
      }
  });
  SelectGraphDevices();
  $('#modal').hide();
  return false;
}
    
function ShowTempLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p><br>\n';
  htmlcontent+=$('#templog').html();
  $('#tempcontent').html(GetBackbuttonHTMLTable('ShowTemps')+htmlcontent);

  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'tempdaygraph',
          type: 'line',
          zoomType: 'xy',
          alignTicks: false,
          events: {
              load: function() {
                this.showLoading();
                $.getJSON("json.htm?type=graph&sensor=temp&idx="+id+"&range=day",
                function(data) {
                      AddDataToTempChart(data,$.DayChart,1);
                      $.DayChart.hideLoading();
                });
              }
          }
      },
      loading: {
          hideDuration: 1000,
          showDuration: 1000
      },
      credits: {
        enabled: true,
        href: "http://www.domoticz.com",
        text: "Domoticz.com"
      },
      title: {
          text: 'Temperature Last 24 hours'
      },
      xAxis: {
          type: 'datetime'
      },
      yAxis: [{ //temp label
          labels:  {
                   formatter: function() {
                        return this.value +'\u00B0 C';
                   },
                   style: {
                      color: '#CCCC00'
                   }
          },
          title: {
              text: 'degrees Celsius',
               style: {
                  color: '#CCCC00'
               }
          }
      }, { //humidity label
          labels:  {
                   formatter: function() {
                        return this.value +'%';
                   },
                   style: {
                      color: 'limegreen'
                   }
          },
          title: {
              text: 'humidity %',
               style: {
                  color: '#00CC00'
               }
          },
          opposite: true
      }],
      tooltip: {
          formatter: function() {
            var unit = {
                        'Humidity': '%',
                        'Temperature': '\u00B0 C',
                        'Temperature_min': '\u00B0 C',
                        'Chill': '\u00B0 C',
                        'Chill_min': '\u00B0 C'
                  }[this.series.name];
                  return Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +'<br/>'+ this.series.name + ': ' + this.y + unit;
          }
      },
      legend: {
          enabled: true
      },
      plotOptions: {
               line: {
                    lineWidth: 3,
                    states: {
                        hover: {
                            lineWidth: 3
                        }
                    },
                    marker: {
                        enabled: false,
                        states: {
                            hover: {
                                enabled: true,
                                symbol: 'circle',
                                radius: 5,
                                lineWidth: 1
                            }
                        }
                    }
                }
      }
  });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'tempmonthgraph',
          type: 'spline',
          zoomType: 'xy',
          alignTicks: false,
          events: {
              load: function() {
                this.showLoading();
                $.getJSON("json.htm?type=graph&sensor=temp&idx="+id+"&range=month",
                function(data) {
                      AddDataToTempChart(data,$.MonthChart,0);
                      $.MonthChart.hideLoading();
                });
              }
          }
      },
      loading: {
          hideDuration: 1000,
          showDuration: 1000
      },
      credits: {
        enabled: true,
        href: "http://www.domoticz.com",
        text: "Domoticz.com"
      },
      title: {
          text: 'Temperature Last Month'
      },
      xAxis: {
          type: 'datetime'
      },
      yAxis: [{ //temp label
          labels:  {
                   formatter: function() {
                        return this.value +'\u00B0 C';
                   },
                   style: {
                      color: '#CCCC00'
                   }
          },
          title: {
              text: 'degrees Celsius',
               style: {
                  color: '#CCCC00'
               }
          }
      }, { //humidity label
          labels:  {
                   formatter: function() {
                        return this.value +'%';
                   },
                   style: {
                      color: 'limegreen'
                   }
          },
          title: {
              text: 'humidity %',
               style: {
                  color: '#00CC00'
               }
          },
          opposite: true
      }],
      tooltip: {
          formatter: function() {
            var unit = {
                        'Humidity': '%',
                        'Temperature': '\u00B0 C',
                        'Temperature_min': '\u00B0 C',
                        'Chill': '\u00B0 C',
                        'Chill_min': '\u00B0 C'
                  }[this.series.name];
                  return Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +'<br/>'+ this.series.name + ': ' + this.y + unit;
          }
      },
      legend: {
          enabled: true
      },
      plotOptions: {
               spline: {
                    lineWidth: 3,
                    states: {
                        hover: {
                            lineWidth: 3
                        }
                    },
                    marker: {
                        enabled: false,
                        states: {
                            hover: {
                                enabled: true,
                                symbol: 'circle',
                                radius: 5,
                                lineWidth: 1
                            }
                        }
                    }
                }
      }
  });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'tempyeargraph',
          type: 'spline',
          zoomType: 'xy',
          alignTicks: false,
          events: {
              load: function() {
                this.showLoading();
                $.getJSON("json.htm?type=graph&sensor=temp&idx="+id+"&range=year",
                function(data) {
                      AddDataToTempChart(data,$.YearChart,0);
                      $.YearChart.hideLoading();
                });
              }
          }
      },
      loading: {
          hideDuration: 1000,
          showDuration: 1000
      },
      credits: {
        enabled: true,
        href: "http://www.domoticz.com",
        text: "Domoticz.com"
      },
      title: {
          text: 'Temperature Last Year'
      },
      xAxis: {
          type: 'datetime'
      },
      yAxis: [{ //temp label
          labels:  {
                   formatter: function() {
                        return this.value +'\u00B0 C';
                   },
                   style: {
                      color: '#CCCC00'
                   }
          },
          title: {
              text: 'degrees Celsius',
               style: {
                  color: '#CCCC00'
               }
          }
      }, { //humidity label
          labels:  {
                   formatter: function() {
                        return this.value +'%';
                   },
                   style: {
                      color: 'limegreen'
                   }
          },
          title: {
              text: 'humidity %',
               style: {
                  color: '#00CC00'
               }
          },
          opposite: true
      }],
      tooltip: {
          formatter: function() {
            var unit = {
                        'Humidity': '%',
                        'Temperature': '\u00B0 C',
                        'Temperature_min': '\u00B0 C',
                        'Chill': '\u00B0 C',
                        'Chill_min': '\u00B0 C'
                  }[this.series.name];
                  return Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +'<br/>'+ this.series.name + ': ' + this.y + unit;
          }
      },
      legend: {
          enabled: true
      },
      plotOptions: {
               spline: {
                    lineWidth: 3,
                    states: {
                        hover: {
                            lineWidth: 3
                        }
                    },
                    marker: {
                        enabled: false,
                        states: {
                            hover: {
                                enabled: true,
                                symbol: 'circle',
                                radius: 5,
                                lineWidth: 1
                            }
                        }
                    }
                }
      }
  });

  $('#modal').hide();
  return false;
}

function RefreshTemps()
{
  clearInterval($.myglobals.refreshTimer);
  var id="";

  $.ajax({
     url: "json.htm?type=devices&filter=temp&used=true&order=Name",
     async: false,
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {
        $.each(data.result, function(i,item){
					id="#tempcontent #" + item.idx;
					var obj=$(id);
					if (typeof obj != 'undefined') {
						if ($(id + " #name").html()!=item.Name) {
							$(id + " #name").html(item.Name);
						}
						var img='<img src="images/';
            if ((typeof item.Temp == 'undefined') || (item.Temp>0)) {
              img+='temp48.png';
            }
            else {
              img+='ice.png';
            }
            img+='" height="48">';
            
            if ($(id + " #img").html()!=img) {
							$(id + " #img").html(img);
						}
            
            var status="";
            var bHaveTemperature=false;
            var bHaveBefore=false;
            if (typeof item.Temp != 'undefined') {
                 status+=item.Temp + '\u00B0 C';
                 bHaveTemperature=true;
                 bHaveBefore=true;
            }
            if (typeof item.Chill != 'undefined') {
              status+=', Chill: ' + item.Chill + '\u00B0 C';
              bHaveBefore=true;
            }
            var bHaveHumidity=false;
            if (typeof item.Humidity != 'undefined') {
							if (bHaveBefore==true) {
								status+=', ';
							}
              status+='Humidity: ' + item.Humidity + ' %';
              bHaveHumidity=true;
            }
            if (typeof item.HumidityStatus != 'undefined') {
              status+=' (' + item.HumidityStatus + ')';
            }
            if (typeof item.Barometer != 'undefined') {
              status+='<br>Barometer: ' + item.Barometer + ' hPa';
            }
            if (typeof item.ForecastStr != 'undefined') {
              status+=', Prediction: ' + item.ForecastStr;
            }
						if (typeof item.Direction != 'undefined') {
              status+='<br>' + item.Direction + ' ' + item.DirectionStr + ', Speed: ' + item.Speedms + ' ms, Gust: ' + item.Gustms + ' ms\n';
            }
            if ($(id + " #status").html()!=status) {
							$(id + " #status").html(status);
						}
						if ($(id + " #lastupdate").html()!=item.LastUpdate) {
							$(id + " #lastupdate").html(item.LastUpdate);
						}
           }
        });
      }
     }
  });
  
	$.myglobals.refreshTimer = setInterval(RefreshTemps, 10000);
}

function ShowTemps()
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();

  var htmlcontent = '';
  var bHaveAddedDevider = false;

  var tophtm=
        '\t<table class="bannav" id="bannav" border="0" cellpadding="0" cellspacing="0" width="100%">\n' +
        '\t<tr>\n' +
        '\t  <td align="right">\n' +
        '\t    <a class="btnstyle" onclick="ShowCustomTempLog();">Custom Graph</a>\n' +
        '\t    <a class="btnstyle" onclick="AddTempDevice();">Add Sensor</a>\n' +
        '\t  </td>\n' +
        '\t</tr>\n' +
        '\t</table>\n';


  var i=0;

  $.ajax({
     url: "json.htm?type=devices&filter=temp&used=true&order=Name",
     async: false,
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {
        $.each(data.result, function(i,item){
          if (i % 3 == 0)
          {
            //add devider
            if (bHaveAddedDevider == true) {
              //close previous devider
              htmlcontent+='</div>\n';
            }
            htmlcontent+='<div class="row divider">\n';
            bHaveAddedDevider=true;
          }
          var xhtm=
                '\t<div class="4u" id="' + item.idx + '">\n' +
                '\t  <section>\n' +
                '\t    <table id="itemtable" border="0" cellpadding="0" cellspacing="0">\n' +
                '\t    <tr>\n' +
                '\t      <td id="name">' + item.Name + '</td>\n' +
                '\t      <td id="img"><img src="images/';
            if ((typeof item.Temp == 'undefined') || (item.Temp>0)) {
              xhtm+='temp48.png';
            }
            else {
              xhtm+='ice.png';
            }
            xhtm+='" height="48"></td>\n' +
                '\t      <td id="status">';
            var bHaveTemperature=false;
            var bHaveBefore=false;
            if (typeof item.Temp != 'undefined') {
                 xhtm+=item.Temp + '\u00B0 C';
                 bHaveTemperature=true;
                 bHaveBefore=true;
            }
            if (typeof item.Chill != 'undefined') {
              xhtm+=', Chill: ' + item.Chill + '\u00B0 C';
              bHaveBefore=true;
            }
            var bHaveHumidity=false;
            if (typeof item.Humidity != 'undefined') {
							if (bHaveBefore==true) {
								xhtm+=', ';
							}
              xhtm+='Humidity: ' + item.Humidity + ' %';
              bHaveHumidity=true;
            }
            if (typeof item.HumidityStatus != 'undefined') {
              xhtm+=' (' + item.HumidityStatus + ')';
            }
            if (typeof item.Barometer != 'undefined') {
              xhtm+='<br>Barometer: ' + item.Barometer + ' hPa';
            }
            if (typeof item.ForecastStr != 'undefined') {
              xhtm+=', Prediction: ' + item.ForecastStr;
            }
						if (typeof item.Direction != 'undefined') {
              xhtm+='<br>' + item.Direction + ' ' + item.DirectionStr + ', Speed: ' + item.Speedms + ' ms, Gust: ' + item.Gustms + ' ms\n';
            }
            xhtm+=
                '</td>\n' +
                '\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n' +
                '\t      <td id="type">' + item.Type + ', ' + item.SubType + '</td>\n' +
                '\t      <td>';
          if (item.Favorite == 0) {
            xhtm+=
                  '<img src="images/nofavorite.png" title="Add to Dashboard" onclick="MakeFavorite(' + item.idx + ',1);" onmouseover="cursorhand()" onmouseout="cursordefault()">&nbsp;&nbsp;&nbsp;&nbsp;';
          }
          else {
            xhtm+=
                  '<img src="images/favorite.png" title="Remove from Dashboard" onclick="MakeFavorite(' + item.idx + ',0);" onmouseover="cursorhand()" onmouseout="cursordefault()">&nbsp;&nbsp;&nbsp;&nbsp;';
          }
          xhtm+=
                '<a class="btnsmall" onclick="ShowTempLog(' + item.idx + ',\'' + item.Name + '\');">Log</a> ' +
                '<a class="btnsmall" onclick="EditTempDevice(' + item.idx + ',\'' + item.Name + '\');">Edit</a> ';
          if (item.Notifications == "true")
            xhtm+='<a class="btnsmall-sel" onclick="ShowNotifications(' + item.idx + ',\'' + item.Name + '\', \'#tempcontent\', \'ShowTemps\');">Notifications</a>';
          else
            xhtm+='<a class="btnsmall" onclick="ShowNotifications(' + item.idx + ',\'' + item.Name + '\', \'#tempcontent\', \'ShowTemps\');">Notifications</a>';

					xhtm+=
                '</td>\n' +
                '\t    </tr>\n' +
                '\t    </table>\n' +
                '\t  </section>\n' +
                '\t</div>\n';
          htmlcontent+=xhtm;
        });
      }
     }
  });
  if (bHaveAddedDevider == true) {
    //close previous devider
    htmlcontent+='</div>\n';
  }
  if (htmlcontent == '')
  {
    htmlcontent='<h2>No Temperature sensors found or added in the system...</h2>';
  }
  $('#modal').hide();
  $('#tempcontent').html(tophtm+htmlcontent);

	if ($.myglobals.ismobile==false) {
		$("#tempcontent .4u").draggable({
				drag: function() {
					clearInterval($.myglobals.refreshTimer);
					$.devIdx=$(this).attr("id");
					$(this).css("z-index", 2);
				},
				revert: true
		});
		$("#tempcontent .4u").droppable({
				drop: function() {
					var myid=$(this).attr("id");
					$.devIdx.split(' ');
					$.ajax({
						 url: "json.htm?type=command&param=switchdeviceorder&idx1=" + myid + "&idx2=" + $.devIdx,
						 async: false, 
						 dataType: 'json',
						 success: function(data) {
								ShowTemps();
						 }
					});
				}
		});
	}
	$.myglobals.refreshTimer = setInterval(RefreshTemps, 10000);
  return false;
}

$(document).ready(function() {
    //global var
    $.devIdx=0;

    $( "#dialog-addtempdevice" ).dialog({
          autoOpen: false,
          width: 350,
          height: 150,
          modal: true,
          resizable: false,
          buttons: {
              "Add Device": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-addtempdevice #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-addtempdevice #devicename").val() + '&used=true',
                         async: false,
                         dataType: 'json',
                         success: function(data) {
                            ShowTemps();
                         }
                      });

                  }
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });
    $( "#dialog-edittempdevice" ).dialog({
          autoOpen: false,
          width: 450,
          height: 150,
          modal: true,
          resizable: false,
          buttons: {
              "Update": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-edittempdevice #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-edittempdevice #devicename").val() + '&used=true',
                         async: false,
                         dataType: 'json',
                         success: function(data) {
                            ShowTemps();
                         }
                      });

                  }
              },
              "Remove Device": function() {
                  var bValid = false;
                  bValid=(confirm("Are you sure to remove this Device?")==true);
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-edittempdevice #devicename").val() + '&used=false',
                         async: false,
                         dataType: 'json',
                         success: function(data) {
                            ShowTemps();
                         }
                      });

                  }
              },
              "Transfer": function() {
                  $( this ).dialog( "close" );
                  TransferDevice($.devIdx,ShowTemps);
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    });

  ShowTemps();

} );
</script>
