<div id="dialog-editweatherdevice">
    <form>
        <label for="name">Name: </label>
        <input type="text" id="devicename" style="width: 250px; padding: .4em;" class="text ui-widget-content ui-corner-all" />
    </form>
</div>
<div id="dialog-editvisibilitydevice">
    <form>
        <table class="display" id="edittable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:60px"><label>Name: </label></td>
          <td><input type="text" id="devicename" style="width: 250px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
        <tr>
        <tr>
          <td align="right" style="width:60px"><label>Display: </label></td>
          <td>
			<select id="combometertype" style="width:150px" class="combobox ui-corner-all">
				<option value="0">Kilometers</option>
				<option value="1">Miles</option>
			</select>
		  </td>
        <tr>
		</table>
    </form>
</div>
<div id="dialog-editraindevice">
    <form>
        <table class="display" id="edittable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:60px"><label for="devicename">Name: </label></td>
          <td><input type="text" id="devicename" style="width: 250px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
        <tr>
        <tr>
          <td align="right" style="width:60px"><label for="multiply">Multiply: </label></td>
          <td><input type="text" id="multiply" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
        <tr>
		</table>
    </form>
</div>
<div id="dialog-editbarodevice">
    <form>
        <table class="display" id="edittable" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td align="right" style="width:60px"><label for="devicename">Name: </label></td>
          <td><input type="text" id="devicename" style="width: 250px; padding: .2em;" class="text ui-widget-content ui-corner-all" /></td>
        <tr>
        <tr>
          <td align="right" style="width:60px"><label for="adjustment">Adjustment: </label></td>
          <td><input type="text" id="adjustment" style="width: 60px; padding: .2em;" class="text ui-widget-content ui-corner-all" /> hPa</td>
        <tr>
				</table>
    </form>
</div>
<div id="weathercontent">
</div>
<div id="weatherlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="weatherdaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <br>
  <h2 data-i18n="Year">Year</h2>
 </div>
 <div id="windlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="winddaygraph" style="height: 300px;"></div>
  <br>
  <div id="winddirgraph" style="width: 400px; height: 400px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="windmonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="windyeargraph" style="height: 300px;"></div>
</div>
<div id="uvlog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="uvdaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="uvmonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="uvyeargraph" style="height: 300px;"></div>
</div>
<div id="barolog" style="display:none;">
  <h2 data-i18n="Day">Day</h2>
  <div id="barodaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="baromonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="baroyeargraph" style="height: 300px;"></div>
</div>
<div id="rainlog" style="display:none;">
  <h2 data-i18n="Week">Week</h2>
  <div id="raindaygraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Month">Month</h2>
  <div id="rainmonthgraph" style="height: 300px;"></div>
  <br>
  <h2 data-i18n="Year">Year</h2>
  <div id="rainyeargraph" style="height: 300px;"></div>
</div>

<script type="text/javascript" charset="utf-8">

function MakeFavorite(id,isfavorite)
{
	if (window.my_config.userrights!=2) {
        HideNotify();
		ShowNotify($.i18n('You do not have permission to do that!'), 2500, true);
		return;
	}

	clearInterval($.myglobals.refreshTimer);
  $.ajax({
     url: "json.htm?type=command&param=makefavorite&idx=" + id + "&isfavorite=" + isfavorite, 
     async: false, 
     dataType: 'json',
     success: function(data) {
      ShowWeathers();
     }
  });
}

function EditRainDevice(idx,name,addjmulti)
{
	clearInterval($.myglobals.refreshTimer);
  $.devIdx=idx;
  $("#dialog-editraindevice #devicename").val(name);
  $("#dialog-editraindevice #multiply").val(addjmulti);
  $("#dialog-editraindevice" ).dialog( "open" );
}

function EditBaroDevice(idx,name,addjvalue)
{
	clearInterval($.myglobals.refreshTimer);
  $.devIdx=idx;
  $("#dialog-editbarodevice #devicename").val(name);
  $("#dialog-editbarodevice #adjustment").val(addjvalue);
  $("#dialog-editbarodevice" ).dialog( "open" );
}

function EditVisibilityDevice(idx,name,switchtype)
{
  clearInterval($.myglobals.refreshTimer);
  $.devIdx=idx;
  $("#dialog-editvisibilitydevice #devicename").val(name);
  $("#dialog-editvisibilitydevice #combometertype").val(switchtype);
  $("#dialog-editvisibilitydevice" ).dialog( "open" );
}

function EditWeatherDevice(idx,name)
{
	clearInterval($.myglobals.refreshTimer);
  $.devIdx=idx;
  $("#dialog-editweatherdevice #devicename").val(name);
  $( "#dialog-editweatherdevice" ).dialog( "open" );
}

function AddWeatherDevice()
{
  alert($.i18n('Please use the devices tab for this.'));
}

function ShowWindLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  var htmlcontent = '';
        
  htmlcontent='<p><center><h2>' + name + '</h2></center></p><br>\n';
  htmlcontent+=$('#windlog').html();
  $('#weathercontent').html(GetBackbuttonHTMLTable('ShowWeathers')+htmlcontent);
  $('#weathercontent').i18n();
  
  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'winddaygraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                $.getJSON("json.htm?type=graph&sensor=wind&idx="+id+"&range=day",
                function(data) {
                      var seriessp = $.DayChart.series[0];
                      var seriesgu = $.DayChart.series[1];
                      var datatablesp = [];
                      var datatablegu = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatablesp.push( [GetUTCFromString(item.d), parseFloat(item.sp) ] );
                        datatablegu.push( [GetUTCFromString(item.d), parseFloat(item.gu) ] );
                      });
                      seriessp.setData(datatablesp);
                      seriesgu.setData(datatablegu);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Wind') + ' ' + $.i18n('speed/gust') + ' '  + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Speed') + ' (' + $.myglobals.windsign + ')'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null,
            plotBands: [{ // Light air
                from: 0.3*$.myglobals.windscale,
                to: 1.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Light air'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Light breeze
                from: 1.5*$.myglobals.windscale,
                to: 3.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Light breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Gentle breeze
                from: 3.5*$.myglobals.windscale,
                to: 5.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Gentle breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Moderate breeze
                from: 5.5*$.myglobals.windscale,
                to: 8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Moderate breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Fresh breeze
                from: 8*$.myglobals.windscale,
                to: 10.8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fresh breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Strong breeze
                from: 10.8*$.myglobals.windscale,
                to: 13.9*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Strong breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // High wind
                from: 13.9*$.myglobals.windscale,
                to: 17.2*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('High wind'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // fresh gale
                from: 17.2*$.myglobals.windscale,
                to: 20.8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fresh gale'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // strong gale
                from: 20.8*$.myglobals.windscale,
                to: 24.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Strong gale'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // storm
                from: 24.5*$.myglobals.windscale,
                to: 28.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Storm'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Violent storm
                from: 28.5*$.myglobals.windscale,
                to: 32.7*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Violent storm'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // hurricane
                from: 32.7*$.myglobals.windscale,
                to: 100*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Hurricane'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }
            ]
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' ' + $.myglobals.windsign;
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: $.i18n('Speed')
        }, {
            name: $.i18n('Gust')
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.DirChart = new Highcharts.Chart({
      chart: {
          renderTo: 'winddirgraph',
          polar: true,
          events: {
              load: function() {
                $.getJSON("json.htm?type=graph&sensor=winddir&idx="+id+"&range=day",
                function(data) {
                      var series = $.DirChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [item.dig, parseFloat(item.div) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
        title: {
            text: $.i18n('Wind') + ' ' + $.i18n('Direction') + ' '  + Get5MinuteHistoryDaysGraphTitle()
        },
        pane: {
            startAngle: 0,
            endAngle: 360
        },
        credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        xAxis: {
            min: 0,
            max: 360,
            tickWidth: 1,
            tickPosition: 'outside',
            tickLength: 20,
            tickColor: '#999',
            tickInterval:45,
            labels: {
                formatter:function(){
                    if(this.value == 0) { return 'N'; }
                    else if(this.value == 45) { return 'NE'; }
                    else if(this.value == 90) { return 'E'; }
                    else if(this.value == 135) { return 'SE'; }
                    else if(this.value == 180) { return 'S'; }
                    else if(this.value == 225) { return 'SW'; }
                    else if(this.value == 270) { return 'W'; }
                    else if(this.value == 315) { return 'NW'; }
                }
            }
        },
        yAxis: {
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    this.x +'\u00B0: '+ this.y +' %';
            }
        },
        plotOptions: {
            area: {
                lineWidth: 2,
                states: {
                    hover: {
                        lineWidth: 2
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            type: 'area',
            color: 'rgba(68, 170, 213, 0.2)',
            name: $.i18n('Direction')
        }]
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'windmonthgraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=wind&idx="+id+"&range=month",
                function(data) {
                      var seriessp = $.MonthChart.series[0];
                      var seriesgu = $.MonthChart.series[1];
                      var datatablesp = [];
                      var datatablegu = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatablesp.push( [GetDateFromString(item.d), parseFloat(item.sp) ] );
                        datatablegu.push( [GetDateFromString(item.d), parseFloat(item.gu) ] );
                      });
                      seriessp.setData(datatablesp);
                      seriesgu.setData(datatablegu);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Wind') + ' ' + $.i18n('speed/gust') + ' ' + $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Speed') + ' (' + $.myglobals.windsign + ')'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null,
            plotBands: [{ // Light air
                from: 0.3*$.myglobals.windscale,
                to: 1.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Light air'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Light breeze
                from: 1.5*$.myglobals.windscale,
                to: 3.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Light breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Gentle breeze
                from: 3.5*$.myglobals.windscale,
                to: 5.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Gentle breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Moderate breeze
                from: 5.5*$.myglobals.windscale,
                to: 8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Moderate breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Fresh breeze
                from: 8*$.myglobals.windscale,
                to: 10.8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fresh breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Strong breeze
                from: 10.8*$.myglobals.windscale,
                to: 13.9*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Strong breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // High wind
                from: 13.9*$.myglobals.windscale,
                to: 17.2*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('High wind'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // fresh gale
                from: 17.2*$.myglobals.windscale,
                to: 20.8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fresh gale'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // strong gale
                from: 20.8*$.myglobals.windscale,
                to: 24.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Strong gale'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // storm
                from: 24.5*$.myglobals.windscale,
                to: 28.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Storm'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Violent storm
                from: 28.5*$.myglobals.windscale,
                to: 32.7*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Violent storm'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // hurricane
                from: 32.7*$.myglobals.windscale,
                to: 100*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Hurricane'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }
           ]
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' ' + $.myglobals.windsign;
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: $.i18n('Speed'),
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowWindLog);
					}
				}
			}
        }, {
            name: $.i18n('Gust'),
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowWindLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'windyeargraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=wind&idx="+id+"&range=year",
                function(data) {
                      var seriessp = $.YearChart.series[0];
                      var seriesgu = $.YearChart.series[1];
                      var datatablesp = [];
                      var datatablegu = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatablesp.push( [GetDateFromString(item.d), parseFloat(item.sp) ] );
                        datatablegu.push( [GetDateFromString(item.d), parseFloat(item.gu) ] );
                      });
                      seriessp.setData(datatablesp);
                      seriesgu.setData(datatablegu);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Wind') + ' ' + $.i18n('speed/gust') + ' ' + $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Speed') + ' (' + $.myglobals.windsign + ')'
            },
            min: 0,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null,
            plotBands: [{ // Light air
                from: 0.3*$.myglobals.windscale,
                to: 1.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Light air'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Light breeze
                from: 1.5*$.myglobals.windscale,
                to: 3.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Light breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Gentle breeze
                from: 3.5*$.myglobals.windscale,
                to: 5.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Gentle breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Moderate breeze
                from: 5.5*$.myglobals.windscale,
                to: 8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Moderate breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Fresh breeze
                from: 8*$.myglobals.windscale,
                to: 10.8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fresh breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Strong breeze
                from: 10.8*$.myglobals.windscale,
                to: 13.9*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Strong breeze'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // High wind
                from: 13.9*$.myglobals.windscale,
                to: 17.2*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('High wind'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // fresh gale
                from: 17.2*$.myglobals.windscale,
                to: 20.8*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Fresh gale'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // strong gale
                from: 20.8*$.myglobals.windscale,
                to: 24.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Strong gale'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // storm
                from: 24.5*$.myglobals.windscale,
                to: 28.5*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Storm'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // Violent storm
                from: 28.5*$.myglobals.windscale,
                to: 32.7*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.5)',
                label: {
                    text: $.i18n('Violent storm'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }, { // hurricane
                from: 32.7*$.myglobals.windscale,
                to: 100*$.myglobals.windscale,
                color: 'rgba(68, 170, 213, 0.3)',
                label: {
                    text: $.i18n('Hurricane'),
                    style: {
                        color: '#CCCCCC'
                    }
                }
            }
           ]
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' ' + $.myglobals.windsign;
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: $.i18n('Speed'),
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowWindLog);
					}
				}
			}
        }, {
            name: $.i18n('Gust'),
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowWindLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
}

function ShowUVLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p><br>\n';
  htmlcontent+=$('#uvlog').html();
  $('#weathercontent').html(GetBackbuttonHTMLTable('ShowWeathers')+htmlcontent);
  $('#weathercontent').i18n();
  
  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'uvdaygraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=uv&idx="+id+"&range=day",
                function(data) {
                      var series = $.DayChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetUTCFromString(item.d), parseFloat(item.uvi) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: 'UV '  + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'UV (UVI)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' UVI';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'uv'
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'uvmonthgraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=uv&idx="+id+"&range=month",
                function(data) {
                      var series = $.MonthChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetDateFromString(item.d), parseFloat(item.uvi) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: 'UV ' + $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'UV (UVI)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' UVI';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'uv',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowUVLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'uvyeargraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=uv&idx="+id+"&range=year",
                function(data) {
                      var series = $.YearChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetDateFromString(item.d), parseFloat(item.uvi) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: 'UV ' + $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'UV (UVI)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' UVI';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'uv',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowUVLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
}

function ShowBaroLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p><br>\n';
  htmlcontent+=$('#barolog').html();
  $('#weathercontent').html(GetBackbuttonHTMLTable('ShowWeathers')+htmlcontent);
  $('#weathercontent').i18n();
  
  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'barodaygraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=temp&idx="+id+"&range=day",
                function(data) {
                      var series = $.DayChart.series[0];
                      var datatable = [];
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetUTCFromString(item.d), parseFloat(item.ba) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Barometer') + ' '  + Get5MinuteHistoryDaysGraphTitle()
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Pressure') + ' (hPa)'
            },
            labels: {
							formatter: function(){
									return this.value;       
							}
						}
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' hPa';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'hPa'
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'baromonthgraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=temp&idx="+id+"&range=month",
                function(data) {
                      var series = $.MonthChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetDateFromString(item.d), parseFloat(item.ba) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Barometer') + ' ' + $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Pressure') + ' (hPa)'
            },
            labels: {
							formatter: function(){
									return this.value;       
							}
						}
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' hPa';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'hPa',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowBaroLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'baroyeargraph',
          type: 'spline',
          zoomType: 'xy',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=temp&idx="+id+"&range=year",
                function(data) {
                      var series = $.YearChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetDateFromString(item.d), parseFloat(item.ba) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Barometer') + ' ' + $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Pressure') + ' (hPa)'
            },
            labels: {
							formatter: function(){
									return this.value;       
							}
						}
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +': '+ this.y +' hPa';
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'hPa',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowBaroLog);
					}
				}
			}
        }]
        ,
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
}

function ShowRainLog(id,name)
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  $.devIdx=id;
  $.devName=name;
  var htmlcontent = '';
  htmlcontent='<p><center><h2>' + name + '</h2></center></p>\n';
  htmlcontent+=$('#rainlog').html();
  $('#weathercontent').html(GetBackbuttonHTMLTable('ShowWeathers')+htmlcontent);
  $('#weathercontent').i18n();
  
  $.DayChart = new Highcharts.Chart({
      chart: {
          renderTo: 'raindaygraph',
          type: 'column',
          marginRight: 10,
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=rain&idx="+id+"&range=day",
                function(data) {
                      var series = $.DayChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetDateFromString(item.d), parseFloat(item.mm) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Rainfall') + ' ' + $.i18n('Last Week')
        },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: {
                day: '%a'
            },
            tickInterval: 24 * 3600 * 1000
        },
        yAxis: {
            title: {
                text: $.i18n('Rainfall') + ' (mm)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d', this.x) +': '+ this.y +' mm';
            }
        },
        plotOptions: {
            column: {
                stacking: 'normal',
                minPointLength: 4,
                pointPadding: 0.1,
                groupPadding: 0
            }
        },
        series: [{
            name: 'mm',
            color: 'rgba(3,190,252,0.8)',
            dataLabels: {
                    verticalAlign: 'top',
                    enabled: true,
                    color: '#FFFFFF',
                    y: -23,
                    formatter: function() {
                        return this.y;
                    },
                    style: {
                        fontSize: '13px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                }
        }]
        ,
        legend: {
            enabled: false
        }
    });

  $.MonthChart = new Highcharts.Chart({
      chart: {
          renderTo: 'rainmonthgraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                $.getJSON("json.htm?type=graph&sensor=rain&idx="+id+"&range=month",
                function(data) {
                      var series = $.MonthChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetDateFromString(item.d), parseFloat(item.mm) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Rainfall') + ' ' + $.i18n('Last Month')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Rainfall') + ' (mm)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d', this.x) +': '+ this.y +' mm';
            }
        },
        plotOptions: {
           spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'mm',
            color: 'rgba(3,190,252,0.8)',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowRainLog);
					}
				}
			}
        }]
        ,
        legend: {
            enabled: false
        }
    });

  $.YearChart = new Highcharts.Chart({
      chart: {
          renderTo: 'rainyeargraph',
          type: 'spline',
          marginRight: 10,
          zoomType: 'xy',
          events: {
              load: function() {
                  
                $.getJSON("json.htm?type=graph&sensor=rain&idx="+id+"&range=year",
                function(data) {
                      var series = $.YearChart.series[0];
                      var datatable = [];
                      
                      $.each(data.result, function(i,item)
                      {
                        datatable.push( [GetDateFromString(item.d), parseFloat(item.mm) ] );
                      });
                      series.setData(datatable);
                });
              }
          }
        },
       credits: {
          enabled: true,
          href: "http://www.domoticz.com",
          text: "Domoticz.com"
        },
        title: {
            text: $.i18n('Rainfall') + ' ' + $.i18n('Last Year')
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: $.i18n('Rainfall') + ' (mm)'
            },
            min: 0
        },
        tooltip: {
            formatter: function() {
                    return ''+
                    $.i18n(Highcharts.dateFormat('%A',this.x)) + '<br/>' + Highcharts.dateFormat('%Y-%m-%d', this.x) +': '+ this.y +' mm';
            }
        },
        plotOptions: {
           spline: {
                lineWidth: 3,
                states: {
                    hover: {
                        lineWidth: 3
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        series: [{
            name: 'mm',
            color: 'rgba(3,190,252,0.8)',
			point: {
				events: {
					click: function(event) {
						chartPointClick(event,ShowRainLog);
					}
				}
			}
        }]
        ,
        legend: {
            enabled: false
        }
    });
}

function RefreshWeathers()
{
	clearInterval($.myglobals.refreshTimer);
  var id="";

  $.ajax({
     url: "json.htm?type=devices&filter=weather&used=true&order=Name", 
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {
        $.each(data.result, function(i,item){

					id="#weathercontent #" + item.idx;
					var obj=$(id);
					if (typeof obj != 'undefined') {
						if ($(id + " #name").html()!=item.Name) {
							$(id + " #name").html(item.Name);
						}

						var status="";
						var img="";
						var bigtext="";
						if (typeof item.Barometer != 'undefined') {
							img='<img src="images/baro48.png" height="48">';
							bigtext=item.Barometer + ' hPa';
							if (typeof item.ForecastStr != 'undefined') {
								status=item.Barometer + ' hPa, ' + $.i18n('Prediction') + ': ' + $.i18n(item.ForecastStr);
							}
							else
							{
								status=item.Barometer + ' hPa';
							}
							if (typeof item.Altitude != 'undefined') {
								status+=', Altitude: ' + item.Altitude + ' meter';
							}
						}
						if (typeof item.Rain != 'undefined') {
							img='<img src="images/rain48.png" height="48">';
							status=item.Rain + ' mm';
							bigtext=item.Rain + ' mm';
							if (typeof item.RainRate != 'undefined') {
								if (item.RainRate!=0) {
									status+=', Rate: ' + item.RainRate + ' mm/h';
								}
							}
						}
						if (typeof item.Visibility != 'undefined') {
							img='<img src="images/visibility48.png" height="48">';
							status=item.Data;
							bigtext=item.Data;
						}
						else if (typeof item.UVI != 'undefined') {
							img='<img src="images/uv48.png" height="48">';
							status=item.UVI + ' UVI';
							bigtext=item.UVI + ' UVI';
							if (typeof item.Temp!= 'undefined') {
								status+=', ' + $.i18n('Temp') + ': ' + item.Temp + '\u00B0 C';
							}
						}
						if (typeof item.Radiation != 'undefined') {
							img='<img src="images/radiation48.png" height="48">';
							status=item.Data;
							bigtext=item.Data;
						}
						else if (typeof item.Direction != 'undefined') {
							img='<img src="images/Wind' + item.DirectionStr + '.png" height="48">';
							status=item.Direction + ' ' + item.DirectionStr;
							if (typeof item.Speed != 'undefined') {
								status+=', ' + $.i18n('Speed') +': ' + item.Speed + ' ' + $.myglobals.windsign;
							}
							if (typeof item.Gust != 'undefined') {
								status+=', ' + $.i18n('Gust') + ': ' + item.Gust + ' ' + $.myglobals.windsign;
							}
							status+='<br>\n';
							bigtext=item.DirectionStr;
							if (typeof item.Speed != 'undefined') {
								bigtext+=  ' / ' + item.Speed + ' ' + $.myglobals.windsign;
							}
							else if (typeof item.Gust != 'undefined') {
								bigtext+=  ' / ' + item.Gust + ' ' + $.myglobals.windsign;
							}
							if ((typeof item.Temp != 'undefined')&&(typeof item.Chill != 'undefined')) {
								status+=$.i18n('Temp') + ': ' + item.Temp + '\u00B0 C, ';
								status+=$.i18n('Chill') +': ' + item.Chill + '\u00B0 C';
							}
							else {
								if (typeof item.Chill != 'undefined') {
									status+=$.i18n('Chill') + ': ' + item.Chill + '\u00B0 C';
								}
							}
						}
						
            var nbackcolor="#D4E1EE";
						if (item.HaveTimeout==true) {
							nbackcolor="#DF2D3A";
						}
            var obackcolor=rgb2hex($(id + " #name").css( "background-color" )).toUpperCase();
            if (obackcolor!=nbackcolor) {
							$(id + " #name").css( "background-color", nbackcolor );
            }
						
						if ($(id + " #img").html()!=img) {
							$(id + " #img").html(img);
						}
						if ($(id + " #status").html()!=status) {
							$(id + " #status").html(status);
						}
						if ($(id + " #bigtext").html()!=bigtext) {
							$(id + " #bigtext").html(bigtext);
						}
						if ($(id + " #lastupdate").html()!=item.LastUpdate) {
							$(id + " #lastupdate").html(item.LastUpdate);
						}
					}
        });
      }
     }
  });
	RefreshTimeAndSun();
  $.myglobals.refreshTimer = setInterval(RefreshWeathers, 10000);
}

function ShowWeathers()
{
	clearInterval($.myglobals.refreshTimer);
  $('#modal').show();
  
  var htmlcontent = '';
  var bHaveAddedDevider = false;

  var tophtm=
        '\t<table class="bannav" id="bannav" border="0" cellpadding="0" cellspacing="0" width="100%">\n' +
        '\t<tr>\n' +
		'\t  <td align="left"><div id="timesun" /></td>\n';
  if (window.my_config.userrights==2) {
	tophtm+=
        '\t  <td style="width: 150px;" align="right">\n' +
        '\t    <a class="btnstyle" onclick="AddWeatherDevice();" data-i18n="Add Sensor">Add Sensor</a>\n' +
        '\t  </td>\n';
  }
  tophtm+=
        '\t</tr>\n' +
        '\t</table>\n';
  

  var i=0;
  $.ajax({
     url: "json.htm?type=devices&filter=weather&used=true&order=Name", 
     async: false, 
     dataType: 'json',
     success: function(data) {
      if (typeof data.result != 'undefined') {

		if (typeof data.WindScale != 'undefined') {
			$.myglobals.windscale=parseFloat(data.WindScale);
		}
		if (typeof data.WindSign != 'undefined') {
			$.myglobals.windsign=data.WindSign;
		}

				$.FiveMinuteHistoryDays=data["5MinuteHistoryDays"];

        $.each(data.result, function(i,item){
          if (i % 3 == 0)
          {
            //add devider
            if (bHaveAddedDevider == true) {
              //close previous devider
              htmlcontent+='</div>\n';
            }
            htmlcontent+='<div class="row divider">\n';
            bHaveAddedDevider=true;
          }
          var bHaveVisibility = false;
          var bHaveRain = false;
          var bHaveBaro = false;
          var bHaveUV = false;
          var bHaveRadiation = false;
          var bHaveWind = false;
          
          var xhtm=
                '\t<div class="span4" id="' + item.idx + '">\n' +
                '\t  <section>\n' +
                '\t    <table id="itemtablenotype" border="0" cellpadding="0" cellspacing="0">\n' +
                '\t    <tr>\n';
					if (item.HaveTimeout==false) {
						xhtm+='\t      <td id="name">' + item.Name + '</td>\n';
					}
					else {
						xhtm+='\t      <td id="name" style="background-color: #DF2D3A;">' + item.Name + '</td>\n';
					}
					xhtm+='\t      <td id="bigtext">';
					if (typeof item.Barometer != 'undefined') {
						xhtm+=item.Barometer + ' hPa';
					}
					else if (typeof item.Rain != 'undefined') {
						xhtm+=item.Rain + ' mm';
					}
					else if (typeof item.Visibility != 'undefined') {
						xhtm+=item.Data;
					}
					else if (typeof item.UVI != 'undefined') {
						xhtm+=item.UVI + ' UVI';
					}
					else if (typeof item.Radiation != 'undefined') {
						xhtm+=item.Data;
					}
					else if (typeof item.Direction != 'undefined') {
						xhtm+=item.DirectionStr;
					}
					if (typeof item.Speed != 'undefined') {
						xhtm+=' / ' + item.Speed + ' ' + $.myglobals.windsign;
					}
					else if (typeof item.Gust != 'undefined') {
						xhtm+=' / ' + item.Gust + ' ' + $.myglobals.windsign;
					}
					xhtm+='</td>\n';
					xhtm+='\t      <td id="img"><img src="images/';
					if (typeof item.Barometer != 'undefined') {
						bHaveBaro=true;
						xhtm+='baro48.png" height="48"></td>\n' +
							  '\t      <td id="status">' + item.Barometer + ' hPa';
						if (typeof item.ForecastStr != 'undefined') {
							xhtm+=', ' + $.i18n('Prediction') + ': ' + $.i18n(item.ForecastStr);
						}
						if (typeof item.Altitude != 'undefined') {
							xhtm+=', Altitude: ' + item.Altitude + ' meter';
						}
					}
					else if (typeof item.Rain != 'undefined') {
						bHaveRain=true;
						xhtm+='rain48.png" height="48"></td>\n' +
						'\t      <td  id="status">' + item.Rain + ' mm';
						if (typeof item.RainRate != 'undefined') {
							if (item.RainRate!=0) {
								xhtm+=', Rate: ' + item.RainRate + ' mm/h';
							}
						}
					}
					else if (typeof item.Visibility != 'undefined') {
						bHaveVisibility=true;
						xhtm+='visibility48.png" height="48"></td>\n' +
						'\t      <td  id="status">' + item.Data;
					}
					else if (typeof item.UVI != 'undefined') {
						bHaveUV=true;
						xhtm+='uv48.png" height="48"></td>\n' +
						'\t      <td id="status">' + item.UVI + ' UVI';
						if (typeof item.Temp!= 'undefined') {
							xhtm+=', ' + $.i18n('Temp') +': ' + item.Temp + '\u00B0 C';
						}
					}
					else if (typeof item.Radiation != 'undefined') {
						bHaveRadiation=true;
						xhtm+='radiation48.png" height="48"></td>\n' +
						'\t      <td  id="status">' + item.Data;
					}
					else if (typeof item.Direction != 'undefined') {
						bHaveWind=true;
						xhtm+='Wind' + item.DirectionStr + '.png" height="48"></td>\n' +
						'\t      <td id="status">' + item.Direction + ' ' + item.DirectionStr;
						if (typeof item.Speed != 'undefined') {
							xhtm+=', ' + $.i18n('Speed') + ': ' + item.Speed + ' ' + $.myglobals.windsign;
						}
						if (typeof item.Gust != 'undefined') {
							xhtm+=', ' + $.i18n('Gust') + ': ' + item.Gust + ' ' + $.myglobals.windsign;
						}
						xhtm+='<br>\n';
						if ((typeof item.Temp != 'undefined')&&(typeof item.Chill != 'undefined')) {
							xhtm+=$.i18n('Temp') +': ' + item.Temp + '\u00B0 C, ';
							xhtm+=$.i18n('Chill') +': ' + item.Chill + '\u00B0 C';
						}
						else  {
							if (typeof item.Chill != 'undefined') {
								xhtm+=$.i18n('Chill') +': ' + item.Chill + '\u00B0 C';
							}
						}
					}
					xhtm+=      
							'</td>\n' +
							'\t      <td id="lastupdate">' + item.LastUpdate + '</td>\n' +
							'\t      <td>';
          if (item.Favorite == 0) {
            xhtm+=      
                  '<img src="images/nofavorite.png" title="' + $.i18n('Add to Dashboard') +'" onclick="MakeFavorite(' + item.idx + ',1);" onmouseover="cursorhand()" onmouseout="cursordefault()">&nbsp;&nbsp;&nbsp;&nbsp;';
          }
          else {
            xhtm+=      
                  '<img src="images/favorite.png" title="' + $.i18n('Remove from Dashboard') +'" onclick="MakeFavorite(' + item.idx + ',0);" onmouseover="cursorhand()" onmouseout="cursordefault()">&nbsp;&nbsp;&nbsp;&nbsp;';
          }

          if (typeof item.Barometer != 'undefined') {
            xhtm+='<a class="btnsmall" onclick="ShowBaroLog(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Log">Log</a> ';
          }
          else if (typeof item.Rain != 'undefined') {
            xhtm+='<a class="btnsmall" onclick="ShowRainLog(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Log">Log</a> ';
          }
          else if (typeof item.UVI != 'undefined') {
            xhtm+='<a class="btnsmall" onclick="ShowUVLog(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Log">Log</a> ';
          }
          else if (typeof item.Direction != 'undefined') {
            xhtm+='<a class="btnsmall" onclick="ShowWindLog(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Log">Log</a> ';
          }
          else if (typeof item.Visibility != 'undefined') {
            xhtm+='<a class="btnsmall" onclick="ShowGeneralGraph(' + item.idx + ',\'' + item.Name+ '\',' + item.SwitchTypeVal +', \'Visibility\');" data-i18n="Log">Log</a> ';
          }
          else if (typeof item.Radiation != 'undefined') {
            xhtm+='<a class="btnsmall" onclick="ShowGeneralGraph(' + item.idx + ',\'' + item.Name+ '\',' + item.SwitchTypeVal +', \'Radiation\');" data-i18n="Log">Log</a> ';
          }
          if (window.my_config.userrights==2) {
			  if (bHaveRain) {
				xhtm+='<a class="btnsmall" onclick="EditRainDevice(' + item.idx + ',\'' + item.Name + '\',' + item.AddjMulti +');" data-i18n="Edit">Edit</a> ';
			  }
			  else if (bHaveVisibility) {
				xhtm+='<a class="btnsmall" onclick="EditVisibilityDevice(' + item.idx + ',\'' + item.Name + '\',' + item.SwitchTypeVal +');" data-i18n="Edit">Edit</a> ';
			  }
			  else if (bHaveRadiation) {
				xhtm+='<a class="btnsmall" onclick="EditWeatherDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
			  }
			  else if (bHaveBaro) {
				xhtm+='<a class="btnsmall" onclick="EditBaroDevice(' + item.idx + ',\'' + item.Name + '\',' + item.AddjValue2 +');" data-i18n="Edit">Edit</a> ';
			  }
			  else {
				xhtm+='<a class="btnsmall" onclick="EditWeatherDevice(' + item.idx + ',\'' + item.Name + '\');" data-i18n="Edit">Edit</a> ';
			  }
			  if (item.Notifications == "true")
				xhtm+='<a class="btnsmall-sel" onclick="ShowNotifications(' + item.idx + ',\'' + item.Name + '\', \'#weathercontent\', \'ShowWeathers\');" data-i18n="Notifications">Notifications</a>';
			  else
				xhtm+='<a class="btnsmall" onclick="ShowNotifications(' + item.idx + ',\'' + item.Name + '\', \'#weathercontent\', \'ShowWeathers\');" data-i18n="Notifications">Notifications</a>';
		  }
          xhtm+=      
                '</td>\n' +
                '\t    </tr>\n' +
                '\t    </table>\n' +
                '\t  </section>\n' +
                '\t</div>\n';
          htmlcontent+=xhtm;
        });
      }
     }
  });
  if (bHaveAddedDevider == true) {
    //close previous devider
    htmlcontent+='</div>\n';
  }
  if (htmlcontent == '')
  {
    htmlcontent='<h2>' + $.i18n('No Weather sensors found or added in the system...') + '</h2>';
  }
  $('#modal').hide();
  $('#weathercontent').html(tophtm+htmlcontent);
  $('#weathercontent').i18n();
  
  RefreshTimeAndSun();

	if (window.my_config.userrights==2) {
		if (window.myglobals.ismobileint==false) {
			$("#weathercontent .span4").draggable({
					drag: function() {
						clearInterval($.myglobals.refreshTimer);
						$.devIdx=$(this).attr("id");
						$(this).css("z-index", 2);
					},
					revert: true
			});
			$("#weathercontent .span4").droppable({
					drop: function() {
						var myid=$(this).attr("id");
						$.devIdx.split(' ');
						$.ajax({
							 url: "json.htm?type=command&param=switchdeviceorder&idx1=" + myid + "&idx2=" + $.devIdx,
							 async: false, 
							 dataType: 'json',
							 success: function(data) {
									ShowWeathers();
							 }
						});
					}
			});
		}
	}
  $.myglobals.refreshTimer = setInterval(RefreshWeathers, 10000);
  return false;
}

$(document).ready(function() {
    //global var
    $.devIdx=0;
    
    $( "#dialog-editweatherdevice" ).dialog({
          autoOpen: false,
          width: 450,
          height: 160,
          modal: true,
          resizable: false,
          title: $.i18n("Edit Device"),
          buttons: {
              "Update": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-editweatherdevice #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editweatherdevice #devicename").val() + '&used=true',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowWeathers();
                         }
                      });
                      
                  }
              },
              "Remove Device": function() {
                  var bValid = false;
                  bValid=(confirm($.i18n("Are you sure to remove this Device?"))==true);
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editweatherdevice #devicename").val() + '&used=false',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowWeathers();
                         }
                      });
                      
                  }
              },
              "Transfer": function() {
                  $( this ).dialog( "close" );
                  TransferDevice($.devIdx,ShowWeathers);
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    }).i18n();
    $( "#dialog-editraindevice" ).dialog({
          autoOpen: false,
          width: 450,
          height: 190,
          modal: true,
          resizable: false,
          title: $.i18n("Edit Device"),
          buttons: {
              "Update": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-editraindevice #edittable #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editraindevice #devicename").val() + '&addjmulti=' + $("#dialog-editraindevice #edittable #multiply").val() + '&used=true',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowWeathers();
                         }
                      });
                      
                  }
              },
              "Remove Device": function() {
                  var bValid = false;
                  bValid=(confirm($.i18n("Are you sure to remove this Device?"))==true);
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editweatherdevice #devicename").val() + '&used=false',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowWeathers();
                         }
                      });
                      
                  }
              },
              "Transfer": function() {
                  $( this ).dialog( "close" );
                  TransferDevice($.devIdx,ShowWeathers);
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    }).i18n();
    $( "#dialog-editbarodevice" ).dialog({
          autoOpen: false,
          width: 450,
          height: 190,
          modal: true,
          resizable: false,
          title: $.i18n("Edit Device"),
          buttons: {
              "Update": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-editbarodevice #edittable #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      var aValue=$("#dialog-editbarodevice #edittable #adjustment").val();
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editbarodevice #devicename").val() + '&addjvalue2=' + aValue + '&used=true',
                         async: false,
                         dataType: 'json',
                         success: function(data) {
                            ShowWeathers();
                         }
                      });

                  }
              },
              "Remove Device": function() {
                  var bValid = false;
                  bValid=(confirm($.i18n("Are you sure to remove this Device?"))==true);
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editbarodevice #devicename").val() + '&used=false',
                         async: false,
                         dataType: 'json',
                         success: function(data) {
                            ShowWeathers();
                         }
                      });

                  }
              },
              "Transfer": function() {
                  $( this ).dialog( "close" );
                  TransferDevice($.devIdx,ShowWeathers);
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    }).i18n();
    $( "#dialog-editvisibilitydevice" ).dialog({
          autoOpen: false,
          width: 370,
          height: 200,
          modal: true,
          resizable: false,
          title: $.i18n("Edit Device"),
          buttons: {
              "Update": function() {
                  var bValid = true;
                  bValid = bValid && checkLength( $("#dialog-editvisibilitydevice #devicename"), 2, 100 );
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editvisibilitydevice #devicename").val() + '&switchtype=' + $("#dialog-editvisibilitydevice #combometertype").val() + '&used=true',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowWeathers();
                         }
                      });
                      
                  }
              },
              "Remove Device": function() {
                  var bValid = false;
                  bValid=(confirm($.i18n("Are you sure to remove this Device?"))==true);
                  if ( bValid ) {
                      $( this ).dialog( "close" );
                      $.ajax({
                         url: "json.htm?type=setused&idx=" + $.devIdx + '&name=' + $("#dialog-editvisibilitydevice #devicename").val() + '&used=false',
                         async: false, 
                         dataType: 'json',
                         success: function(data) {
                            ShowWeathers();
                         }
                      });
                      
                  }
              },
              Cancel: function() {
                  $( this ).dialog( "close" );
              }
          },
          open: function() {
              $(this).keypress(function(e) {
                if (e.keyCode == $.ui.keyCode.ENTER) {
                  e.preventDefault();
                  $(this).parent().find("button:eq(0)").trigger("click");
                }
              });
          },
          close: function() {
            $( this ).dialog( "close" );
          }
    }).i18n();

  ShowWeathers();
 
} );  
</script>
